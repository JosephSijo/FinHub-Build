{"results":[{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\Dashboard-77mHvodX.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\EmergencyFundsTab-VfBln1SL.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\GoalsTracker-CDWKNqoN.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\InteractiveFinancialValue-BEaiqemc.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\InvestmentsTab-7b7ZOF_8.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\LiabilityDashboard-BEre0Oy9.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\LiabilityTab-Cihd-oaZ.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\TransactionList-C9g51JND.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\charts--ivomIfj.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\forms-CLJ1xqyy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\haptics-C9gh8PRt.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\index-DHabN7TV.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\motion-BWOTBQax.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\slider-COM-Y3un.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\tooltip-vw99S11h.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\ui-Ce9YeQZa.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\assets\\vendor-Cgg2GOmP.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\registerSW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\dist_test\\workbox-8c29f6e4.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\postcss.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\AIAssistant.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\AccountsManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\AchievementDetailDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\AchievementsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\CurrencyConverter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\Dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\DebtPayoffSimulator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\EmergencyFundsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\EnhancedSettingsPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'convertCurrency'. Either include it or remove the dependency array.","line":147,"column":6,"nodeType":"ArrayExpression","endLine":147,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [fromCurrency, amount, convertCurrency]","fix":{"range":[5245,5279],"text":"[fromCurrency, amount, convertCurrency]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":802,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":802,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useTheme } from \"next-themes\";\r\nimport { Sheet, SheetContent, SheetTitle, SheetDescription } from './ui/sheet';\r\nimport { Button } from './ui/button';\r\nimport { Input } from './ui/input';\r\nimport { Label } from './ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from './ui/collapsible';\r\nimport { Separator } from './ui/separator';\r\nimport {\r\n  User, Camera, TrendingUp, ArrowRightLeft, Trophy, Bot, X,\r\n  Loader2, CheckCircle2, Trash2, ChevronDown, Settings2, LogOut, AlertOctagon, RefreshCcw\r\n} from 'lucide-react';\r\nimport {\r\n  Tooltip, ResponsiveContainer, CartesianGrid, AreaChart, Area\r\n} from 'recharts';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from './ui/alert-dialog';\r\nimport { UserSettings, CURRENCY_SYMBOLS } from '../types';\r\nimport { getAllAchievements } from '../utils/achievements';\r\nimport { resolveApiKey, validateApiKey } from '../services/ai';\r\nimport { toast } from 'sonner';\r\nimport { useFinance } from '../context/FinanceContext';\r\n\r\ninterface EnhancedSettingsPanelProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  settings: UserSettings;\r\n  onUpdateSettings: (settings: Partial<UserSettings>) => void;\r\n  onAchievementClick?: (achievementId: string) => void;\r\n  onOpenAbout?: () => void;\r\n}\r\n\r\nexport const EnhancedSettingsPanel: React.FC<EnhancedSettingsPanelProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  settings,\r\n  onUpdateSettings,\r\n  onAchievementClick,\r\n  onOpenAbout\r\n}) => {\r\n  const [name, setName] = useState(settings.name || '');\r\n  const [photoURL, setPhotoURL] = useState(settings.photoURL || '');\r\n  const [isEditingProfile, setIsEditingProfile] = useState(false);\r\n  const [convertedAmount, setConvertedAmount] = useState<number | null>(null);\r\n  const [exchangeRates, setExchangeRates] = useState<Record<string, number>>({});\r\n\r\n  const [isMigrating, setIsMigrating] = useState(false);\r\n  const { logout, scheduleAccountDeletion, migrateSubscriptions, cleanupDuplicates, clearAllData } = useFinance(); // Destructure migrateSubscriptions\r\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n\r\n  const handleMigrate = async () => {\r\n    setIsMigrating(true);\r\n    try {\r\n      await migrateSubscriptions();\r\n    } catch (e) {\r\n      console.error(\"Migration failed:\", e);\r\n      toast.error(\"Migration failed\");\r\n    } finally {\r\n      setIsMigrating(false);\r\n    }\r\n  };\r\n  // Currency Converter State\r\n  const [fromCurrency, setFromCurrency] = useState<string>('USD');\r\n  const [amount, setAmount] = useState<string>('100');\r\n\r\n  const [infAmount, setInfAmount] = useState<string>('100000');\r\n  const [infYears, setInfYears] = useState<string>('10');\r\n  const [infRate, setInfRate] = useState<string>('6');\r\n  const [isSyncingInflation, setIsSyncingInflation] = useState(false);\r\n\r\n  const syncInflation = async () => {\r\n    const countryMap: Record<string, string> = {\r\n      'USD': 'US',\r\n      'INR': 'IN',\r\n      'GBP': 'GB',\r\n      'EUR': 'EMU',\r\n      'AED': 'AE',\r\n      'SAR': 'SA'\r\n    };\r\n\r\n    const iso2 = countryMap[settings.currency] || 'US';\r\n    setIsSyncingInflation(true);\r\n    try {\r\n      const res = await fetch(`https://api.worldbank.org/v2/country/${iso2}/indicator/FP.CPI.TOTL.ZG?format=json&per_page=1`);\r\n      const data = await res.json();\r\n      if (data && data[1] && data[1][0] && data[1][0].value) {\r\n        const rate = data[1][0].value;\r\n        setInfRate(rate.toFixed(2));\r\n        toast.success(`Inflation rate synced for ${settings.currency}`);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Inflation sync failed:\", e);\r\n      toast.error(\"Failed to sync inflation rate.\");\r\n    } finally {\r\n      setIsSyncingInflation(false);\r\n    }\r\n  };\r\n\r\n  const projectionData = Array.from({ length: (parseInt(infYears) || 0) + 1 }, (_, i) => {\r\n    const amountVal = parseFloat(infAmount) || 0;\r\n    const rateVal = parseFloat(infRate) || 0;\r\n    const fv = amountVal * Math.pow(1 + rateVal / 100, i);\r\n    const pv = amountVal / Math.pow(1 + rateVal / 100, i);\r\n    return {\r\n      year: i,\r\n      futureCost: Math.round(fv),\r\n      purchasingPower: Math.round(pv)\r\n    };\r\n  });\r\n\r\n  const currencies = ['INR', 'USD', 'EUR', 'GBP', 'AED', 'SAR'] as const;\r\n  const toCurrency = settings.currency;\r\n\r\n  useEffect(() => {\r\n    setName(settings.name || '');\r\n    setPhotoURL(settings.photoURL || '');\r\n  }, [settings]);\r\n\r\n  // Load exchange rates\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      loadExchangeRates();\r\n    }\r\n  }, [isOpen, loadExchangeRates]);\r\n\r\n  const loadExchangeRates = useCallback(async () => {\r\n    try {\r\n      const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCurrency}`);\r\n      const data = await response.json();\r\n      setExchangeRates(data.rates || {});\r\n      if (amount) {\r\n        convertCurrency(amount, data.rates);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading exchange rates:', error);\r\n    }\r\n  }, [fromCurrency, amount, toCurrency]);\r\n\r\n  const convertCurrency = (value: string, rates?: Record<string, number>) => {\r\n    const numValue = parseFloat(value);\r\n    if (!isNaN(numValue) && numValue > 0) {\r\n      const ratesToUse = rates || exchangeRates;\r\n      const rate = ratesToUse[toCurrency] || 1;\r\n      setConvertedAmount(numValue * rate);\r\n    } else {\r\n      setConvertedAmount(null);\r\n    }\r\n  };\r\n\r\n  const handleAmountChange = (value: string) => {\r\n    setAmount(value);\r\n    convertCurrency(value);\r\n  };\r\n\r\n  const { setTheme } = useTheme();\r\n\r\n  // Force dark theme if not already set, since light mode is being removed\r\n  useEffect(() => {\r\n    if (settings.theme !== 'dark') {\r\n      setTheme('dark');\r\n      onUpdateSettings({ theme: 'dark' });\r\n    }\r\n  }, [settings.theme, setTheme, onUpdateSettings]);\r\n\r\n\r\n  const handleSaveProfile = () => {\r\n    onUpdateSettings({ name, photoURL });\r\n    setIsEditingProfile(false);\r\n  };\r\n\r\n  const handlePhotoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setPhotoURL(reader.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  // Get all achievements\r\n  const allAchievements = getAllAchievements();\r\n  const unlockedIds = new Set(settings.unlockedAchievements);\r\n\r\n  // AI Configuration State\r\n  const selectedProvider = settings.aiProvider || 'openai';\r\n\r\n  const aiProviders = [\r\n    { id: 'openai', label: 'OpenAI', placeholder: 'sk-...' },\r\n    { id: 'anthropic', label: 'Anthropic', placeholder: 'sk-ant-...' },\r\n    { id: 'gemini', label: 'Gemini', placeholder: 'AIza...' },\r\n    { id: 'deepseek', label: 'Deepseek', placeholder: 'sk-...' },\r\n    { id: 'perplexity', label: 'Perplexity', placeholder: 'pplx-...' },\r\n  ];\r\n\r\n  const [isTestingConnection, setIsTestingConnection] = useState(false);\r\n  const [testResult, setTestResult] = useState<{ success: boolean; message: string } | null>(null);\r\n\r\n  const handleInputChange = useCallback((key: keyof UserSettings, value: any) => {\r\n    onUpdateSettings({ [key]: value });\r\n  }, [onUpdateSettings]);\r\n\r\n  const handleTestConnection = async () => {\r\n    const key = resolveApiKey(selectedProvider, settings);\r\n    if (!key) {\r\n      toast.error('No API key found in Settings or System Environment');\r\n      return;\r\n    }\r\n\r\n    setIsTestingConnection(true);\r\n    setTestResult(null);\r\n\r\n    try {\r\n      const response = await validateApiKey(selectedProvider, key);\r\n      if (response.error) {\r\n        setTestResult({ success: false, message: response.error });\r\n        toast.error(`Connection failed: ${response.error}`);\r\n      } else {\r\n        setTestResult({ success: true, message: 'Neural link established.' });\r\n        toast.success('Connection successful!');\r\n      }\r\n    } catch (error: any) {\r\n      const msg = error.message || 'Unknown protocol error';\r\n      setTestResult({ success: false, message: msg });\r\n      toast.error(`Protocol breach: ${msg}`);\r\n    } finally {\r\n      setIsTestingConnection(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Sheet open={isOpen} onOpenChange={onClose}>\r\n      <SheetContent side=\"left\" className=\"w-full sm:max-w-lg overflow-y-auto px-0 bg-slate-950 border-white/5 text-slate-100 h-dvh\">\r\n        <SheetTitle className=\"sr-only\">Settings</SheetTitle>\r\n        <SheetDescription className=\"sr-only\">Customize your FinHub core experience.</SheetDescription>\r\n        <div className=\"space-y-12 animate-in fade-in slide-in-from-left-4 duration-500 px-8 pt-12 pb-10 text-white relative\">\r\n          {/* Close Button Area */}\r\n          <div className=\"absolute top-4 right-4 z-20\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              onClick={onClose}\r\n              className=\"w-10 h-10 rounded-full bg-white/5 text-slate-400 hover:text-white hover:bg-white/10\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </Button>\r\n          </div>\r\n          <div className=\"flex flex-col gap-2\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-1.5 h-8 bg-indigo-500 rounded-full shadow-[0_0_15px_rgba(99,102,241,0.5)]\" />\r\n              <h2 className=\"text-3xl font-black text-slate-100 tracking-tight leading-none text-white\">System Config</h2>\r\n            </div>\r\n            <p className=\"text-slate-500 font-bold ml-4 text-sm\">\r\n              Customize your FinHub core experience.\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"space-y-10\">\r\n            {/* Profile Section */}\r\n            <div className=\"space-y-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 flex items-center gap-2\">\r\n                  <User className=\"w-3.5 h-3.5\" />\r\n                  User Identity\r\n                </h3>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => setIsEditingProfile(!isEditingProfile)}\r\n                  className=\"text-[10px] font-black uppercase tracking-widest text-indigo-400 hover:text-indigo-300 hover:bg-white/5\"\r\n                >\r\n                  {isEditingProfile ? 'Abort' : 'Refine'}\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-8 bg-slate-900/40 p-6 rounded-[32px] border border-white/5 relative overflow-hidden group\">\r\n                <div className=\"absolute top-0 right-0 w-24 h-24 bg-indigo-500 blur-3xl opacity-5 -mr-12 -mt-12\" />\r\n                <div className=\"relative\">\r\n                  {photoURL ? (\r\n                    <img\r\n                      src={photoURL}\r\n                      alt=\"Profile\"\r\n                      className=\"w-24 h-24 rounded-full object-cover border-4 border-slate-800 shadow-2xl\"\r\n                    />\r\n                  ) : (\r\n                    <div className=\"w-24 h-24 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-full flex items-center justify-center shadow-2xl\">\r\n                      <User className=\"w-12 h-12 text-white/90\" />\r\n                    </div>\r\n                  )}\r\n                  {isEditingProfile && (\r\n                    <label className=\"absolute bottom-0 right-0 w-9 h-9 bg-indigo-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-indigo-500 shadow-lg border-4 border-slate-900 transition-transform active:scale-90\">\r\n                      <Camera className=\"w-4 h-4 text-white\" />\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                        onChange={handlePhotoUpload}\r\n                        aria-label=\"Upload profile picture\"\r\n                      />\r\n                    </label>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex-1 min-w-0\">\r\n                  {isEditingProfile ? (\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"space-y-1.5\">\r\n                        <Label htmlFor=\"settings-profile-name\" className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 ml-1\">Alias</Label>\r\n                        <Input\r\n                          id=\"settings-profile-name\"\r\n                          name=\"name\"\r\n                          placeholder=\"e.g. Maverick\"\r\n                          value={name}\r\n                          onChange={(e) => setName(e.target.value)}\r\n                          className=\"bg-white/5 border-white/5 rounded-xl h-12 text-white placeholder:text-slate-700 font-bold\"\r\n                          autoComplete=\"name\"\r\n                        />\r\n                      </div>\r\n                      <Button size=\"sm\" onClick={handleSaveProfile} className=\"w-full h-12 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-xl\">\r\n                        Commit Identity\r\n                      </Button>\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      <h4 className=\"text-2xl font-black text-slate-100 tracking-tight\">{name || 'Guest User'}</h4>\r\n                      <p className=\"text-xs text-slate-500 font-bold uppercase tracking-widest mt-1\">\r\n                        FinHub Node // 0x50.3\r\n                      </p>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n\r\n            <div className=\"h-px bg-white/5\" />\r\n\r\n            {/* Virtual Round Up Settings */}\r\n            <div className=\"space-y-4\">\r\n              <button\r\n                onClick={() => onUpdateSettings({ roundUpEnabled: !settings.roundUpEnabled })}\r\n                className={`w-full flex items-center justify-between p-6 rounded-[32px] border transition-all relative overflow-hidden group ${settings.roundUpEnabled\r\n                  ? 'bg-emerald-500/10 border-emerald-500/50 shadow-[0_0_20px_rgba(16,185,129,0.1)]'\r\n                  : 'bg-slate-900/40 border-white/5 grayscale opacity-60 hover:opacity-100 hover:grayscale-0'\r\n                  }`}\r\n              >\r\n                <div className={`absolute top-0 right-0 w-24 h-24 blur-3xl opacity-10 -mr-12 -mt-12 transition-colors ${settings.roundUpEnabled ? 'bg-emerald-500' : 'bg-slate-500'\r\n                  }`} />\r\n\r\n                <div className=\"space-y-1 relative z-10 flex-1 pr-4 text-left\">\r\n                  <div className=\"flex items-center gap-2 text-sm font-black text-slate-100 uppercase tracking-tight\">\r\n                    <TrendingUp className={`w-4 h-4 ${settings.roundUpEnabled ? 'text-emerald-500' : 'text-slate-500'}`} />\r\n                    Virtual Round-Ups\r\n                  </div>\r\n                  <p className=\"text-[10px] text-slate-500 font-bold leading-relaxed uppercase tracking-widest\">\r\n                    Build your fortress automatically via expense spillover.\r\n                  </p>\r\n                </div>\r\n\r\n                <div className={`relative z-10 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${settings.roundUpEnabled\r\n                  ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/20'\r\n                  : 'bg-slate-800 text-slate-500'\r\n                  }`}>\r\n                  {settings.roundUpEnabled ? 'Active' : 'Offline'}\r\n                </div>\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"h-px bg-white/5\" />\r\n\r\n            <div className=\"space-y-4\">\r\n              <Label htmlFor=\"settings-currency\" className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 flex items-center gap-2\">\r\n                <ArrowRightLeft className=\"w-3.5 h-3.5\" />\r\n                Standard Denomination\r\n              </Label>\r\n              <div className=\"bg-slate-900/40 p-6 rounded-[32px] border border-white/5 relative overflow-hidden\">\r\n                <div className=\"absolute top-0 right-0 w-24 h-24 bg-indigo-500 blur-3xl opacity-5 -mr-12 -mt-12\" />\r\n                <div className=\"space-y-2 relative z-10\">\r\n                  <Select\r\n                    value={settings.currency}\r\n                    onValueChange={(value: any) => onUpdateSettings({ currency: value })}\r\n                  >\r\n                    <SelectTrigger id=\"settings-currency\" name=\"currency\" className=\"bg-white/5 border-white/5 rounded-2xl h-14 font-black\">\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                      <SelectItem value=\"USD\">USD ($) - US Dollar</SelectItem>\r\n                      <SelectItem value=\"EUR\">EUR (€) - Euro</SelectItem>\r\n                      <SelectItem value=\"GBP\">GBP (£) - British Pound</SelectItem>\r\n                      <SelectItem value=\"INR\">INR (₹) - Indian Rupee</SelectItem>\r\n                      <SelectItem value=\"AED\">AED (د.إ) - UAE Dirham</SelectItem>\r\n                      <SelectItem value=\"SAR\">SAR (﷼) - Saudi Riyal</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"h-px bg-white/5\" />\r\n\r\n            {/* Quick Currency Converter */}\r\n            <div className=\"space-y-6\">\r\n              <Label className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 flex items-center gap-2\">\r\n                <ArrowRightLeft className=\"w-3.5 h-3.5\" />\r\n                Foreign Exchange Probe\r\n              </Label>\r\n\r\n              <div className=\"space-y-6 p-6 bg-slate-900/40 rounded-[32px] border border-white/5 relative overflow-hidden group\">\r\n                <div className=\"absolute top-0 right-0 w-24 h-24 bg-blue-500 blur-3xl opacity-5 -mr-12 -mt-12\" />\r\n\r\n                <div className=\"grid grid-cols-2 gap-4 relative z-10\">\r\n                  <div className=\"space-y-1.5\">\r\n                    <Label htmlFor=\"converter-from-currency\" className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 ml-1\">Source</Label>\r\n                    <Select value={fromCurrency} onValueChange={(value: string) => {\r\n                      setFromCurrency(value);\r\n                    }}>\r\n                      <SelectTrigger id=\"converter-from-currency\" name=\"fromCurrency\" className=\"bg-white/5 border-white/5 rounded-2xl h-12\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                        {currencies.map(curr => (\r\n                          <SelectItem key={curr} value={curr}>\r\n                            {CURRENCY_SYMBOLS[curr]} {curr}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-1.5\">\r\n                    <Label className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 ml-1\">Target</Label>\r\n                    <div className=\"h-12 flex items-center justify-center bg-indigo-500/10 rounded-2xl border border-indigo-500/20 text-xs font-black text-indigo-400\">\r\n                      {CURRENCY_SYMBOLS[toCurrency]} {toCurrency}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-1.5 relative z-10\">\r\n                  <Label htmlFor=\"converter-amount\" className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 ml-1\">Capital Amount</Label>\r\n                  <Input\r\n                    id=\"converter-amount\"\r\n                    name=\"amount\"\r\n                    type=\"number\"\r\n                    placeholder=\"Enter amount\"\r\n                    value={amount}\r\n                    onChange={(e) => {\r\n                      const val = e.target.value;\r\n                      if (parseFloat(val) < 0) return;\r\n                      handleAmountChange(val);\r\n                    }}\r\n                    min=\"0\"\r\n                    className=\"bg-white/5 border-white/5 rounded-2xl h-14 font-black text-lg\"\r\n                    autoComplete=\"off\"\r\n                  />\r\n                </div>\r\n\r\n                {convertedAmount !== null && (\r\n                  <div className=\"p-6 bg-white/5 rounded-2xl border border-white/5 animate-in fade-in slide-in-from-top-2 relative z-10\">\r\n                    <p className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 mb-2\">Calculated Projection</p>\r\n                    <div className=\"flex items-baseline gap-2\">\r\n                      <p className=\"text-2xl font-black text-emerald-400 tabular-nums\">\r\n                        {CURRENCY_SYMBOLS[toCurrency]}{convertedAmount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\r\n                      </p>\r\n                      <p className=\"text-[10px] text-slate-600 font-bold uppercase tracking-widest\">\r\n                        ESTIMATED VALUATION\r\n                      </p>\r\n                    </div>\r\n                    {exchangeRates[toCurrency] && (\r\n                      <div className=\"mt-4 pt-4 border-t border-white/5 flex items-center justify-between\">\r\n                        <span className=\"text-[8px] font-black uppercase tracking-[0.2em] text-slate-700\">Protocol Rate</span>\r\n                        <span className=\"text-[10px] font-black text-slate-500 tabular-nums\">\r\n                          1 {fromCurrency} = {exchangeRates[toCurrency].toFixed(4)} {toCurrency}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Inflation Calculator Tool */}\r\n            <div className=\"space-y-6\">\r\n              <Label className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 flex items-center gap-2\">\r\n                <TrendingUp className=\"w-3.5 h-3.5 text-rose-500\" />\r\n                Inflation Projection Node\r\n              </Label>\r\n\r\n              <div className=\"space-y-6 p-6 bg-slate-900/40 rounded-[32px] border border-white/5 relative overflow-hidden group\">\r\n                <div className=\"absolute top-0 right-0 w-24 h-24 bg-rose-500 blur-3xl opacity-5 -mr-12 -mt-12\" />\r\n\r\n                <div className=\"space-y-4 relative z-10\">\r\n                  <div className=\"space-y-1.5\">\r\n                    <Label className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 ml-1\">Current Capital</Label>\r\n                    <Input\r\n                      type=\"number\"\r\n                      value={infAmount}\r\n                      onChange={(e) => setInfAmount(e.target.value)}\r\n                      className=\"bg-white/5 border-white/5 rounded-2xl h-12 font-black\"\r\n                      placeholder=\"e.g. 1000000\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-1.5\">\r\n                      <Label className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 ml-1\">Horizon (Years)</Label>\r\n                      <Input\r\n                        type=\"number\"\r\n                        value={infYears}\r\n                        onChange={(e) => setInfYears(e.target.value)}\r\n                        className=\"bg-white/5 border-white/5 rounded-2xl h-12 font-black\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-1.5\">\r\n                      <div className=\"flex items-center justify-between ml-1\">\r\n                        <Label className=\"text-[9px] font-black uppercase tracking-widest text-slate-500\">Rate (%)</Label>\r\n                        <button\r\n                          onClick={syncInflation}\r\n                          disabled={isSyncingInflation}\r\n                          className=\"text-[8px] font-black uppercase text-indigo-400 hover:text-indigo-300 disabled:opacity-50 flex items-center gap-1\"\r\n                        >\r\n                          {isSyncingInflation ? <Loader2 className=\"w-2 h-2 animate-spin\" /> : <RefreshCcw className=\"w-2 h-2\" />}\r\n                          Sync\r\n                        </button>\r\n                      </div>\r\n                      <Input\r\n                        type=\"number\"\r\n                        value={infRate}\r\n                        onChange={(e) => setInfRate(e.target.value)}\r\n                        className=\"bg-white/5 border-white/5 rounded-2xl h-12 font-black\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {infAmount && (\r\n                    <div className=\"space-y-4\">\r\n                      <div className=\"h-32 w-full bg-black/20 rounded-2xl p-2 border border-white/5 overflow-hidden\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\" minHeight={128} minWidth={100}>\r\n                          <AreaChart data={projectionData}>\r\n                            <defs>\r\n                              <linearGradient id=\"colorCost\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                <stop offset=\"5%\" stopColor=\"#FB7185\" stopOpacity={0.3} />\r\n                                <stop offset=\"95%\" stopColor=\"#FB7185\" stopOpacity={0} />\r\n                              </linearGradient>\r\n                              <linearGradient id=\"colorPower\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                <stop offset=\"5%\" stopColor=\"#34D399\" stopOpacity={0.3} />\r\n                                <stop offset=\"95%\" stopColor=\"#34D399\" stopOpacity={0} />\r\n                              </linearGradient>\r\n                            </defs>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"rgba(255,255,255,0.05)\" />\r\n                            <Tooltip\r\n                              contentStyle={{ backgroundColor: '#0f172a', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px', fontSize: '10px' }}\r\n                              itemStyle={{ color: '#fff', padding: '2px 0' }}\r\n                            />\r\n                            <Area type=\"monotone\" dataKey=\"futureCost\" stroke=\"#FB7185\" fillOpacity={1} fill=\"url(#colorCost)\" />\r\n                            <Area type=\"monotone\" dataKey=\"purchasingPower\" stroke=\"#34D399\" fillOpacity={1} fill=\"url(#colorPower)\" />\r\n                          </AreaChart>\r\n                        </ResponsiveContainer>\r\n                      </div>\r\n\r\n                      <div className=\"p-6 bg-white/5 rounded-2xl border border-white/5 space-y-4\">\r\n                        <div>\r\n                          <p className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 mb-2\">Future Cost</p>\r\n                          <p className=\"text-xl font-black text-rose-400 tabular-nums\">\r\n                            {CURRENCY_SYMBOLS[settings.currency]}{Math.round(parseFloat(infAmount) * Math.pow(1 + parseFloat(infRate) / 100, parseFloat(infYears))).toLocaleString()}\r\n                          </p>\r\n                        </div>\r\n                        <div className=\"pt-4 border-t border-white/5\">\r\n                          <p className=\"text-[9px] font-black uppercase tracking-widest text-slate-500 mb-2\">Real Purchasing Power</p>\r\n                          <p className=\"text-xl font-black text-emerald-400 tabular-nums\">\r\n                            {CURRENCY_SYMBOLS[settings.currency]}{Math.round(parseFloat(infAmount) / Math.pow(1 + parseFloat(infRate) / 100, parseFloat(infYears))).toLocaleString()}\r\n                          </p>\r\n                          <p className=\"text-[8px] text-slate-600 font-bold uppercase tracking-widest mt-1\">\r\n                            VALUATION IN TODAY'S MONEY\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"h-px bg-white/5\" />\r\n\r\n            {/* AI Configuration */}\r\n            <div className=\"space-y-6\">\r\n              <Label className=\"text-[10px] font-bold uppercase tracking-[0.2em] text-slate-500 flex items-center gap-2\">\r\n                <Bot className=\"w-3.5 h-3.5 text-indigo-400\" />\r\n                AI Assistant Config\r\n              </Label>\r\n\r\n              <div className=\"space-y-6 bg-slate-900/40 p-6 rounded-[32px] border border-white/5 relative overflow-hidden group\">\r\n                <div className=\"space-y-1.5 relative z-10\">\r\n                  <Label htmlFor=\"ai-provider-select\" className=\"text-[9px] font-bold uppercase tracking-widest text-slate-500 ml-1\">Preferred Provider</Label>\r\n                  <Select\r\n                    value={selectedProvider}\r\n                    onValueChange={(value: string) => onUpdateSettings({ aiProvider: value })}\r\n                  >\r\n                    <SelectTrigger id=\"ai-provider-select\" name=\"aiProvider\" className=\"bg-slate-900 border-white/5 rounded-xl h-11 text-[10px] font-bold uppercase tracking-widest\">\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                      {aiProviders.map(p => (\r\n                        <SelectItem key={p.id} value={p.id} className=\"text-[10px] font-bold uppercase tracking-widest\">{p.label}</SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-4 pt-2 relative z-10\">\r\n                  <div className=\"flex items-center justify-between px-1\">\r\n                    <Label className=\"text-[9px] font-bold uppercase tracking-widest text-slate-500\">Active Credential</Label>\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <span className=\"text-[8px] font-bold text-indigo-400/70 uppercase tracking-tighter\">\r\n                        {aiProviders.find(p => p.id === selectedProvider)?.label}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {aiProviders.filter(p => p.id === selectedProvider).map((provider) => {\r\n                    const settingKey = settings.apiKeys?.[provider.id as keyof typeof settings.apiKeys];\r\n                    const envKeyName = `VITE_${provider.id.toUpperCase()}_API_KEY`;\r\n                    const hasEnvKey = !!import.meta.env[envKeyName];\r\n\r\n                    return (\r\n                      <div key={provider.id} className=\"flex items-center gap-3 bg-indigo-500/5 p-4 rounded-2xl border border-indigo-500/20 group/active transition-all\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"relative group/input\">\r\n                            <Input\r\n                              type=\"password\"\r\n                              value={settingKey || ''}\r\n                              onChange={(e) => handleInputChange('apiKeys', { ...settings.apiKeys, [provider.id]: e.target.value })}\r\n                              placeholder={hasEnvKey ? 'Using System Environment Key' : `Enter ${provider.label} Key`}\r\n                              className={`bg-transparent border-none p-0 h-auto text-sm font-bold text-white placeholder:text-slate-700 focus-visible:ring-0 shadow-none ${hasEnvKey && !settingKey ? 'opacity-40 italic font-medium' : ''}`}\r\n                              disabled={hasEnvKey && !settingKey}\r\n                            />\r\n                            {hasEnvKey && !settingKey && (\r\n                              <div className=\"flex items-center gap-1 mt-1\">\r\n                                <span className=\"text-[7px] font-black text-emerald-500 uppercase tracking-widest bg-emerald-500/10 px-1 py-0.5 rounded\">\r\n                                  System Linked\r\n                                </span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        {settingKey && (\r\n                          <button\r\n                            onClick={() => handleInputChange('apiKeys', { ...settings.apiKeys, [provider.id]: '' })}\r\n                            className=\"text-slate-600 hover:text-rose-500 transition-colors p-1\"\r\n                            title=\"Clear saved key\"\r\n                            aria-label={`Clear saved key for ${provider.label}`}\r\n                          >\r\n                            <Trash2 className=\"w-3.5 h-3.5\" />\r\n                          </button>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })}\r\n\r\n                  <Button\r\n                    onClick={handleTestConnection}\r\n                    disabled={isTestingConnection || !resolveApiKey(selectedProvider, settings)}\r\n                    className={`w-full h-11 transition-all font-bold uppercase tracking-[0.2em] text-[10px] rounded-xl ${testResult?.success\r\n                      ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'\r\n                      : testResult?.success === false\r\n                        ? 'bg-rose-500/10 text-rose-400 border border-rose-500/20'\r\n                        : 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/20'\r\n                      }`}\r\n                  >\r\n                    {isTestingConnection ? (\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Loader2 className=\"w-3.5 h-3.5 animate-spin\" />\r\n                        Verifying...\r\n                      </div>\r\n                    ) : testResult?.success ? (\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <CheckCircle2 className=\"w-3.5 h-3.5\" />\r\n                        Link Stable\r\n                      </div>\r\n                    ) : (\r\n                      'Validate Connection'\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n\r\n                <Collapsible className=\"relative z-10\">\r\n                  <CollapsibleTrigger asChild>\r\n                    <Button variant=\"ghost\" className=\"w-full h-8 hover:bg-white/5 text-slate-500 hover:text-slate-300 text-[8px] font-bold uppercase tracking-widest group/trigger flex items-center justify-between px-2 rounded-lg\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Settings2 className=\"w-3 h-3 text-slate-600 group-hover/trigger:text-slate-400\" />\r\n                        Alternative Nodes\r\n                      </div>\r\n                      <ChevronDown className=\"w-3 h-3 transition-transform duration-300 group-data-[state=open]/trigger:rotate-180\" />\r\n                    </Button>\r\n                  </CollapsibleTrigger>\r\n                  <CollapsibleContent className=\"pt-4 space-y-3 animate-in fade-in slide-in-from-top-2 duration-300\">\r\n                    <div className=\"grid gap-2\">\r\n                      {aiProviders.filter(p => p.id !== selectedProvider).map((provider) => {\r\n                        const settingKey = settings.apiKeys?.[provider.id as keyof typeof settings.apiKeys];\r\n                        const envKeyName = `VITE_${provider.id.toUpperCase()}_API_KEY`;\r\n                        const hasEnvKey = !!import.meta.env[envKeyName];\r\n\r\n                        return (\r\n                          <div key={provider.id} className=\"flex items-center gap-3 bg-slate-950/40 p-3 rounded-xl border border-white/5 hover:border-white/10 transition-colors\">\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-center justify-between mb-1\">\r\n                                <span className=\"text-[8px] font-bold uppercase tracking-wider text-slate-500\">\r\n                                  {provider.label}\r\n                                </span>\r\n                                {hasEnvKey && !settingKey && (\r\n                                  <span className=\"text-[7px] font-bold text-emerald-500/50 uppercase tracking-tighter\">\r\n                                    System\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                              <Input\r\n                                type=\"password\"\r\n                                value={settingKey || ''}\r\n                                onChange={(e) => handleInputChange('apiKeys', { ...settings.apiKeys, [provider.id]: e.target.value })}\r\n                                placeholder={hasEnvKey ? 'Using System Default' : 'Key not found'}\r\n                                className=\"bg-transparent border-none p-0 h-auto text-[10px] text-slate-400 placeholder:text-slate-800 focus-visible:ring-0 shadow-none italic font-medium cursor-not-allowed\"\r\n                                disabled={hasEnvKey && !settingKey}\r\n                              />\r\n                            </div>\r\n                            {settingKey && (\r\n                              <button\r\n                                onClick={() => handleInputChange('apiKeys', { ...settings.apiKeys, [provider.id]: '' })}\r\n                                className=\"text-slate-800 hover:text-rose-500 transition-colors p-1\"\r\n                                title=\"Clear saved key\"\r\n                                aria-label={`Clear saved key for ${provider.label}`}\r\n                              >\r\n                                <Trash2 className=\"w-3 h-3\" />\r\n                              </button>\r\n                            )}\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </CollapsibleContent>\r\n                </Collapsible>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n\r\n          <div className=\"h-px bg-white/5\" />\r\n\r\n          {/* Data Management Section */}\r\n          <div className=\"space-y-4\">\r\n            <Label className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 flex items-center gap-2\">\r\n              <AlertOctagon className=\"w-3.5 h-3.5 text-indigo-400\" />\r\n              Data Optimization Node\r\n            </Label>\r\n            <div className=\"p-6 bg-slate-900/40 rounded-[32px] border border-white/5 relative overflow-hidden\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <h4 className=\"text-[10px] font-black uppercase tracking-widest text-slate-300\">Subscription Protocol Scan</h4>\r\n                  <p className=\"text-[8px] font-bold text-slate-500 uppercase tracking-wide mt-1\">\r\n                    DETECT & MIGRATE RECURRING SIGNALS\r\n                  </p>\r\n                </div>\r\n                <Button\r\n                  onClick={handleMigrate}\r\n                  disabled={isMigrating}\r\n                  className=\"bg-indigo-600 hover:bg-indigo-500 text-white font-black uppercase tracking-widest text-[9px] h-9 px-4 rounded-xl shadow-lg shadow-indigo-500/20\"\r\n                >\r\n                  {isMigrating ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                      Scanning...\r\n                    </div>\r\n                  ) : (\r\n                    'Execute Scan'\r\n                  )}\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"mt-4 pt-4 border-t border-white/5 flex items-center justify-between\">\r\n                <div>\r\n                  <h4 className=\"text-[10px] font-black uppercase tracking-widest text-slate-300\">Redundancy Purge</h4>\r\n                  <p className=\"text-[8px] font-bold text-slate-500 uppercase tracking-wide mt-1\">\r\n                    REMOVE BLANK & DUPLICATE ENTRIES\r\n                  </p>\r\n                </div>\r\n                <Button\r\n                  onClick={async () => {\r\n                    const toastId = toast.loading(\"Purging duplicates...\");\r\n                    try {\r\n                      await cleanupDuplicates();\r\n                      toast.dismiss(toastId);\r\n                    } catch (_e) {\r\n                      toast.dismiss(toastId);\r\n                      toast.error(\"Purge failed\");\r\n                    }\r\n                  }}\r\n                  className=\"bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 border border-rose-500/20 font-black uppercase tracking-widest text-[9px] h-9 px-4 rounded-xl\"\r\n                >\r\n                  Purge Logs\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"h-px bg-white/5\" />\r\n\r\n          {/* Achievements */}\r\n          <div className=\"space-y-6\">\r\n            <Label className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-600 flex items-center gap-2\">\r\n              <Trophy className=\"w-3.5 h-3.5 text-amber-500\" />\r\n              Reputation Rank ({settings.unlockedAchievements.length}/{allAchievements.length})\r\n            </Label>\r\n\r\n            <div className=\"grid grid-cols-4 sm:grid-cols-6 gap-3\">\r\n              {allAchievements.map((achievement) => {\r\n                const isUnlocked = unlockedIds.has(achievement.id);\r\n                return (\r\n                  <button\r\n                    key={achievement.id}\r\n                    onClick={() => {\r\n                      if (isUnlocked && onAchievementClick) {\r\n                        onAchievementClick(achievement.id);\r\n                      }\r\n                    }}\r\n                    disabled={!isUnlocked}\r\n                    className={`w-12 h-12 rounded-xl border flex items-center justify-center text-xl transition-all ${isUnlocked\r\n                      ? 'border-amber-500/50 bg-amber-500/10 grayscale-0 hover:scale-110 hover:shadow-lg hover:shadow-amber-500/20 active:scale-95'\r\n                      : 'border-white/5 bg-white/5 grayscale opacity-20 cursor-not-allowed'\r\n                      }`}\r\n                  >\r\n                    {achievement.icon}\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            <p className=\"text-[10px] text-slate-500 font-bold text-center leading-relaxed\">\r\n              {settings.unlockedAchievements.length > 0 ? 'Select a sigil to view the record of your triumph.' : 'Initiate financial protocols to manifest higher ranks.'}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"h-px bg-white/5\" />\r\n\r\n          {/* Danger Zone: Full Wipe for Testing */}\r\n          <div className=\"space-y-4\">\r\n            <div className=\"p-4 bg-rose-500/5 border border-rose-500/10 rounded-2xl flex items-center justify-between\">\r\n              <div>\r\n                <h4 className=\"text-[10px] font-black uppercase tracking-widest text-rose-400\">Factory Reset</h4>\r\n                <p className=\"text-[8px] font-bold text-slate-500 uppercase tracking-wide mt-1\">\r\n                  WIPE ALL TRANSACTIONS & RECURRING (KEEP ACCOUNT)\r\n                </p>\r\n              </div>\r\n              <Button\r\n                onClick={async () => {\r\n                  if (confirm(\"Are you sure? This deletes ALL transaction data.\")) {\r\n                    await clearAllData();\r\n                  }\r\n                }}\r\n                className=\"bg-slate-950 hover:bg-rose-500 text-rose-500 hover:text-white border border-rose-500/20 font-black uppercase tracking-widest text-[9px] h-9 px-4 rounded-xl transition-colors\"\r\n              >\r\n                Wipe Data\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <Separator className=\"bg-white/5\" />\r\n\r\n          {/* Copyright System Footer */}\r\n          <div className=\"text-center pt-8 space-y-2 opacity-40 hover:opacity-100 transition-opacity duration-700 pb-10\">\r\n            <p className=\"text-[10px] font-black uppercase tracking-[0.5em] text-slate-100\">Obsidian System Node</p>\r\n            <p className=\"text-[8px] font-bold text-slate-500 uppercase tracking-widest\">\r\n              Architect: Sijo Joseph // BUILD 50.3.0 // QUANTUM CORE\r\n            </p>\r\n            <p className=\"text-[8px] font-bold text-slate-700 uppercase tracking-widest mt-4\">\r\n              © 2025 NEURAL FINHUB FABRIC\r\n            </p>\r\n            <button\r\n              onClick={onOpenAbout}\r\n              className=\"mt-4 text-[8px] font-black text-indigo-400/60 hover:text-indigo-400 uppercase tracking-[0.2em] transition-colors\"\r\n            >\r\n              [ Protocol Info // About ]\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"px-2 pb-10\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                logout();\r\n                onClose();\r\n              }}\r\n              className=\"w-full h-14 bg-white/5 hover:bg-white/10 border-white/10 hover:border-white/20 text-white/60 hover:text-white font-black uppercase tracking-widest gap-3 rounded-[24px] transition-all group mb-4\"\r\n            >\r\n              <LogOut className=\"w-5 h-5 group-hover:-translate-x-1 transition-transform\" />\r\n              Terminate Session\r\n            </Button>\r\n\r\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\r\n              <AlertDialogTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  className=\"w-full h-14 bg-rose-500/5 hover:bg-rose-500/10 border-rose-500/20 hover:border-rose-500/40 text-rose-500 font-black uppercase tracking-widest gap-3 rounded-[24px] transition-all group\"\r\n                >\r\n                  <AlertOctagon className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\r\n                  Delete Account & Data\r\n                </Button>\r\n              </AlertDialogTrigger>\r\n              <AlertDialogContent className=\"bg-slate-950 border-white/10 text-white rounded-[32px] p-8\">\r\n                <AlertDialogHeader>\r\n                  <AlertDialogTitle className=\"text-2xl font-black tracking-tight flex items-center gap-3\">\r\n                    <div className=\"p-2 rounded-full bg-rose-500/20 text-rose-500\">\r\n                      <AlertOctagon className=\"w-6 h-6\" />\r\n                    </div>\r\n                    Irreversible Action?\r\n                  </AlertDialogTitle>\r\n                  <AlertDialogDescription className=\"text-slate-400 font-medium leading-relaxed mt-4\">\r\n                    Your account will be <span className=\"text-white font-bold italic\">deactivated immediately</span> and scheduled for permanent deletion in <span className=\"text-white font-bold\">30 days</span>.\r\n                    <br /><br />\r\n                    Log in anytime before then to cancel this request and restore your data node.\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter className=\"mt-8 gap-3\">\r\n                  <AlertDialogCancel className=\"h-14 flex-1 rounded-2xl bg-white/5 border-white/10 text-slate-400 hover:bg-white/10 hover:text-white font-black uppercase tracking-widest transition-all\">\r\n                    Abort\r\n                  </AlertDialogCancel>\r\n                  <AlertDialogAction\r\n                    onClick={async () => {\r\n                      await scheduleAccountDeletion();\r\n                      onClose();\r\n                    }}\r\n                    className=\"h-14 flex-1 rounded-2xl bg-rose-600 hover:bg-rose-500 text-white font-black uppercase tracking-widest shadow-lg shadow-rose-500/20 transition-all active:scale-95\"\r\n                  >\r\n                    Confirm Purge\r\n                  </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n          </div>\r\n        </div>\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\FundAllocationDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\GoalsTracker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\InsightsCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\InvestmentsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\LiabilityDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\LiabilityTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\LoadingSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\MoreTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\NotificationsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\PullToRefresh.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\QuoteOfTheDay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\RecurringTransactions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":462,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":462,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Card } from './ui/card';\r\nimport { Button } from './ui/button';\r\nimport { Input } from './ui/input';\r\nimport { Label } from './ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from './ui/dialog';\r\nimport { Plus, Trash2, RefreshCw, Calendar, Sparkles, ArrowUpRight, Wallet, Target, Edit2, TrendingDown } from 'lucide-react';\r\nimport { MONEY_OUT_CATEGORIES, RecurringTransaction } from '../types';\r\nimport { useFinance } from '../context/FinanceContext';\r\nimport { formatCurrency } from '../utils/numberFormat';\r\nimport { MeshBackground } from './ui/MeshBackground';\r\nimport { SubscriptionStrategist } from './SubscriptionStrategist';\r\nimport { LiabilityDashboard } from './LiabilityDashboard';\r\nimport { toast } from 'sonner';\r\n\r\nexport function RecurringTransactions() {\r\n  const {\r\n    accounts,\r\n    currency,\r\n    recurringTransactions: recurring,\r\n    liabilities,\r\n    debts,\r\n    createRecurringTransaction,\r\n    updateRecurringTransaction,\r\n    deleteRecurringTransaction,\r\n    processRecurringTransactions,\r\n    createLiability,\r\n    updateLiability\r\n  } = useFinance();\r\n\r\n  const [viewMode, setViewMode] = useState<'list' | 'strategist' | 'debt'>('list');\r\n\r\n  // Calculate total monthly income for Strategist\r\n  // Note: This is an approximation based on recurring incomes. Ideally usage of actual monthly income logic.\r\n  const totalMonthlyIncome = recurring\r\n    .filter(r => r.type === 'income')\r\n    .reduce((sum, r) => {\r\n      let amt = r.amount;\r\n      if (r.frequency === 'yearly') amt = r.amount / 12;\r\n      if (r.frequency === 'weekly') amt = r.amount * 4;\r\n      return sum + amt;\r\n    }, 0);\r\n\r\n  const getFrequencyLabel = (freq: string) => {\r\n    const labels: Record<string, string> = {\r\n      daily: 'Daily',\r\n      weekly: 'Weekly',\r\n      monthly: 'Monthly',\r\n      yearly: 'Yearly'\r\n    };\r\n    return labels[freq] || freq;\r\n  };\r\n\r\n  // Helper component for categorized lists\r\n  const RecurringCard = ({ rec }: { rec: RecurringTransaction }) => {\r\n    const account = accounts.find(a => a.id === rec.accountId);\r\n    const liability = liabilities.find(l => l.id === rec.liabilityId);\r\n    const progress = liability ? Math.max(0, Math.min(100, ((liability.principal - liability.outstanding) / liability.principal) * 100)) : 0;\r\n\r\n    return (\r\n      <Card className=\"p-6 bg-slate-900/40 border-white/5 rounded-[28px] border hover:bg-slate-900/60 transition-all duration-300 group relative overflow-hidden\">\r\n        <div className={`absolute top-0 right-0 w-24 h-24 blur-3xl opacity-5 -mr-12 -mt-12 transition-opacity group-hover:opacity-20 ${rec.type === 'income' ? 'bg-emerald-500' : 'bg-rose-500'}`} />\r\n\r\n        <div className=\"flex items-start justify-between mb-8 relative z-10\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className={`w-14 h-14 border border-white/5 rounded-2xl flex items-center justify-center shadow-inner group-hover:scale-105 transition-transform text-2xl ${rec.type === 'income' ? 'bg-emerald-500/10 text-emerald-400' : 'bg-rose-500/10 text-rose-400'\r\n              }`}>\r\n              {rec.type === 'income' ? '💰' : liability ? '🏦' : '💸'}\r\n            </div>\r\n            <div className=\"min-w-0\">\r\n              <h3 className=\"text-base font-bold text-slate-100 truncate flex items-center gap-2\">\r\n                {rec.description || rec.source}\r\n              </h3>\r\n              <p className=\"text-[10px] uppercase font-black tracking-widest text-slate-600 mt-1\">\r\n                {getFrequencyLabel(rec.frequency)} {liability && '• Loan'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex bg-slate-900/80 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => handleEdit(rec)}\r\n              className=\"w-10 h-10 p-0 rounded-l-xl hover:bg-slate-800 text-slate-500 hover:text-indigo-400\"\r\n            >\r\n              <Edit2 className=\"w-4 h-4\" />\r\n            </Button>\r\n            <div className=\"w-px bg-white/10 my-2\" />\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => handleDelete(rec)}\r\n              className=\"w-10 h-10 p-0 rounded-r-xl hover:bg-rose-500/10 hover:text-rose-400 text-slate-500 hover:text-rose-400\"\r\n            >\r\n              <Trash2 className=\"w-4 h-4\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-6 relative z-10\">\r\n          <div className=\"flex justify-between items-end\">\r\n            <div className=\"flex flex-col\">\r\n              <span className=\"text-[10px] uppercase tracking-widest font-black text-slate-600 mb-1 font-mono\">{liability ? 'Monthly EMI' : 'Commitment'}</span>\r\n              <span className={`text-2xl font-black tabular-nums leading-none font-mono ${rec.type === 'income' ? 'text-emerald-400' : 'text-slate-100'}`}>\r\n                {rec.type === 'income' ? '+' : '-'}{formatCurrency(rec.amount, currency)}\r\n              </span>\r\n            </div>\r\n            <div className=\"text-right flex flex-col items-end\">\r\n              <span className=\"text-[10px] uppercase tracking-widest font-black text-slate-600 mb-1\">Wallet</span>\r\n              <span className=\"text-xs font-bold text-slate-300 flex items-center gap-1.5 bg-white/5 px-2 py-1 rounded-lg\">\r\n                {account?.icon} {account?.name}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          {liability && (\r\n            <div className=\"pt-4 space-y-3\">\r\n              <div className=\"flex justify-between items-end\">\r\n                <p className=\"text-[10px] uppercase font-black text-rose-500/60 tracking-wider\">Debt Clearance</p>\r\n                <div className=\"text-right\">\r\n                  <p className=\"text-xs font-black text-slate-300 tabular-nums\">{progress.toFixed(0)}%</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"w-full h-1.5 bg-white/5 rounded-full overflow-hidden\">\r\n                <div\r\n                  className=\"h-full bg-gradient-to-r from-rose-500 to-orange-400 transition-all duration-1000\"\r\n                  style={{ width: `${progress}%` }}\r\n                />\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <div className=\"flex flex-col\">\r\n                  <span className=\"text-[9px] font-bold text-slate-600 uppercase\">Outstanding</span>\r\n                  <span className=\"text-[11px] font-black text-rose-400/80\">{formatCurrency(liability.outstanding, currency)}</span>\r\n                </div>\r\n                <div className=\"flex flex-col text-right\">\r\n                  <span className=\"text-[9px] font-bold text-slate-600 uppercase\">Remaining</span>\r\n                  <span className=\"text-[11px] font-black text-slate-400\">{liability.tenure} Months</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"pt-6 border-t border-white/5 flex items-center justify-between\">\r\n            <div className=\"flex flex-col gap-1\">\r\n              <div className=\"flex items-center gap-2 text-slate-500\">\r\n                <Calendar className=\"w-3 h-3\" />\r\n                <span className=\"text-[9px] font-black uppercase tracking-wider\">Timeline</span>\r\n              </div>\r\n              <div className=\"text-[10px] font-bold text-slate-300\">\r\n                {new Date(rec.startDate).toLocaleDateString(undefined, { month: 'short', year: 'numeric' })}\r\n                {rec.endDate ? ` — ${new Date(rec.endDate).toLocaleDateString(undefined, { month: 'short', year: 'numeric' })}` : ' — Ongoing'}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              {rec.category && (\r\n                <div className=\"bg-slate-800/50 px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest text-slate-500 border border-white/5\">\r\n                  {rec.category}\r\n                </div>\r\n              )}\r\n              <div className=\"w-8 h-8 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-lg shadow-inner\">\r\n                {account?.icon || '🏦'}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [showInsights, setShowInsights] = useState(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n\r\n  const [formData, setFormData] = useState({\r\n    type: 'expense' as 'expense' | 'income',\r\n    description: '',\r\n    source: '',\r\n    amount: '',\r\n    category: '',\r\n    accountId: accounts.length > 0 ? accounts[0].id : '',\r\n    frequency: 'monthly' as RecurringTransaction['frequency'],\r\n    startDate: new Date().toISOString().split('T')[0],\r\n    endDate: '',\r\n    tags: [] as string[],\r\n    // Liability fields\r\n    principal: '',\r\n    interestRate: '',\r\n    tenure: '',\r\n    liabilityId: ''\r\n  });\r\n\r\n  // Smart Detection Logic\r\n  useEffect(() => {\r\n    const name = (formData.type === 'expense' ? formData.description : formData.source).toLowerCase().trim();\r\n    if (!name || editingId) return;\r\n\r\n    const subKeywords = ['netflix', 'spotify', 'prime', 'youtube', 'apple', 'hulu', 'disney', 'google', 'icloud', 'adobe', 'canva', 'figma', 'chatgpt', 'openai', 'claude', 'midjourney', 'github', 'cursor'];\r\n    const emiKeywords = ['emi', 'loan', 'mortgage', 'bajaj', 'hdfc loan', 'sbi loan', 'icici loan', 'finance'];\r\n\r\n    if (subKeywords.some(kw => name.includes(kw))) {\r\n      if (formData.type !== 'expense' || formData.category !== 'Subscription') {\r\n        queueMicrotask(() => {\r\n          setFormData(prev => ({\r\n            ...prev,\r\n            type: 'expense',\r\n            category: 'Subscription',\r\n            description: prev.source || prev.description // Sync name if switched\r\n          }));\r\n        });\r\n        toast.info(`Smart Detection: Categorized as Subscription`, { icon: '🤖' });\r\n      }\r\n    } else if (emiKeywords.some(kw => name.includes(kw))) {\r\n      if (formData.type !== 'expense' || formData.category !== 'EMI') {\r\n        queueMicrotask(() => {\r\n          setFormData(prev => ({\r\n            ...prev,\r\n            type: 'expense',\r\n            category: 'EMI',\r\n            description: prev.source || prev.description\r\n          }));\r\n        });\r\n        toast.info(`Smart Detection: Categorized as EMI`, { icon: '🤖' });\r\n      }\r\n    }\r\n  }, [formData.description, formData.source, formData.type, formData.category, editingId]);\r\n\r\n  const handleCreateRecurring = async () => {\r\n    const data: any = {\r\n      type: formData.type,\r\n      amount: parseFloat(formData.amount),\r\n      accountId: formData.accountId,\r\n      frequency: formData.frequency,\r\n      startDate: formData.startDate,\r\n      endDate: formData.endDate || undefined,\r\n      tags: formData.tags\r\n    };\r\n\r\n    if (formData.type === 'expense') {\r\n      data.description = formData.description;\r\n      data.category = formData.category;\r\n    } else {\r\n      data.source = formData.source;\r\n    }\r\n\r\n    if (editingId) {\r\n      await updateRecurringTransaction(editingId, data);\r\n\r\n      // If linked to a liability, update that too\r\n      if (formData.liabilityId) {\r\n        await updateLiability(formData.liabilityId, {\r\n          name: formData.type === 'expense' ? formData.description : formData.source,\r\n          principal: parseFloat(formData.principal) || 0,\r\n          interestRate: parseFloat(formData.interestRate) || 0,\r\n          emiAmount: parseFloat(formData.amount) || 0,\r\n          tenure: parseInt(formData.tenure) || 0,\r\n          accountId: formData.accountId\r\n        });\r\n      }\r\n    } else {\r\n      if (formData.category === 'EMI' || formData.category === 'Loan') {\r\n        // Create as Liability (which will auto-create recurring)\r\n        await createLiability({\r\n          name: formData.type === 'expense' ? formData.description : formData.source,\r\n          type: 'loan',\r\n          principal: parseFloat(formData.principal) || parseFloat(formData.amount),\r\n          outstanding: parseFloat(formData.principal) || parseFloat(formData.amount),\r\n          interestRate: parseFloat(formData.interestRate) || 0,\r\n          emiAmount: parseFloat(formData.amount),\r\n          startDate: formData.startDate,\r\n          tenure: parseInt(formData.tenure) || 12,\r\n          accountId: formData.accountId,\r\n          createdAt: new Date().toISOString()\r\n        });\r\n      } else {\r\n        await createRecurringTransaction(data);\r\n      }\r\n    }\r\n    setIsAddDialogOpen(false);\r\n    resetForm();\r\n  };\r\n\r\n  const handleEdit = (rec: RecurringTransaction) => {\r\n    setFormData({\r\n      type: rec.type,\r\n      description: rec.description || '',\r\n      source: rec.source || '',\r\n      amount: rec.amount.toString(),\r\n      category: rec.category || '',\r\n      accountId: rec.accountId,\r\n      frequency: rec.frequency,\r\n      startDate: rec.startDate.split('T')[0],\r\n      endDate: rec.endDate ? rec.endDate.split('T')[0] : '',\r\n      tags: rec.tags || [],\r\n      principal: '',\r\n      interestRate: '',\r\n      tenure: '',\r\n      liabilityId: rec.liabilityId || ''\r\n    });\r\n\r\n    const liability = liabilities.find(l => l.id === rec.liabilityId);\r\n    if (liability) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        principal: liability.principal.toString(),\r\n        interestRate: liability.interestRate.toString(),\r\n        tenure: liability.tenure.toString()\r\n      }));\r\n    }\r\n    setEditingId(rec.id);\r\n    setIsAddDialogOpen(true);\r\n  };\r\n\r\n  const handleProcess = async () => {\r\n    setIsProcessing(true);\r\n    await processRecurringTransactions();\r\n    setIsProcessing(false);\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      type: 'expense',\r\n      description: '',\r\n      source: '',\r\n      amount: '',\r\n      category: '',\r\n      accountId: accounts.length > 0 ? accounts[0].id : '',\r\n      frequency: 'monthly',\r\n      startDate: new Date().toISOString().split('T')[0],\r\n      endDate: '',\r\n      tags: [],\r\n      principal: '',\r\n      interestRate: '',\r\n      tenure: '',\r\n      liabilityId: ''\r\n    });\r\n    setEditingId(null);\r\n  };\r\n\r\n  const handleDelete = async (rec: RecurringTransaction) => {\r\n    if (rec.liabilityId) {\r\n      const confirmDelete = window.confirm(`Deleting this flow will also remove the linked liability \"${rec.description || 'Loan'}\". Continue?`);\r\n      if (confirmDelete) {\r\n        await deleteLiability(rec.liabilityId);\r\n        toast.success('Liability and flow removed');\r\n      }\r\n    } else {\r\n      await deleteRecurringTransaction(rec.id);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  // Filter out zero/null amount transactions\r\n  const filteredRecurring = recurring.filter(r => r.amount && r.amount > 0);\r\n\r\n  const getCategorizedData = () => {\r\n    const loans = filteredRecurring.filter(r =>\r\n      r.category === 'EMI' ||\r\n      (r.description || '').toLowerCase().includes('loan') ||\r\n      (r.source || '').toLowerCase().includes('loan')\r\n    );\r\n    const subscriptions = filteredRecurring.filter(r =>\r\n      r.category === 'Subscription' ||\r\n      (r.description || '').toLowerCase().includes('subscription') ||\r\n      (r.source || '').toLowerCase().includes('subscription') ||\r\n      ['netflix', 'spotify', 'prime', 'youtube', 'apple', 'hulu', 'disney', 'google'].some(kw =>\r\n        (r.description || '').toLowerCase().includes(kw) ||\r\n        (r.source || '').toLowerCase().includes(kw)\r\n      )\r\n    );\r\n    const incomes = filteredRecurring.filter(r => r.type === 'income');\r\n    const others = filteredRecurring.filter(r =>\r\n      !loans.some(l => l.id === r.id) &&\r\n      !subscriptions.some(s => s.id === r.id) &&\r\n      !incomes.some(i => i.id === r.id)\r\n    );\r\n\r\n    return { loans, subscriptions, incomes, others };\r\n  };\r\n\r\n  const categorized = getCategorizedData();\r\n\r\n  const getAIInsights = () => {\r\n    const calculateMonthly = (r: RecurringTransaction) => {\r\n      const amt = r.amount || 0;\r\n      if (r.frequency === 'monthly') return amt;\r\n      if (r.frequency === 'yearly') return amt / 12;\r\n      if (r.frequency === 'weekly') return amt * 4;\r\n      return amt * 30; // daily\r\n    };\r\n\r\n    const loanTotal = categorized.loans.reduce((sum, r) => sum + calculateMonthly(r), 0);\r\n    const subTotal = categorized.subscriptions.reduce((sum, r) => sum + calculateMonthly(r), 0);\r\n    const incomeTotal = categorized.incomes.reduce((sum, r) => sum + calculateMonthly(r), 0);\r\n    const otherTotal = categorized.others.reduce((sum, r) => sum + calculateMonthly(r), 0);\r\n\r\n    const totalOutflow = loanTotal + subTotal + otherTotal;\r\n    const netMonthly = incomeTotal - totalOutflow;\r\n\r\n    // Health Score calculation: Ratio of surplus to total income\r\n    const healthScore = incomeTotal > 0\r\n      ? Math.max(0, Math.min(100, (netMonthly / incomeTotal) * 100))\r\n      : 0;\r\n\r\n    return {\r\n      loanTotal,\r\n      subTotal,\r\n      incomeTotal,\r\n      otherTotal,\r\n      totalOutflow,\r\n      netMonthly,\r\n      healthScore,\r\n      totalActive: filteredRecurring.length\r\n    };\r\n  };\r\n\r\n  const insights = getAIInsights();\r\n\r\n  return (\r\n    <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700\">\r\n\r\n      {/* Mode Toggle */}\r\n      <div className=\"flex justify-center mb-6\">\r\n        <div className=\"bg-slate-900/60 p-1 rounded-2xl flex gap-1 border border-white/5\">\r\n          <button\r\n            onClick={() => setViewMode('list')}\r\n            className={`px-6 py-2 rounded-xl text-sm font-bold transition-all ${viewMode === 'list' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}\r\n          >\r\n            Flow List\r\n          </button>\r\n          <button\r\n            onClick={() => setViewMode('strategist')}\r\n            className={`px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2 ${viewMode === 'strategist' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}\r\n          >\r\n            <Target className=\"w-3.5 h-3.5\" />\r\n            Strategist\r\n          </button>\r\n          <button\r\n            onClick={() => setViewMode('debt')}\r\n            className={`px-4 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2 ${viewMode === 'debt' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}\r\n          >\r\n            <TrendingDown className=\"w-3.5 h-3.5\" />\r\n            Debt Node\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {viewMode === 'debt' ? (\r\n        <LiabilityDashboard\r\n          liabilities={liabilities}\r\n          debts={debts}\r\n          currency={currency}\r\n          totalMonthlyIncome={totalMonthlyIncome || 1}\r\n        />\r\n      ) : viewMode === 'strategist' ? (\r\n        <SubscriptionStrategist\r\n          recurring={recurring}\r\n          currency={currency}\r\n          totalMonthlyIncome={totalMonthlyIncome}\r\n          onDelete={(id, _) => {\r\n            deleteRecurringTransaction(id);\r\n            // toast.success(`Cancelled ${desc}`); // Done in context typically\r\n          }}\r\n        />\r\n      ) : (\r\n        <>\r\n          {/* Summary Dashboard Card - Aligned with History Tab */}\r\n          <div className=\"frosted-plate rounded-[32px] border border-white/5 relative overflow-hidden p-8 shadow-2xl\">\r\n            <MeshBackground variant=\"spending\" />\r\n\r\n            <div className=\"relative z-10\">\r\n              {/* Header Section */}\r\n              <div className=\"flex items-center justify-between mb-8\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-10 h-10 bg-cyan-500/10 rounded-xl flex items-center justify-center border border-cyan-500/20\">\r\n                    <RefreshCw className=\"w-5 h-5 text-cyan-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-slate-100 font-bold text-xs uppercase tracking-widest font-mono\">Flow Analysis</h3>\r\n                    <p className=\"text-[10px] text-slate-500 uppercase tracking-tighter\">\r\n                      Monthly Leftover Cash\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                  <p className=\"text-[10px] text-slate-500 uppercase tracking-wider font-extrabold font-mono\">Total Commitments</p>\r\n                  <p className=\"text-sm font-black text-white tabular-nums font-mono\">\r\n                    {insights.totalActive} Active\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex flex-col md:flex-row items-center justify-between gap-12\">\r\n                <div className=\"space-y-2 text-center md:text-left\">\r\n                  <p className=\"text-slate-400 text-xs font-black uppercase tracking-widest font-mono\">Projected Monthly Surplus</p>\r\n                  <h1 className=\"text-5xl md:text-6xl font-black tracking-tighter tabular-nums text-white font-mono\">\r\n                    {insights.netMonthly >= 0 ? '+' : ''}{formatCurrency(insights.netMonthly, currency)}\r\n                  </h1>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 w-full md:w-auto\">\r\n                  {/* Loan EMIs */}\r\n                  <div className=\"bg-slate-800/40 backdrop-blur-md px-6 py-4 rounded-3xl border border-white/5 text-center flex flex-col items-center justify-center min-w-[140px]\">\r\n                    <p className=\"text-[10px] uppercase font-black text-slate-500 mb-1 font-mono tracking-widest\">Loan EMIs</p>\r\n                    <div className=\"flex flex-col items-center\">\r\n                      <span className=\"text-2xl font-black leading-none text-rose-400/80 font-mono mb-1\">-</span>\r\n                      <span className=\"font-black text-lg text-rose-400 font-mono tabular-nums\">{formatCurrency(Math.abs(insights.loanTotal), currency)}</span>\r\n                    </div>\r\n                  </div>\r\n                  {/* Subscriptions */}\r\n                  <div className=\"bg-slate-800/40 backdrop-blur-md px-6 py-4 rounded-3xl border border-white/5 text-center flex flex-col items-center justify-center min-w-[140px]\">\r\n                    <p className=\"text-[10px] uppercase font-black text-slate-500 mb-1 font-mono tracking-widest\">Subscriptions</p>\r\n                    <div className=\"flex flex-col items-center\">\r\n                      <span className=\"text-2xl font-black leading-none text-indigo-400/80 font-mono mb-1\">-</span>\r\n                      <span className=\"font-black text-lg text-indigo-400 font-mono tabular-nums\">{formatCurrency(Math.abs(insights.subTotal), currency)}</span>\r\n                    </div>\r\n                  </div>\r\n                  {/* Recur. Income */}\r\n                  <div className=\"bg-slate-800/40 backdrop-blur-md px-6 py-4 rounded-3xl border border-white/5 text-center flex flex-col items-center justify-center min-w-[140px]\">\r\n                    <p className=\"text-[10px] uppercase font-black text-slate-500 mb-1 font-mono tracking-widest\">Recur. Income</p>\r\n                    <div className=\"flex flex-col items-center\">\r\n                      <span className=\"text-2xl font-black leading-none text-emerald-400/80 font-mono mb-1\">+</span>\r\n                      <span className=\"font-black text-lg text-emerald-400 font-mono tabular-nums\">{formatCurrency(Math.abs(insights.incomeTotal), currency)}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Actions Row */}\r\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4 px-4 sticky top-0 z-30 py-2 bg-slate-950/80 backdrop-blur-md rounded-2xl border border-white/5\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"w-1.5 h-6 bg-indigo-500 rounded-full shadow-[0_0_15px_rgba(99,102,241,0.5)]\" />\r\n              <p className=\"text-[10px] font-black uppercase tracking-[0.3em] text-slate-500\">Commitment Stream</p>\r\n            </div>\r\n            <div className=\"flex items-center gap-2 w-full sm:w-auto\">\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={handleProcess}\r\n                disabled={isProcessing || recurring.length === 0}\r\n                className=\"flex-1 sm:flex-initial rounded-xl border border-white/5 hover:bg-slate-900/40 font-bold text-slate-400 hover:text-slate-100 px-4 h-10 text-xs\"\r\n              >\r\n                <RefreshCw className={`w-3.5 h-3.5 mr-2 ${isProcessing ? 'animate-spin' : ''}`} />\r\n                Sync\r\n              </Button>\r\n              <Button\r\n                onClick={() => setIsAddDialogOpen(true)}\r\n                size=\"sm\"\r\n                className=\"flex-1 sm:flex-initial bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl px-6 h-10 font-bold shadow-lg shadow-indigo-600/20 transition-all active:scale-95 text-xs\"\r\n              >\r\n                <Plus className=\"w-3.5 h-3.5 mr-2\" />\r\n                Add New\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* AI Insights Bar */}\r\n          {recurring.length > 0 && (\r\n            <div className=\"px-4\">\r\n              <div className=\"bg-slate-900/40 border border-white/5 rounded-2xl p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"w-10 h-10 bg-indigo-500/10 rounded-xl flex items-center justify-center\">\r\n                    <Sparkles className=\"w-5 h-5 text-indigo-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-xs font-black uppercase tracking-widest text-slate-500 mb-0.5 font-mono\">Net Monthly Flow</p>\r\n                    <h4 className={`text-lg font-black tabular-nums leading-none font-mono ${insights.netMonthly >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>\r\n                      {insights.netMonthly >= 0 ? '+' : ''}{formatCurrency(insights.netMonthly, currency)}\r\n                    </h4>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4 border-t sm:border-t-0 sm:border-l border-white/5 pt-4 sm:pt-0 sm:pl-6\">\r\n                  <div className=\"space-y-0.5\">\r\n                    <p className=\"text-[10px] uppercase font-black text-slate-600\">Shadow Health</p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className={`font-black text-lg tabular-nums ${insights.healthScore > 60 ? 'text-emerald-400' :\r\n                        insights.healthScore > 30 ? 'text-indigo-400' : 'text-rose-400'\r\n                        }`}>\r\n                        {Math.round(insights.healthScore)}%\r\n                      </span>\r\n                      <div className=\"px-2 py-0.5 rounded bg-white/5 border border-white/5\">\r\n                        <span className=\"text-[9px] font-black uppercase tracking-tight text-slate-400\">\r\n                          {insights.healthScore >= 80 ? 'Elite' :\r\n                            insights.healthScore >= 60 ? 'Strong' :\r\n                              insights.healthScore >= 40 ? 'Stable' :\r\n                                insights.healthScore >= 20 ? 'Warning' : 'Critical'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex gap-0.5 ml-1\">\r\n                        {[1, 2, 3, 4, 5].map(i => (\r\n                          <div\r\n                            key={i}\r\n                            className={`w-1.5 h-3 rounded-full transition-colors duration-500 ${(insights.healthScore / 20) >= i\r\n                              ? (insights.healthScore > 60 ? 'bg-emerald-500' : insights.healthScore > 30 ? 'bg-indigo-500' : 'bg-rose-500')\r\n                              : 'bg-slate-800'\r\n                              }`}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => setShowInsights(!showInsights)}\r\n                    className=\"text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-xl font-bold\"\r\n                  >\r\n                    {showInsights ? 'Hide Analysis' : 'Show Analysis'}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n\r\n              {showInsights && (\r\n                <div className=\"mt-4 animate-in zoom-in-95 duration-300 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <Card className=\"bg-slate-900/40 border-white/5 p-4 rounded-2xl\">\r\n                    <div className=\"flex items-center gap-3 mb-2 opacity-50\">\r\n                      <Wallet className=\"w-4 h-4\" />\r\n                      <span className=\"text-[10px] font-black uppercase tracking-[0.2em]\">Total Outflow</span>\r\n                    </div>\r\n                    <p className=\"text-xl font-black text-rose-400\">{formatCurrency(insights.totalOutflow, currency)}</p>\r\n                  </Card>\r\n                  <Card className=\"bg-slate-900/40 border-white/5 p-4 rounded-2xl\">\r\n                    <div className=\"flex items-center gap-3 mb-2 opacity-50\">\r\n                      <ArrowUpRight className=\"w-4 h-4\" />\r\n                      <span className=\"text-[10px] font-black uppercase tracking-[0.2em]\">Total Inflow</span>\r\n                    </div>\r\n                    <p className=\"text-xl font-black text-emerald-400\">{formatCurrency(insights.incomeTotal, currency)}</p>\r\n                  </Card>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Main Content */}\r\n          <div className=\"px-4 pb-20 space-y-12\">\r\n            {filteredRecurring.length === 0 ? (\r\n              <Card className=\"py-24 text-center bg-slate-800/20 rounded-[40px] border border-dashed border-white/10\">\r\n                <Calendar className=\"w-20 h-20 mx-auto text-slate-700 mb-6\" />\r\n                <h3 className=\"text-2xl font-black text-slate-200 mb-3\">No Active Commitments</h3>\r\n                <p className=\"text-sm text-slate-500 font-bold mb-10 max-w-[320px] mx-auto leading-relaxed\">\r\n                  Set up your subscriptions, EMIs, and monthly income to unlock deep financial insights.\r\n                </p>\r\n                <Button\r\n                  onClick={() => setIsAddDialogOpen(true)}\r\n                  className=\"bg-indigo-600/10 hover:bg-indigo-600/20 text-indigo-400 border border-indigo-600/20 rounded-2xl px-10 h-14 font-black\"\r\n                >\r\n                  <Plus className=\"w-5 h-5 mr-3\" />\r\n                  Add First Commitment\r\n                </Button>\r\n              </Card>\r\n            ) : (\r\n              <>\r\n                {/* Category: Income */}\r\n                {categorized.incomes.length > 0 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center gap-3 border-l-4 border-emerald-500 pl-4 py-1\">\r\n                      <h3 className=\"text-xl font-black text-slate-100 uppercase tracking-tight font-mono\">Recurring Income</h3>\r\n                      <span className=\"bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded text-[10px] font-black font-mono\">{categorized.incomes.length} SOURCE(S)</span>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                      {categorized.incomes.map((rec, idx) => <RecurringCard key={`${rec.id}-${idx}`} rec={rec} />)}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Category: Loans */}\r\n                {categorized.loans.length > 0 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center gap-3 border-l-4 border-rose-500 pl-4 py-1\">\r\n                      <h3 className=\"text-xl font-black text-slate-100 uppercase tracking-tight font-mono\">Loan EMIs</h3>\r\n                      <span className=\"bg-rose-500/10 text-rose-400 px-2 py-0.5 rounded text-[10px] font-black font-mono\">{categorized.loans.length} COMMITMENT(S)</span>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                      {categorized.loans.map((rec, idx) => <RecurringCard key={`${rec.id}-${idx}`} rec={rec} />)}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Category: Subscriptions */}\r\n                {categorized.subscriptions.length > 0 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center gap-3 border-l-4 border-indigo-500 pl-4 py-1\">\r\n                      <h3 className=\"text-xl font-black text-slate-100 uppercase tracking-tight font-mono\">Active Subscriptions</h3>\r\n                      <span className=\"bg-indigo-500/10 text-indigo-400 px-2 py-0.5 rounded text-[10px] font-black font-mono\">{categorized.subscriptions.length} SERVICE(S)</span>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                      {categorized.subscriptions.map((rec, idx) => <RecurringCard key={`${rec.id}-${idx}`} rec={rec} />)}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Category: Others */}\r\n                {categorized.others.length > 0 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"flex items-center gap-3 border-l-4 border-slate-500 pl-4 py-1\">\r\n                      <h3 className=\"text-xl font-black text-slate-100 uppercase tracking-tight\">Other Commitments</h3>\r\n                      <span className=\"bg-slate-500/10 text-slate-400 px-2 py-0.5 rounded text-[10px] font-black\">{categorized.others.length} ITEM(S)</span>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                      {categorized.others.map((rec, idx) => <RecurringCard key={`${rec.id}-${idx}`} rec={rec} />)}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          {/* Add Dialog */}\r\n          <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\r\n            <DialogContent className=\"max-w-md bg-slate-950 border-white/10 text-white rounded-[32px]\">\r\n              <DialogHeader>\r\n                <DialogTitle className=\"text-2xl font-black tracking-tight text-white\">\r\n                  {editingId ? 'Edit Commitment' : 'Create New Commitment'}\r\n                </DialogTitle>\r\n                <DialogDescription className=\"text-slate-400 font-bold\">\r\n                  {editingId ? 'Modify existing flow parameters.' : 'Automate your financial shadow-wallets.'}\r\n                </DialogDescription>\r\n              </DialogHeader>\r\n              <div className=\"space-y-6 mt-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div\r\n                    className={`p-4 rounded-2xl border-2 cursor-pointer transition-all ${formData.type === 'income' ? 'border-emerald-500 bg-emerald-500/10' : 'border-white/5 bg-white/5 hover:border-white/10'}`}\r\n                    onClick={() => setFormData({ ...formData, type: 'income' })}\r\n                  >\r\n                    <div className=\"w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center text-xl mb-2\">💰</div>\r\n                    <p className=\"text-xs font-black uppercase text-white\">Money In</p>\r\n                    <p className=\"text-[10px] text-emerald-400 font-bold\">Salary / Gift</p>\r\n                  </div>\r\n                  <div\r\n                    className={`p-4 rounded-2xl border-2 cursor-pointer transition-all ${formData.type === 'expense' ? 'border-indigo-500 bg-indigo-500/10' : 'border-white/5 bg-white/5 hover:border-white/10'}`}\r\n                    onClick={() => setFormData({ ...formData, type: 'expense' })}\r\n                  >\r\n                    <div className=\"w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center text-xl mb-2\">💸</div>\r\n                    <p className=\"text-xs font-black uppercase text-white\">Money Out</p>\r\n                    <p className=\"text-[10px] text-indigo-400 font-bold\">Rent / Sub</p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"group\">\r\n                    <Label htmlFor=\"recurring-name\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Commitment Name</Label>\r\n                    <Input\r\n                      id=\"recurring-name\"\r\n                      name=\"description\"\r\n                      value={formData.type === 'expense' ? formData.description : formData.source}\r\n                      onChange={(e) => setFormData({\r\n                        ...formData,\r\n                        [formData.type === 'expense' ? 'description' : 'source']: e.target.value\r\n                      })}\r\n                      placeholder={formData.type === 'expense' ? 'e.g. Netflix, Rent' : 'e.g. Salary'}\r\n                      className=\"bg-white/5 border-white/5 rounded-xl h-12 focus:ring-indigo-500/50\"\r\n                      autoComplete=\"off\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label htmlFor=\"recurring-amount\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Amount</Label>\r\n                      <Input\r\n                        id=\"recurring-amount\"\r\n                        name=\"amount\"\r\n                        type=\"number\"\r\n                        value={formData.amount}\r\n                        onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\r\n                        placeholder=\"0.00\"\r\n                        className=\"bg-white/5 border-white/5 rounded-xl h-12\"\r\n                        autoComplete=\"off\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"recurring-frequency\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Frequency</Label>\r\n                      <Select value={formData.frequency} onValueChange={(value: any) => setFormData({ ...formData, frequency: value })}>\r\n                        <SelectTrigger id=\"recurring-frequency\" name=\"frequency\" className=\"bg-white/5 border-white/5 rounded-xl h-12\">\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                          <SelectItem value=\"monthly\">Monthly</SelectItem>\r\n                          <SelectItem value=\"weekly\">Weekly</SelectItem>\r\n                          <SelectItem value=\"daily\">Daily</SelectItem>\r\n                          <SelectItem value=\"yearly\">Yearly</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label htmlFor=\"recurring-account\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Funding Wallet</Label>\r\n                    <Select value={formData.accountId} onValueChange={(value: string) => setFormData({ ...formData, accountId: value })}>\r\n                      <SelectTrigger id=\"recurring-account\" name=\"accountId\" className=\"bg-white/5 border-white/5 rounded-xl h-12\">\r\n                        <SelectValue placeholder=\"Target Account\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                        {accounts.map((account) => (\r\n                          <SelectItem key={account.id} value={account.id}>\r\n                            {account.icon} {account.name}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  {formData.type === 'expense' && (\r\n                    <div>\r\n                      <Label htmlFor=\"recurring-category\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Category</Label>\r\n                      <Select value={formData.category} onValueChange={(value: string) => setFormData({ ...formData, category: value })}>\r\n                        <SelectTrigger id=\"recurring-category\" name=\"category\" className=\"bg-white/5 border-white/5 rounded-xl h-12\">\r\n                          <SelectValue placeholder=\"Purpose\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-slate-900 border-white/10 text-white max-h-[200px]\">\r\n                          {MONEY_OUT_CATEGORIES.map((cat) => (\r\n                            <SelectItem key={cat.value} value={cat.value}>\r\n                              {cat.emoji} {cat.value}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  )}\r\n\r\n                  {(formData.category === 'EMI' || formData.category === 'Loan' || formData.liabilityId) && (\r\n                    <div className=\"p-4 rounded-2xl bg-rose-500/5 border border-rose-500/10 space-y-4\">\r\n                      <p className=\"text-[10px] font-black uppercase tracking-widest text-rose-500/60 pl-1\">Liability Details</p>\r\n\r\n                      <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                          <Label htmlFor=\"liability-principal\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Principal</Label>\r\n                          <Input\r\n                            id=\"liability-principal\"\r\n                            type=\"number\"\r\n                            value={formData.principal}\r\n                            onChange={(e) => setFormData({ ...formData, principal: e.target.value })}\r\n                            placeholder=\"Total Loan\"\r\n                            className=\"bg-white/5 border-white/5 rounded-xl h-11 text-xs\"\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <Label htmlFor=\"liability-tenure\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Tenure (Mo)</Label>\r\n                          <Input\r\n                            id=\"liability-tenure\"\r\n                            type=\"number\"\r\n                            value={formData.tenure}\r\n                            onChange={(e) => setFormData({ ...formData, tenure: e.target.value })}\r\n                            placeholder=\"Months\"\r\n                            className=\"bg-white/5 border-white/5 rounded-xl h-11 text-xs\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label htmlFor=\"liability-rate\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Interest Rate (%)</Label>\r\n                        <Input\r\n                          id=\"liability-rate\"\r\n                          type=\"number\"\r\n                          value={formData.interestRate}\r\n                          onChange={(e) => setFormData({ ...formData, interestRate: e.target.value })}\r\n                          placeholder=\"Annual %\"\r\n                          className=\"bg-white/5 border-white/5 rounded-xl h-11 text-xs\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label htmlFor=\"recurring-start-date\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">Start Date</Label>\r\n                      <Input\r\n                        id=\"recurring-start-date\"\r\n                        name=\"startDate\"\r\n                        type=\"date\"\r\n                        value={formData.startDate}\r\n                        onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\r\n                        className=\"bg-white/5 border-white/5 rounded-xl h-12 text-xs\"\r\n                        autoComplete=\"off\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label htmlFor=\"recurring-end-date\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-2 block\">End Date (Optional)</Label>\r\n                      <Input\r\n                        id=\"recurring-end-date\"\r\n                        name=\"endDate\"\r\n                        type=\"date\"\r\n                        value={formData.endDate}\r\n                        onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}\r\n                        className=\"bg-white/5 border-white/5 rounded-xl h-12\"\r\n                        autoComplete=\"off\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-4 pt-4 relative z-10\">\r\n                  <Button variant=\"ghost\" onClick={() => setIsAddDialogOpen(false)} className=\"flex-1 rounded-2xl h-14 font-black text-slate-500 hover:bg-white/5\">\r\n                    Discard\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleCreateRecurring}\r\n                    className=\"flex-1 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl h-14 font-black shadow-lg shadow-indigo-600/20\"\r\n                    disabled={\r\n                      !formData.amount ||\r\n                      (!formData.description && !formData.source) ||\r\n                      !formData.accountId ||\r\n                      (formData.type === 'expense' && !formData.category)\r\n                    }\r\n                  >\r\n                    {editingId ? 'Update Flow' : 'Activate Flow'}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </DialogContent>\r\n          </Dialog>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\RecurringWidget.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadRecurring'. Either include it or remove the dependency array.","line":23,"column":6,"nodeType":"ArrayExpression","endLine":23,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadRecurring, userId]","fix":{"range":[821,829],"text":"[loadRecurring, userId]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\RoundUpDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\SubscriptionStrategist.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\TransactionForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_unused' is assigned a value but never used.","line":170,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":170,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Button } from './ui/button';\r\nimport { Input } from './ui/input';\r\nimport { NumberInput } from './ui/number-input';\r\nimport { Label } from './ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from './ui/dialog';\r\nimport { Badge } from './ui/badge';\r\nimport { X, Sparkles, TrendingUp, Users, Landmark } from 'lucide-react';\r\nimport { EXPENSE_CATEGORIES, Account, Liability } from '../types';\r\nimport { isTransfer } from '../utils/isTransfer';\r\nimport { Checkbox } from './ui/checkbox';\r\nimport { autoCategorize } from '../utils/autoCategorize';\r\nimport { formatCurrency } from '../utils/numberFormat';\r\nimport { calculateLoanDetails, calculateInvestmentDetails } from '../utils/financeCalculations';\r\nimport { Contacts } from '@capacitor-community/contacts';\r\nimport { Capacitor } from '@capacitor/core';\r\n\r\ninterface TransactionFormProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  type: 'expense' | 'income' | 'debt';\r\n  onSubmit: (data: any) => void;\r\n  initialData?: any;\r\n  accounts: Account[];\r\n  liabilities: Liability[];\r\n  currency: string;\r\n  roundUpEnabled?: boolean;\r\n}\r\n\r\nexport const TransactionForm: React.FC<TransactionFormProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  type,\r\n  onSubmit,\r\n  initialData,\r\n  accounts,\r\n  liabilities,\r\n  currency,\r\n  roundUpEnabled = true // Default to true if not provided\r\n}) => {\r\n  const [formData, setFormData] = useState({\r\n    description: '',\r\n    amount: '',\r\n    category: '',\r\n    source: '',\r\n    personName: '',\r\n    debtType: 'borrowed',\r\n    accountId: '',\r\n    date: new Date().toISOString().split('T')[0],\r\n    tags: [] as string[],\r\n    isRecurring: false,\r\n    frequency: 'monthly' as 'daily' | 'weekly' | 'monthly' | 'yearly' | 'custom',\r\n    endDate: '',\r\n    isIncomeGenerating: false,\r\n    justification: '',\r\n    debtDueDate: '',\r\n    // Loan Simulation Fields\r\n    principal: '',\r\n    interestRate: '',\r\n    tenure: '',\r\n    tenureUnit: 'months' as 'months' | 'years',\r\n    liabilityId: '',\r\n    investmentId: '',\r\n    registerAsLiability: false,\r\n    liabilityType: 'personal_loan' as Liability['type'],\r\n  });\r\n  const [tagInput, setTagInput] = useState('');\r\n  const [suggestedCategory, setSuggestedCategory] = useState<string | null>(null);\r\n  const [suggestedTags, setSuggestedTags] = useState<string[]>([]);\r\n  const [suggestedAmount, setSuggestedAmount] = useState<number | undefined>(undefined);\r\n  const [suggestedDescription, setSuggestedDescription] = useState<string | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n\r\n    if (initialData) {\r\n      queueMicrotask(() => {\r\n        setFormData({\r\n          description: initialData.description || '',\r\n          amount: initialData.amount?.toString() || '',\r\n          category: initialData.category || '',\r\n          source: initialData.source || '',\r\n          personName: initialData.personName || '',\r\n          debtType: initialData.type || 'borrowed',\r\n          accountId: initialData.accountId || '',\r\n          date: initialData.date || new Date().toISOString().split('T')[0],\r\n          tags: initialData.tags || [],\r\n          isRecurring: initialData.isRecurring || false,\r\n          frequency: initialData.frequency || 'monthly',\r\n          endDate: initialData.endDate || '',\r\n          isIncomeGenerating: initialData.isIncomeGenerating || false,\r\n          justification: initialData.justification || '',\r\n          debtDueDate: initialData.dueDate || '',\r\n          principal: initialData.principal?.toString() || '',\r\n          interestRate: initialData.interestRate?.toString() || '',\r\n          tenure: initialData.tenure?.toString() || '',\r\n          tenureUnit: initialData.tenureUnit || 'months',\r\n          liabilityId: initialData.liabilityId || '',\r\n          investmentId: initialData.investmentId || '',\r\n          registerAsLiability: initialData.registerAsLiability || false,\r\n          liabilityType: initialData.type || 'personal_loan',\r\n        });\r\n      });\r\n    } else if (accounts.length > 0 && !formData.accountId) {\r\n      // Auto-select first account for new transactions\r\n      queueMicrotask(() => {\r\n        setFormData(prev => ({ ...prev, accountId: accounts[0].id }));\r\n      });\r\n    }\r\n  }, [isOpen, initialData, accounts, formData.accountId]);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    const text = type === 'expense' ? formData.description :\r\n      type === 'income' ? formData.description :\r\n        formData.personName;\r\n\r\n    const suggestion = (text.length > 2 && !initialData) ? autoCategorize(text) : null;\r\n\r\n    if (text.length > 2 && !initialData) {\r\n      // 1. Check for Liability Matching (EMI/Loans)\r\n      const matchedLiability = liabilities.find(l =>\r\n        l.name.toLowerCase() === text.toLowerCase() ||\r\n        text.toLowerCase() === `emi: ${l.name.toLowerCase()}` ||\r\n        text.toLowerCase().includes(l.name.toLowerCase())\r\n      );\r\n\r\n      if (matchedLiability) {\r\n        try {\r\n          queueMicrotask(() => {\r\n            setSuggestedCategory('EMI');\r\n            setSuggestedTags(['emi', 'liability', matchedLiability.name.toLowerCase()]);\r\n            setSuggestedAmount(matchedLiability.emiAmount);\r\n            setSuggestedDescription(`EMI: ${matchedLiability.name}`);\r\n          });\r\n\r\n          const lStart = new Date(matchedLiability.startDate);\r\n          const currentMonth = new Date();\r\n          currentMonth.setDate(lStart.getDate());\r\n          const suggestedDateStr = currentMonth.toISOString().split('T')[0];\r\n          queueMicrotask(() => {\r\n            setFormData(prev => ({ ...prev, suggestedDate: suggestedDateStr, liabilityId: matchedLiability.id }));\r\n          });\r\n        } catch {\r\n          // Ignore date suggestion error\r\n        }\r\n      }\r\n    }\r\n    // Removed the else { setFormData(prev => ({ ...prev, liabilityId: '' })); } \r\n    // logic to allow manual selection to persist.\r\n\r\n    if (suggestion) {\r\n      queueMicrotask(() => {\r\n        setSuggestedCategory(suggestion.category);\r\n        setSuggestedTags(suggestion.tags);\r\n        setSuggestedAmount(suggestion.suggestedAmount);\r\n        setSuggestedDescription(suggestion.suggestedDescription);\r\n      });\r\n    } else {\r\n      queueMicrotask(() => {\r\n        setSuggestedCategory(null);\r\n        setSuggestedTags([]);\r\n        setSuggestedAmount(undefined);\r\n        setSuggestedDescription(undefined);\r\n        // Remove suggestedDate from formData without mutating state\r\n        setFormData(prev => {\r\n          if (!('suggestedDate' in (prev as any))) return prev;\r\n          const { suggestedDate: _unused, ...rest } = prev as any;\r\n          return rest;\r\n        });\r\n      });\r\n    }\r\n  }, [formData.description, formData.personName, type, initialData, liabilities]);\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!formData.accountId && accounts.length > 0) {\r\n      alert('Please select an account');\r\n      return;\r\n    }\r\n\r\n    let data: any = {\r\n      amount: parseFloat(formData.amount),\r\n      date: formData.date,\r\n      tags: formData.tags,\r\n      accountId: formData.accountId || (accounts.length > 0 ? accounts[0].id : ''),\r\n      isRecurring: formData.isRecurring,\r\n      frequency: formData.frequency,\r\n      customIntervalDays: (formData as any).customIntervalDays, // Pass custom interval\r\n      startDate: formData.date, // For recurring transactions\r\n      endDate: formData.endDate || undefined,\r\n      isIncomeGenerating: formData.isIncomeGenerating,\r\n      justification: formData.justification,\r\n      liabilityId: formData.liabilityId === 'new' ? undefined : (formData.liabilityId || undefined),\r\n      investmentId: formData.investmentId,\r\n      registerAsLiability: formData.registerAsLiability,\r\n      principal: formData.principal ? parseFloat(formData.principal) : undefined,\r\n      interestRate: formData.interestRate ? parseFloat(formData.interestRate) : undefined,\r\n      tenure: formData.tenure ? parseInt(formData.tenure) : undefined,\r\n      tenureUnit: formData.tenureUnit,\r\n      liabilityType: formData.liabilityType\r\n    };\r\n\r\n    if (type === 'expense') {\r\n      data = {\r\n        ...data,\r\n        description: formData.description,\r\n        category: formData.category,\r\n        roundUpAmount: (formData as any).roundUpAmount\r\n      };\r\n    } else if (type === 'income') {\r\n      data = {\r\n        ...data,\r\n        source: formData.description\r\n      };\r\n    } else if (type === 'debt') {\r\n      data = {\r\n        ...data,\r\n        personName: formData.personName,\r\n        type: formData.debtType,\r\n        dueDate: formData.debtDueDate || undefined\r\n      };\r\n    }\r\n\r\n    const selectedAccount = accounts.find(a => a.id === formData.accountId);\r\n    if (type === 'expense' && selectedAccount?.type === 'credit_card') {\r\n      // If user is paying INTO a credit card (Expense from somewhere else or just recording the repayment)\r\n      // Actually, an \"Expense\" from a bank account to a CC should be a Transfer.\r\n      // If they are in the context of the CC account adding an expense, it's a normal spend.\r\n      // BUT if they are adding a \"Credit Card Bill\" payment, it should be a transfer.\r\n      if (isTransfer({ description: formData.description, category: formData.category })) {\r\n        data.category = 'Transfer';\r\n      }\r\n    }\r\n\r\n    onSubmit(data);\r\n    handleClose();\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setFormData({\r\n      description: '',\r\n      amount: '',\r\n      category: '',\r\n      source: '',\r\n      personName: '',\r\n      debtType: 'borrowed',\r\n      accountId: accounts.length > 0 ? accounts[0].id : '',\r\n      date: new Date().toISOString().split('T')[0],\r\n      tags: [],\r\n      isRecurring: false,\r\n      frequency: 'monthly',\r\n      endDate: '',\r\n      isIncomeGenerating: false,\r\n      justification: '',\r\n      debtDueDate: '',\r\n      principal: '',\r\n      interestRate: '',\r\n      tenure: '',\r\n      tenureUnit: 'months',\r\n      liabilityId: '',\r\n      investmentId: '',\r\n      registerAsLiability: false,\r\n      liabilityType: 'personal_loan',\r\n    });\r\n    setTagInput('');\r\n    setSuggestedCategory(null);\r\n    setSuggestedTags([]);\r\n    setSuggestedAmount(undefined);\r\n    setSuggestedDescription(undefined);\r\n    onClose();\r\n  };\r\n\r\n  const handleAddTag = () => {\r\n    if (tagInput.trim() && !formData.tags.includes(tagInput.trim())) {\r\n      setFormData({ ...formData, tags: [...formData.tags, tagInput.trim()] });\r\n      setTagInput('');\r\n    }\r\n  };\r\n\r\n  const handleTagInputChange = (value: string) => {\r\n    // Check if comma is entered\r\n    if (value.includes(',')) {\r\n      const newTags = value\r\n        .split(',')\r\n        .map(t => t.trim())\r\n        .filter(t => t && !formData.tags.includes(t));\r\n\r\n      if (newTags.length > 0) {\r\n        setFormData({ ...formData, tags: [...formData.tags, ...newTags] });\r\n        setTagInput('');\r\n      }\r\n    } else {\r\n      setTagInput(value);\r\n    }\r\n  };\r\n\r\n  const handleRemoveTag = (tag: string) => {\r\n    setFormData({ ...formData, tags: formData.tags.filter(t => t !== tag) });\r\n  };\r\n\r\n  const applySuggestion = () => {\r\n    if (suggestedCategory) {\r\n      setFormData(prev => ({\r\n        ...prev,\r\n        category: suggestedCategory,\r\n        tags: [...new Set([...prev.tags, ...suggestedTags])],\r\n        amount: (suggestedAmount && !prev.amount) ? suggestedAmount.toString() : prev.amount,\r\n        description: suggestedDescription || prev.description,\r\n        // Auto-enable recurring for Subscription suggestions\r\n        isRecurring: (suggestedCategory === 'Subscription') ? true : prev.isRecurring,\r\n        frequency: (suggestedCategory === 'Subscription') ? 'monthly' : prev.frequency\r\n      }));\r\n      setSuggestedCategory(null);\r\n      setSuggestedTags([]);\r\n      setSuggestedAmount(undefined);\r\n      setSuggestedDescription(undefined);\r\n    }\r\n  };\r\n\r\n  const handlePickContact = async () => {\r\n    if (Capacitor.isNativePlatform()) {\r\n      try {\r\n        const permission = await Contacts.requestPermissions();\r\n        if (permission.contacts !== 'granted') {\r\n          alert('Contacts permission is required to select a contact.');\r\n          return;\r\n        }\r\n\r\n        const result = await Contacts.pickContact();\r\n        if (result && result.contact) {\r\n          const contact = result.contact;\r\n          const contactName = contact.name?.display ||\r\n            (contact.name?.given ? `${contact.name.given} ${contact.name.family || ''}` : '') ||\r\n            contact.phones?.[0]?.number ||\r\n            'Unknown Contact';\r\n\r\n          setFormData(prev => ({ ...prev, personName: contactName.trim() }));\r\n          if (window.navigator.vibrate) window.navigator.vibrate(20);\r\n        }\r\n      } catch (err) {\r\n        console.error('Capacitor contact picker error:', err);\r\n        alert('Failed to pick contact. Please try again or type manually.');\r\n      }\r\n    } else if ('contacts' in navigator && 'ContactsManager' in window) {\r\n      try {\r\n        const props = ['name'];\r\n        const opts = { multiple: false };\r\n        const contacts = await (navigator as any).contacts.select(props, opts);\r\n\r\n        if (contacts.length > 0 && contacts[0].name?.length > 0) {\r\n          const contactName = contacts[0].name[0];\r\n          setFormData(prev => ({ ...prev, personName: contactName }));\r\n          if (window.navigator.vibrate) window.navigator.vibrate(20);\r\n        }\r\n      } catch (err) {\r\n        console.error('Web contact picker error:', err);\r\n      }\r\n    } else {\r\n      alert('Contact Selection is only available on supported mobile browsers or the native app.');\r\n    }\r\n  };\r\n\r\n  const quickAmounts = [100, 500, 1000, 5000];\r\n\r\n  // Amount suggestion handlers\r\n  const appendZeros = (count: number) => {\r\n    const currentAmount = formData.amount || '0';\r\n    const newAmount = currentAmount + '0'.repeat(count);\r\n    setFormData({ ...formData, amount: newAmount });\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={handleClose}>\r\n      <DialogContent className=\"max-w-md max-h-[90vh] overflow-y-auto bg-black border-white/5 p-0 shadow-2xl custom-scrollbar sq-2xl\">\r\n        <div className={`px-8 pt-10 pb-8 border-b border-white/5 relative overflow-hidden ${type === 'expense' ? 'bg-rose-500/5' :\r\n          type === 'income' ? 'bg-emerald-500/5' :\r\n            'bg-yellow-500/5'\r\n          }`}>\r\n          <div className={`absolute top-0 right-0 w-32 h-32 blur-[60px] opacity-20 -mr-16 -mt-16 ${type === 'expense' ? 'bg-rose-500' :\r\n            type === 'income' ? 'bg-emerald-500' :\r\n              'bg-yellow-500'\r\n            }`} />\r\n\r\n          <DialogHeader className=\"relative z-10\">\r\n            <DialogTitle className=\"text-2xl font-black tracking-tighter text-slate-100\">\r\n              {initialData ? 'Update' : 'Add'}{' '}\r\n              {type === 'expense' ? 'Money Out' : type === 'income' ? 'Money In' : 'Personal IOU'}\r\n            </DialogTitle>\r\n            <DialogDescription className=\"text-slate-500 font-bold text-[10px] uppercase tracking-[0.2em] mt-1\">\r\n              {type === 'debt' ? (\r\n                \"Protocol for personal liquidity exchange\"\r\n              ) : (\r\n                `Recording ${type === 'expense' ? 'capital depletion' : 'capital injection'} event`\r\n              )}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n        </div>\r\n\r\n        <div className=\"p-8\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            {/* Account Selection */}\r\n            {accounts.length > 0 ? (\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"transaction-account\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Account Reservoir</Label>\r\n                <Select value={formData.accountId} onValueChange={(value) => setFormData({ ...formData, accountId: value })}>\r\n                  <SelectTrigger id=\"transaction-account\" name=\"accountId\" className=\"h-12 bg-black border-white/5 sq-md focus:ring-1 focus:ring-white/10 text-slate-200 font-bold\">\r\n                    <SelectValue placeholder=\"Select account\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent className=\"bg-black border-white/5\">\r\n                    {accounts.map((account) => (\r\n                      <SelectItem key={account.id} value={account.id} className=\"focus:bg-white/5 focus:text-white\">\r\n                        <div className=\"flex items-center justify-between w-full\">\r\n                          <span className=\"font-bold\">{account.name}</span>\r\n                          <span className=\"text-[10px] text-slate-500 ml-4 font-mono\">\r\n                            {formatCurrency(account.balance, currency)}\r\n                          </span>\r\n                        </div>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            ) : (\r\n              <div className=\"p-4 bg-amber-500/10 border border-amber-500/20 sq-md text-[10px] font-black uppercase tracking-widest text-amber-400\">\r\n                ⚠️ Protocol Failure: No accounts detected\r\n              </div>\r\n            )}\r\n\r\n            {/* Description/Source/Person */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"transaction-description\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">\r\n                {type === 'expense' ? 'Description' : type === 'income' ? 'Source' : 'Person Name'}\r\n              </Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  id=\"transaction-description\"\r\n                  name=\"description\"\r\n                  value={type === 'debt' ? formData.personName : formData.description}\r\n                  onChange={(e) =>\r\n                    setFormData({\r\n                      ...formData,\r\n                      [type === 'debt' ? 'personName' : 'description']: e.target.value\r\n                    })\r\n                  }\r\n                  placeholder={\r\n                    type === 'expense'\r\n                      ? 'Starbucks Coffee, Netflix...'\r\n                      : type === 'income'\r\n                        ? 'Salary, Freelance...'\r\n                        : 'John Doe'\r\n                  }\r\n                  required\r\n                  className=\"h-12 bg-black border-white/5 sq-md focus:border-white/10 text-slate-200 font-bold placeholder:text-slate-600 flex-1\"\r\n                  autoComplete=\"off\"\r\n                />\r\n                {type === 'debt' && (\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    onClick={handlePickContact}\r\n                    className=\"h-12 w-12 bg-white/5 border border-white/5 sq-md flex items-center justify-center p-0 text-slate-400 hover:text-white\"\r\n                    title=\"Select from Contacts\"\r\n                  >\r\n                    <Users className=\"w-5 h-5\" />\r\n                  </Button>\r\n                )}\r\n              </div>\r\n\r\n              {/* AI Suggestion */}\r\n              {suggestedCategory && (\r\n                <div className=\"mt-3 p-4 bg-indigo-500/5 border border-indigo-500/10 sq-md flex items-start gap-3 animate-in fade-in zoom-in-95 duration-300\">\r\n                  <Sparkles className=\"w-4 h-4 text-indigo-400 mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <p className=\"text-[10px] font-black uppercase tracking-widest text-indigo-300 leading-tight\">\r\n                      Intelligence Suggested\r\n                    </p>\r\n                    <div className=\"text-xs text-slate-400 mt-1 font-bold\">\r\n                      {type === 'expense' && (\r\n                        <div className=\"flex flex-col gap-1\">\r\n                          <div>Category: <span className=\"text-slate-100 uppercase\">{suggestedCategory}</span></div>\r\n                          {suggestedAmount && (\r\n                            <div>Detected Amount: <span className=\"text-emerald-400\">{formatCurrency(suggestedAmount, currency)}</span></div>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                      {suggestedTags.length > 0 && (\r\n                        <div className=\"mt-1\">Tags: <span className=\"text-slate-100\">{suggestedTags.join(', ')}</span></div>\r\n                      )}\r\n                    </div>\r\n                    <Button\r\n                      type=\"button\"\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      onClick={applySuggestion}\r\n                      className=\"mt-3 h-8 bg-indigo-500/10 text-indigo-300 hover:bg-indigo-500/20 sq-sm text-[10px] font-black uppercase tracking-widest w-full\"\r\n                    >\r\n                      Auto-Configure Form\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Amount */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"transaction-amount\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Capital Value</Label>\r\n              <div className=\"flex gap-2\">\r\n                <NumberInput\r\n                  id=\"transaction-amount\"\r\n                  name=\"amount\"\r\n                  value={formData.amount}\r\n                  onChange={(value) => setFormData({ ...formData, amount: value })}\r\n                  placeholder=\"0.00\"\r\n                  step=\"any\"\r\n                  min=\"0\"\r\n                  required\r\n                  className=\"flex-1 h-14 bg-black border-white/5 sq-md focus:border-white/10 text-xl font-black text-slate-100 placeholder:text-slate-800\"\r\n                  autoComplete=\"off\"\r\n                />\r\n                <div className=\"flex flex-col gap-1\">\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => appendZeros(2)}\r\n                    className=\"px-3 h-[25px] bg-white/5 text-[10px] font-black text-slate-400 hover:text-white sq-sm border border-white/5\"\r\n                    title=\"Add 00\"\r\n                  >\r\n                    +00\r\n                  </Button>\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => appendZeros(3)}\r\n                    className=\"px-3 h-[25px] bg-white/5 text-[10px] font-black text-slate-400 hover:text-white sq-sm border border-white/5\"\r\n                    title=\"Add 000\"\r\n                  >\r\n                    +000\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2 mt-3\">\r\n                {quickAmounts.map((amount) => (\r\n                  <button\r\n                    key={amount}\r\n                    type=\"button\"\r\n                    onClick={() => setFormData({ ...formData, amount: amount.toString() })}\r\n                    className=\"flex-1 py-2 text-[10px] font-black bg-black border border-white/5 text-slate-500 sq-md hover:bg-white/5 hover:text-slate-200 transition-all uppercase tracking-widest\"\r\n                  >\r\n                    {amount}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Round Up Option */}\r\n              {roundUpEnabled && type === 'expense' && formData.amount && parseFloat(formData.amount) > 0 && (\r\n                (() => {\r\n                  const amount = parseFloat(formData.amount);\r\n                  const target = amount < 100 ? Math.ceil(amount / 10) * 10 : Math.ceil(amount / 100) * 100;\r\n                  const diff = target - amount;\r\n\r\n                  if (diff > 0 && diff >= 1) {\r\n                    return (\r\n                      <div className=\"flex items-center space-x-3 mt-4 p-4 bg-indigo-500/5 border border-indigo-500/10 sq-md animate-in fade-in duration-500\">\r\n                        <Checkbox\r\n                          id=\"roundUp\"\r\n                          name=\"roundUp\"\r\n                          className=\"border-white/20 data-[state=checked]:bg-indigo-500 data-[state=checked]:border-indigo-500\"\r\n                          onCheckedChange={(checked) => {\r\n                            setFormData(prev => ({ ...prev, roundUpAmount: checked ? diff : undefined }));\r\n                          }}\r\n                        />\r\n                        <div className=\"grid gap-1.5 leading-none\">\r\n                          <Label\r\n                            htmlFor=\"roundUp\"\r\n                            className=\"text-[10px] font-black uppercase tracking-widest text-slate-100 flex items-center gap-2 cursor-pointer\"\r\n                          >\r\n                            <TrendingUp className=\"w-3 h-3 text-indigo-400\" />\r\n                            Reserve {formatCurrency(diff, currency)} to Goals\r\n                          </Label>\r\n                          <p className=\"text-[9px] font-bold text-slate-500 uppercase tracking-tighter\">\r\n                            Round up capital to nearest 100 ({formatCurrency(target, currency)})\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  }\r\n                  return null;\r\n                })()\r\n              )}\r\n            </div>\r\n\r\n            {/* Category (for expenses) */}\r\n            {type === 'expense' && (\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"transaction-category\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Spending Domain</Label>\r\n                <Select value={formData.category} onValueChange={(value) => {\r\n                  setFormData(prev => ({\r\n                    ...prev,\r\n                    category: value,\r\n                    // Auto-enable recurring for manual Subscription selection\r\n                    isRecurring: (value === 'Subscription') ? true : prev.isRecurring,\r\n                    frequency: (value === 'Subscription') ? 'monthly' : prev.frequency\r\n                  }));\r\n                }}>\r\n                  <SelectTrigger id=\"transaction-category\" name=\"category\" className=\"h-12 bg-black border-white/5 sq-md focus:ring-1 focus:ring-white/10 text-slate-200 font-bold\">\r\n                    <SelectValue placeholder=\"Select domain\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent className=\"bg-black border-white/5 max-h-[300px]\">\r\n                    {EXPENSE_CATEGORIES.map((cat) => (\r\n                      <SelectItem key={cat.value} value={cat.value} className=\"focus:bg-white/5 focus:text-white\">\r\n                        <span className=\"mr-2\">{cat.emoji}</span>\r\n                        <span className=\"font-bold\">{cat.value}</span>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            {/* Liability Linking (for EMIs) */}\r\n            {type === 'expense' && formData.category === 'EMI' && (\r\n              <div className=\"space-y-4 p-4 bg-rose-500/5 border border-rose-500/10 sq-md animate-in slide-in-from-top-2 duration-300\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-[10px] font-black uppercase tracking-widest text-rose-400\">Liability Protocol</Label>\r\n                  <Landmark className=\"w-4 h-4 text-rose-400\" />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"transaction-liability\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Target Liability</Label>\r\n                  <Select\r\n                    value={formData.liabilityId}\r\n                    onValueChange={(val) => setFormData(prev => ({\r\n                      ...prev,\r\n                      liabilityId: val,\r\n                      registerAsLiability: val === 'new'\r\n                    }))}\r\n                  >\r\n                    <SelectTrigger id=\"transaction-liability\" name=\"liabilityId\" className=\"h-10 bg-black border-white/5 sq-md text-slate-200 font-bold text-xs\">\r\n                      <SelectValue placeholder=\"Select or Create Liability\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-black border-white/5\">\r\n                      <SelectItem value=\"none\" className=\"font-bold\">No formal link</SelectItem>\r\n                      <SelectItem value=\"new\" className=\"text-emerald-400 font-black italic\">+ Register as New Loan</SelectItem>\r\n                      {liabilities.map(l => (\r\n                        <SelectItem key={l.id} value={l.id} className=\"font-bold\">\r\n                          {l.name} (₹{l.outstanding.toLocaleString()})\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                {formData.liabilityId === 'new' && (\r\n                  <div className=\"space-y-4 animate-in zoom-in-95 duration-300\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"transaction-liability-type\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Loan Category</Label>\r\n                      <Select\r\n                        value={formData.liabilityType}\r\n                        onValueChange={(val: any) => setFormData(prev => ({ ...prev, liabilityType: val }))}\r\n                      >\r\n                        <SelectTrigger id=\"transaction-liability-type\" className=\"h-10 bg-black border-white/5 sq-md text-slate-200 font-bold text-xs\">\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-black border-white/5\">\r\n                          <SelectItem value=\"home_loan\">🏠 Home Loan</SelectItem>\r\n                          <SelectItem value=\"car_loan\">🚗 Car Loan</SelectItem>\r\n                          <SelectItem value=\"personal_loan\">💳 Personal Loan</SelectItem>\r\n                          <SelectItem value=\"education_loan\">🎓 Education Loan</SelectItem>\r\n                          <SelectItem value=\"other\">📋 Other</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n\r\n                    <div className=\"p-3 bg-emerald-500/5 border border-emerald-500/10 rounded-xl space-y-2\">\r\n                      <p className=\"text-[9px] font-black text-emerald-400 uppercase leading-relaxed\">\r\n                        This will create a new formal liability in your \"Bills\" tab.\r\n                      </p>\r\n                      <p className=\"text-[8px] font-bold text-slate-500 uppercase leading-relaxed\">\r\n                        Ensure principal and interest are set in the Matrix below.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Credit Card Specific Logic */}\r\n            {(() => {\r\n              const selectedAccount = accounts.find(a => a.id === formData.accountId);\r\n              if (selectedAccount?.type !== 'credit_card' || type !== 'expense') return null;\r\n\r\n              const creditLimit = selectedAccount.creditLimit || 0;\r\n              const safeLimit = (creditLimit * (selectedAccount.safeLimitPercentage || 30)) / 100;\r\n              const currentSpent = Math.abs(selectedAccount.balance);\r\n              const amount = parseFloat(formData.amount || '0');\r\n              const projectedSpent = currentSpent + amount;\r\n              const isBreaching = projectedSpent > safeLimit && creditLimit > 0;\r\n\r\n              return (\r\n                <div className=\"space-y-4 p-4 bg-black border border-white/5 sq-md animate-in slide-in-from-top-2 duration-300\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Credit Protocol</Label>\r\n                    {isBreaching && (\r\n                      <Badge variant=\"destructive\" className=\"bg-rose-500/10 text-rose-400 border-rose-500/20 text-[8px] font-black uppercase\">\r\n                        Limit Breach Risk\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Checkbox\r\n                      id=\"incomeGenerating\"\r\n                      name=\"isIncomeGenerating\"\r\n                      checked={formData.isIncomeGenerating}\r\n                      onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isIncomeGenerating: !!checked }))}\r\n                    />\r\n                    <Label htmlFor=\"incomeGenerating\" className=\"text-xs font-bold text-slate-300 cursor-pointer\">\r\n                      This expense generates additional income\r\n                    </Label>\r\n                  </div>\r\n\r\n                  {isBreaching && !formData.isIncomeGenerating && (\r\n                    <div className=\"space-y-3\">\r\n                      <Label htmlFor=\"justification\" className=\"text-[9px] font-black uppercase tracking-widest text-rose-400\">Security Justification Required</Label>\r\n                      <Input\r\n                        id=\"justification\"\r\n                        name=\"justification\"\r\n                        placeholder=\"Why is this credit use essential?\"\r\n                        value={formData.justification}\r\n                        onChange={(e) => setFormData(prev => ({ ...prev, justification: e.target.value }))}\r\n                        className=\"bg-white/5 border-rose-500/20 focus:border-rose-500/50 sq-md h-12 text-sm\"\r\n                        required={isBreaching}\r\n                        autoComplete=\"off\"\r\n                      />\r\n                      <p className=\"text-[8px] font-bold text-slate-500 uppercase leading-relaxed\">\r\n                        Strategic credit use is prohibited beyond the safe threshold unless it manifests capital growth.\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })()}\r\n\r\n            {/* Debt Type - Segmented Control */}\r\n            {type === 'debt' && (\r\n              <div className=\"space-y-3\">\r\n                <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Asset Direction</Label>\r\n                <div className=\"flex gap-2 p-1.5 bg-black border border-white/5 sq-md\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setFormData({ ...formData, debtType: 'lent' })}\r\n                    className={`flex-1 py-3 px-4 sq-md text-[10px] font-black uppercase tracking-widest transition-all ${formData.debtType === 'lent'\r\n                      ? 'bg-emerald-600 text-white shadow-lg'\r\n                      : 'text-slate-500 hover:text-slate-200 hover:bg-white/5'\r\n                      } `}\r\n                  >\r\n                    I Lent Capital\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setFormData({ ...formData, debtType: 'borrowed' })}\r\n                    className={`flex-1 py-3 px-4 sq-md text-[10px] font-black uppercase tracking-widest transition-all ${formData.debtType === 'borrowed'\r\n                      ? 'bg-rose-600 text-white shadow-lg'\r\n                      : 'text-slate-500 hover:text-slate-200 hover:bg-white/5'\r\n                      } `}\r\n                  >\r\n                    I Borrowed\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Debt Due Date */}\r\n            {type === 'debt' && (\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"debt-due-date\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Repayment Date (Optional)</Label>\r\n                <Input\r\n                  id=\"debt-due-date\"\r\n                  name=\"debtDueDate\"\r\n                  type=\"date\"\r\n                  value={formData.debtDueDate}\r\n                  onChange={(e) => setFormData({ ...formData, debtDueDate: e.target.value })}\r\n                  className=\"h-12 bg-black border-white/5 sq-md focus:border-white/10 text-slate-200 font-bold\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Date */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"transaction-date\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Event Timestamp</Label>\r\n              <Input\r\n                id=\"transaction-date\"\r\n                name=\"date\"\r\n                type=\"date\"\r\n                value={formData.date}\r\n                onChange={(e) => setFormData({ ...formData, date: e.target.value })}\r\n                required\r\n                className=\"h-12 bg-black border-white/5 sq-md focus:border-white/10 text-slate-200 font-bold\"\r\n              />\r\n            </div>\r\n\r\n            {/* Tags */}\r\n            <div className=\"space-y-3\">\r\n              <Label htmlFor=\"transaction-tags\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Protocol Tags</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  id=\"transaction-tags\"\r\n                  name=\"tags\"\r\n                  value={tagInput}\r\n                  onChange={(e) => handleTagInputChange(e.target.value)}\r\n                  onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}\r\n                  placeholder=\"urgent, recurring, etc...\"\r\n                  autoComplete=\"off\"\r\n                  className=\"h-12 bg-black border-white/5 sq-md focus:border-white/10 text-slate-200 font-bold placeholder:text-slate-800\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  onClick={handleAddTag}\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-12 px-6 bg-white/5 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white sq-md border border-white/5\"\r\n                >\r\n                  Index\r\n                </Button>\r\n              </div>\r\n              {formData.tags.length > 0 && (\r\n                <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                  {formData.tags.map((tag) => (\r\n                    <Badge\r\n                      key={tag}\r\n                      variant=\"secondary\"\r\n                      className=\"gap-2 bg-black border border-white/5 text-slate-300 font-bold px-3 py-1 sq-sm\"\r\n                    >\r\n                      #{tag}\r\n                      <button type=\"button\" onClick={() => handleRemoveTag(tag)} aria-label={`Remove tag ${tag}`} className=\"hover:text-rose-400 transition-colors\">\r\n                        <X className=\"w-3 h-3\" />\r\n                      </button>\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Recurring */}\r\n            <div className=\"flex items-center gap-3 p-4 bg-black border border-white/5 sq-md group\">\r\n              <Checkbox\r\n                id=\"recurring\"\r\n                name=\"isRecurring\"\r\n                checked={formData.isRecurring}\r\n                onCheckedChange={(checked) => setFormData({ ...formData, isRecurring: !!checked })}\r\n                className=\"border-white/20 data-[state=checked]:bg-indigo-500 data-[state=checked]:border-indigo-500\"\r\n              />\r\n              <Label htmlFor=\"recurring\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-100 cursor-pointer\">\r\n                Cyclical Routine Entry\r\n              </Label>\r\n            </div>\r\n\r\n            {formData.isRecurring && (\r\n              <div className=\"space-y-6 mt-4 p-4 bg-slate-900/40 border border-white/5 sq-md animate-in fade-in zoom-in-95 duration-500\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Financial Matrix Analysis</Label>\r\n                  <Sparkles className=\"w-3 h-3 text-indigo-400\" />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1\">Principal Capital</Label>\r\n                    <NumberInput\r\n                      value={formData.principal}\r\n                      onChange={(val) => setFormData({ ...formData, principal: val })}\r\n                      placeholder=\"e.g. 100000\"\r\n                      className=\"bg-black border-white/5 h-11 sq-md text-slate-300 font-bold text-xs\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1\">Rate (% p.a)</Label>\r\n                    <NumberInput\r\n                      value={formData.interestRate}\r\n                      onChange={(val) => setFormData({ ...formData, interestRate: val })}\r\n                      placeholder=\"e.g. 12\"\r\n                      className=\"bg-black border-white/5 h-11 sq-md text-slate-300 font-bold text-xs\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1\">Tenure</Label>\r\n                    <NumberInput\r\n                      value={formData.tenure}\r\n                      onChange={(val) => setFormData({ ...formData, tenure: val })}\r\n                      placeholder=\"e.g. 12\"\r\n                      className=\"bg-black border-white/5 h-11 sq-md text-slate-300 font-bold text-xs\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] font-black uppercase tracking-widest text-slate-600 ml-1\">Unit</Label>\r\n                    <Select value={formData.tenureUnit} onValueChange={(val: any) => setFormData({ ...formData, tenureUnit: val })}>\r\n                      <SelectTrigger className=\"bg-black border-white/5 h-11 sq-md text-slate-300 font-bold text-xs\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent className=\"bg-black border-white/5\">\r\n                        <SelectItem value=\"months\">Months</SelectItem>\r\n                        <SelectItem value=\"years\">Years</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n\r\n                {(() => {\r\n                  const p = parseFloat(formData.principal);\r\n                  const r = parseFloat(formData.interestRate);\r\n                  let t = parseInt(formData.tenure);\r\n                  if (isNaN(p) || isNaN(r) || isNaN(t) || p <= 0) return null;\r\n\r\n                  if (formData.tenureUnit === 'years') t *= 12;\r\n\r\n                  if (type === 'expense') {\r\n                    const details = calculateLoanDetails(p, r, t);\r\n                    return (\r\n                      <div className=\"space-y-3 pt-2 border-t border-white/5\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <span className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Calculated EMI</span>\r\n                          <span className=\"text-sm font-black text-rose-400\">{formatCurrency(details.emi, currency)}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <span className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Extra Interest</span>\r\n                          <span className=\"text-xs font-bold text-slate-400\">{formatCurrency(details.totalInterest, currency)}</span>\r\n                        </div>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"ghost\"\r\n                          onClick={() => {\r\n                            const startDate = new Date(formData.date);\r\n                            const tVal = t; // t is already in months from line 791\r\n                            startDate.setMonth(startDate.getMonth() + tVal);\r\n                            const calculatedEndDate = startDate.toISOString().split('T')[0];\r\n\r\n                            setFormData({\r\n                              ...formData,\r\n                              amount: details.emi.toString(),\r\n                              endDate: calculatedEndDate\r\n                            });\r\n                          }}\r\n                          className=\"w-full h-9 bg-rose-500/10 text-rose-300 hover:bg-rose-500/20 text-[10px] font-black uppercase tracking-widest sq-md\"\r\n                        >\r\n                          Sync EMI to Transaction\r\n                        </Button>\r\n                      </div>\r\n                    );\r\n                  } else if (type === 'income') {\r\n                    const details = calculateInvestmentDetails(p, r, t);\r\n                    return (\r\n                      <div className=\"space-y-3 pt-2 border-t border-white/5\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <span className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Monthly Yield</span>\r\n                          <span className=\"text-sm font-black text-emerald-400\">{formatCurrency(details.monthlyYield, currency)}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <span className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Total Capital Gains</span>\r\n                          <span className=\"text-xs font-bold text-slate-400\">{formatCurrency(details.totalReturns, currency)}</span>\r\n                        </div>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"ghost\"\r\n                          onClick={() => {\r\n                            const startDate = new Date(formData.date);\r\n                            const tVal = t; // t is already in months from line 791\r\n                            startDate.setMonth(startDate.getMonth() + tVal);\r\n                            const calculatedEndDate = startDate.toISOString().split('T')[0];\r\n\r\n                            setFormData({\r\n                              ...formData,\r\n                              amount: details.monthlyYield.toString(),\r\n                              endDate: calculatedEndDate\r\n                            });\r\n                          }}\r\n                          className=\"w-full h-9 bg-emerald-500/10 text-emerald-300 hover:bg-emerald-500/20 text-[10px] font-black uppercase tracking-widest sq-md\"\r\n                        >\r\n                          Sync Yield to Transaction\r\n                        </Button>\r\n                      </div>\r\n                    );\r\n                  }\r\n                  return null;\r\n                })()}\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-white/5\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"transaction-frequency\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Period</Label>\r\n                    <Select value={formData.frequency} onValueChange={(value: any) => setFormData({ ...formData, frequency: value })}>\r\n                      <SelectTrigger id=\"transaction-frequency\" name=\"frequency\" className=\"bg-black border-white/5 h-12 sq-md text-slate-200 font-bold\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent className=\"bg-black border-white/5\">\r\n                        <SelectItem value=\"daily\">Daily</SelectItem>\r\n                        <SelectItem value=\"weekly\">Weekly</SelectItem>\r\n                        <SelectItem value=\"monthly\">Monthly</SelectItem>\r\n                        <SelectItem value=\"yearly\">Yearly</SelectItem>\r\n                        <SelectItem value=\"custom\">Custom</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  {formData.frequency === 'custom' ? (\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"transaction-interval\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Days Interval</Label>\r\n                      <NumberInput\r\n                        id=\"transaction-interval\"\r\n                        name=\"customIntervalDays\"\r\n                        value={(formData as any).customIntervalDays || ''}\r\n                        onChange={(value) => setFormData({ ...formData, customIntervalDays: parseInt(value) } as any)}\r\n                        placeholder=\"e.g. 45\"\r\n                        min=\"1\"\r\n                        className=\"bg-black border-white/5 h-12 sq-md text-slate-200 font-bold\"\r\n                      />\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"transaction-end-date\" className=\"text-[10px] font-black uppercase tracking-widest text-slate-500 ml-1\">Termination</Label>\r\n                      <Input\r\n                        id=\"transaction-end-date\"\r\n                        name=\"endDate\"\r\n                        type=\"date\"\r\n                        value={formData.endDate}\r\n                        onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}\r\n                        className=\"bg-black border-white/5 h-12 sq-md text-slate-200 font-bold\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex gap-4 pt-6\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                onClick={handleClose}\r\n                className=\"flex-1 h-14 sq-md text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-slate-100 hover:bg-white/5 border border-white/5\"\r\n              >\r\n                Abort\r\n              </Button>\r\n              <Button\r\n                type=\"submit\"\r\n                className={`flex-1 h-14 sq-md text-[10px] font-black uppercase tracking-widest shadow-xl active:scale-[0.98] transition-all ${type === 'expense' ? 'bg-rose-600 hover:bg-rose-500 shadow-rose-900/20' :\r\n                  type === 'income' ? 'bg-emerald-600 hover:bg-emerald-500 shadow-emerald-900/20' :\r\n                    'bg-yellow-600 hover:bg-yellow-500 shadow-yellow-900/20'\r\n                  }`}\r\n                disabled={accounts.length === 0}\r\n              >\r\n                {initialData ? 'Update Matrix' : 'Record Transaction'}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </DialogContent >\r\n    </Dialog >\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\TransactionList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\TransferForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\WealthBuilderSimulator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\auth\\LoginScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\dashboard\\AdvancedInsights.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\dashboard\\Dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\dashboard\\FilterBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\dashboard\\TacticalRecovery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\dashboard\\TimeRangeFilter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\dashboard\\TruthBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\figma\\ImageWithFallback.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\investments\\InvestmentList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\investments\\PortfolioAllocationChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\investments\\PortfolioSummaryCards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\investments\\PortfolioTransactionSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\layout\\AppHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\layout\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\layout\\FabStack.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\layout\\ScrollAwareLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\liabilities\\DebtPayoffChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\onboarding\\OnboardingFlow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\overlays\\AIChatOverlay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\overlays\\AboutUsPopup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\transactions\\TransactionFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\transactions\\TransactionItems.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\transactions\\TransactionOverview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\transactions\\utils.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\CardPattern.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\CategoryBackdrop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\CollapsibleCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\CollapsibleSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\CyberButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\InteractiveFinancialValue.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\LoadingSprite.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\MeshBackground.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\SwipeableItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":46,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":46,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"./utils\";\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\r\n        outline:\r\n          \"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nfunction Badge({\r\n  className,\r\n  variant,\r\n  asChild = false,\r\n  ...props\r\n}: React.ComponentProps<\"span\"> &\r\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\r\n  const Comp = asChild ? Slot : \"span\";\r\n\r\n  return (\r\n    <Comp\r\n      data-slot=\"badge\"\r\n      className={cn(badgeVariants({ variant }), className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport { Badge, badgeVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":58,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":58,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"./utils\";\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium transition-all active:scale-[0.97] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\r\n        outline:\r\n          \"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        ghost:\r\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-11 px-6 py-2 has-[>svg]:px-4\",\r\n        sm: \"h-9 gap-1.5 px-3 has-[>svg]:px-2.5\",\r\n        lg: \"h-12 px-8 has-[>svg]:px-6\",\r\n        icon: \"size-10\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nconst Button = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> &\r\n  VariantProps<typeof buttonVariants> & {\r\n    asChild?: boolean;\r\n  }\r\n>(({ className, variant, size, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\";\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-slot=\"button\"\r\n      className={cn(buttonVariants({ variant, size, className }))}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\n\r\nButton.displayName = \"Button\";\r\n\r\nexport { Button, buttonVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":160,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":160,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport {\r\n  Controller,\r\n  FormProvider,\r\n  useFormContext,\r\n  useFormState,\r\n  type ControllerProps,\r\n  type FieldPath,\r\n  type FieldValues,\r\n} from \"react-hook-form\";\r\n\r\nimport { cn } from \"./utils\";\r\nimport { Label } from \"./label\";\r\n\r\nconst Form = FormProvider;\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n> = {\r\n  name: TName;\r\n};\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\r\n  {} as FormFieldContextValue,\r\n);\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  );\r\n};\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext);\r\n  const itemContext = React.useContext(FormItemContext);\r\n  const { getFieldState } = useFormContext();\r\n  const formState = useFormState({ name: fieldContext.name });\r\n  const fieldState = getFieldState(fieldContext.name, formState);\r\n\r\n  if (!fieldContext) {\r\n    throw new Error(\"useFormField should be used within <FormField>\");\r\n  }\r\n\r\n  const { id } = itemContext;\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  };\r\n};\r\n\r\ntype FormItemContextValue = {\r\n  id: string;\r\n};\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>(\r\n  {} as FormItemContextValue,\r\n);\r\n\r\nfunction FormItem({ className, ...props }: React.ComponentProps<\"div\">) {\r\n  const id = React.useId();\r\n\r\n  return (\r\n    <FormItemContext.Provider value={{ id }}>\r\n      <div\r\n        data-slot=\"form-item\"\r\n        className={cn(\"grid gap-2\", className)}\r\n        {...props}\r\n      />\r\n    </FormItemContext.Provider>\r\n  );\r\n}\r\n\r\nfunction FormLabel({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\r\n  const { error, formItemId } = useFormField();\r\n\r\n  return (\r\n    <Label\r\n      data-slot=\"form-label\"\r\n      data-error={!!error}\r\n      className={cn(\"data-[error=true]:text-destructive\", className)}\r\n      htmlFor={formItemId}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormControl({ ...props }: React.ComponentProps<typeof Slot>) {\r\n  const { error, formItemId, formDescriptionId, formMessageId } =\r\n    useFormField();\r\n\r\n  return (\r\n    <Slot\r\n      data-slot=\"form-control\"\r\n      id={formItemId}\r\n      aria-describedby={\r\n        !error\r\n          ? `${formDescriptionId}`\r\n          : `${formDescriptionId} ${formMessageId}`\r\n      }\r\n      aria-invalid={!!error}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormDescription({ className, ...props }: React.ComponentProps<\"p\">) {\r\n  const { formDescriptionId } = useFormField();\r\n\r\n  return (\r\n    <p\r\n      data-slot=\"form-description\"\r\n      id={formDescriptionId}\r\n      className={cn(\"text-muted-foreground text-sm\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction FormMessage({ className, ...props }: React.ComponentProps<\"p\">) {\r\n  const { error, formMessageId } = useFormField();\r\n  const body = error ? String(error?.message ?? \"\") : props.children;\r\n\r\n  if (!body) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <p\r\n      data-slot=\"form-message\"\r\n      id={formMessageId}\r\n      className={cn(\"text-destructive text-sm\", className)}\r\n      {...props}\r\n    >\r\n      {body}\r\n    </p>\r\n  );\r\n}\r\n\r\nexport {\r\n  useFormField,\r\n  Form,\r\n  FormItem,\r\n  FormLabel,\r\n  FormControl,\r\n  FormDescription,\r\n  FormMessage,\r\n  FormField,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\number-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":47,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":47,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"./utils\";\r\n\r\nconst toggleVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-transparent\",\r\n        outline:\r\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\r\n      },\r\n      size: {\r\n        default: \"h-9 px-2 min-w-9\",\r\n        sm: \"h-8 px-1.5 min-w-8\",\r\n        lg: \"h-10 px-2.5 min-w-10\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nfunction Toggle({\r\n  className,\r\n  variant,\r\n  size,\r\n  ...props\r\n}: React.ComponentProps<typeof TogglePrimitive.Root> &\r\n  VariantProps<typeof toggleVariants>) {\r\n  return (\r\n    <TogglePrimitive.Root\r\n      data-slot=\"toggle\"\r\n      className={cn(toggleVariants({ variant, size, className }))}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport { Toggle, toggleVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\use-mobile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\components\\ui\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\context\\FinanceContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":162,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":162,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'updateSettings' function makes the dependencies of useCallback Hook (at line 486) change on every render. To fix this, wrap the definition of 'updateSettings' in its own useCallback() Hook.","line":1040,"column":11,"nodeType":"VariableDeclarator","endLine":1063,"endColumn":6,"suggestions":[{"desc":"Wrap the definition of 'updateSettings' in its own useCallback() Hook.","fix":{"range":[46125,47110],"text":"useCallback(async (updates: Partial<UserSettings>) => {\r\n        // Optimistic update\r\n        const newSettings = { ...settings, ...updates };\r\n        setSettings(newSettings);\r\n        if (updates.theme) applyTheme(updates.theme);\r\n\r\n        try {\r\n            const response = await api.updateSettings(userId, updates);\r\n            if (response.success) {\r\n                // Merge response with existing state to avoid losing local-only fields\r\n                setSettings(prev => ({\r\n                    ...prev,\r\n                    ...response.settings,\r\n                    aiProvider: response.settings.aiProvider || prev.aiProvider,\r\n                    apiKeys: { ...prev.apiKeys, ...response.settings.apiKeys }\r\n                }));\r\n            } else {\r\n                throw new Error(response.error);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to sync settings\", error);\r\n            toast.error(\"Settings saved locally only\");\r\n        }\r\n    })"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'updateSettings' function makes the dependencies of useEffect Hook (at line 491) change on every render. To fix this, wrap the definition of 'updateSettings' in its own useCallback() Hook.","line":1040,"column":11,"nodeType":"VariableDeclarator","endLine":1063,"endColumn":6,"suggestions":[{"desc":"Wrap the definition of 'updateSettings' in its own useCallback() Hook.","fix":{"range":[46125,47110],"text":"useCallback(async (updates: Partial<UserSettings>) => {\r\n        // Optimistic update\r\n        const newSettings = { ...settings, ...updates };\r\n        setSettings(newSettings);\r\n        if (updates.theme) applyTheme(updates.theme);\r\n\r\n        try {\r\n            const response = await api.updateSettings(userId, updates);\r\n            if (response.success) {\r\n                // Merge response with existing state to avoid losing local-only fields\r\n                setSettings(prev => ({\r\n                    ...prev,\r\n                    ...response.settings,\r\n                    aiProvider: response.settings.aiProvider || prev.aiProvider,\r\n                    apiKeys: { ...prev.apiKeys, ...response.settings.apiKeys }\r\n                }));\r\n            } else {\r\n                throw new Error(response.error);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to sync settings\", error);\r\n            toast.error(\"Settings saved locally only\");\r\n        }\r\n    })"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'createRecurringTransaction' function makes the dependencies of useCallback Hook (at line 721) change on every render. To fix this, wrap the definition of 'createRecurringTransaction' in its own useCallback() Hook.","line":1185,"column":11,"nodeType":"VariableDeclarator","endLine":1304,"endColumn":6,"suggestions":[{"desc":"Wrap the definition of 'createRecurringTransaction' in its own useCallback() Hook.","fix":{"range":[54314,61369],"text":"useCallback(async (data: any) => {\r\n        try {\r\n            console.log(\"[Backfill Debug] createRecurringTransaction called with:\", data);\r\n            const response = await api.createRecurring(userId, data);\r\n            if (response.success) {\r\n                const newRec = response.recurring;\r\n                setRecurringTransactions(prev => [...prev, newRec]);\r\n                toast.success('Recurring transaction created');\r\n\r\n                // Auto-Backfill Logic (Timezone-Safe Refactor)\r\n                if (newRec.startDate) {\r\n                    console.log(\"[Backfill Debug] Analysis starting for:\", newRec.description || newRec.source);\r\n                    toast.info(\"Analyzing transaction history...\");\r\n\r\n                    const localNow = new Date();\r\n                    const nowStr = `${localNow.getFullYear()}-${String(localNow.getMonth() + 1).padStart(2, '0')}-${String(localNow.getDate()).padStart(2, '0')}`;\r\n                    const startStr = newRec.startDate.split('T')[0];\r\n\r\n                    console.log(\"[Backfill Debug] nowStr:\", nowStr, \"startStr:\", startStr);\r\n\r\n                    if (startStr <= nowStr && newRec.type) {\r\n                        const [sY, sM, sD] = startStr.split('-').map(Number);\r\n                        const current = new Date(sY, sM - 1, sD, 12, 0, 0);\r\n                        const dueDates: Date[] = [];\r\n                        let safety = 0;\r\n\r\n                        while (safety < 1200) {\r\n                            const cY = current.getFullYear();\r\n                            const cM = current.getMonth();\r\n                            const cD = current.getDate();\r\n                            const currentStr = `${cY}-${String(cM + 1).padStart(2, '0')}-${String(cD).padStart(2, '0')}`;\r\n                            if (currentStr > nowStr) break;\r\n                            dueDates.push(new Date(current));\r\n\r\n                            switch (newRec.frequency) {\r\n                                case 'daily': current.setDate(current.getDate() + 1); break;\r\n                                case 'weekly': current.setDate(current.getDate() + 7); break;\r\n                                case 'monthly': {\r\n                                    const origDay = sD;\r\n                                    current.setMonth(current.getMonth() + 1);\r\n                                    if (current.getDate() < origDay && current.getMonth() === (cM + 2) % 12) {\r\n                                        current.setDate(0);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                                case 'yearly': current.setFullYear(current.getFullYear() + 1); break;\r\n                                case 'custom':\r\n                                    current.setDate(current.getDate() + (newRec.customIntervalDays || 30));\r\n                                    break;\r\n                                default: current.setMonth(current.getMonth() + 1);\r\n                            }\r\n                            safety++;\r\n                        }\r\n\r\n                        console.log(\"[Backfill Debug] Generated\", dueDates.length, \"due dates\");\r\n\r\n                        const recAmount = Number(newRec.amount);\r\n                        const recDesc = (newRec.description || newRec.source || '').toLowerCase().trim();\r\n\r\n                        const missingDates = dueDates.filter(due => {\r\n                            const dStr = `${due.getFullYear()}-${String(due.getMonth() + 1).padStart(2, '0')}-${String(due.getDate()).padStart(2, '0')}`;\r\n\r\n                            const exists = [...expenses, ...incomes].some(tx => {\r\n                                const txDate = (tx.date || '').split('T')[0];\r\n                                const txAmount = Number(tx.amount);\r\n                                const txDesc = (('description' in tx ? tx.description : (tx as any).source) || '').toLowerCase().trim();\r\n\r\n                                const amountMatch = Math.abs(txAmount - recAmount) < 0.01;\r\n                                const descMatch = txDesc.includes(recDesc) || recDesc.includes(txDesc);\r\n\r\n                                // Frequency-aware date matching\r\n                                let dateMatch = txDate === dStr;\r\n                                if (newRec.frequency === 'monthly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    const diff = Math.abs(tDate.getDate() - due.getDate());\r\n                                    dateMatch = tDate.getFullYear() === due.getFullYear() &&\r\n                                        tDate.getMonth() === due.getMonth() &&\r\n                                        diff <= 7;\r\n                                } else if (newRec.frequency === 'weekly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    const diff = Math.abs(tDate.getTime() - due.getTime()) / (1000 * 60 * 60 * 24);\r\n                                    dateMatch = diff <= 3;\r\n                                } else if (newRec.frequency === 'yearly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    dateMatch = tDate.getFullYear() === due.getFullYear();\r\n                                }\r\n\r\n                                // Link matching\r\n                                const linkMatch = tx.recurringId === newRec.id;\r\n\r\n                                return (descMatch || linkMatch) && dateMatch && amountMatch;\r\n                            });\r\n                            return !exists;\r\n                        });\r\n\r\n                        console.log(`[Backfill Debug] Total Expected: ${dueDates.length}, Missing: ${missingDates.length}`);\r\n\r\n                        if (missingDates.length > 0) {\r\n                            console.log(\"[Backfill Debug] Triggering popup request for\", missingDates.length, \"dates\");\r\n                            setBackfillRequest({\r\n                                count: missingDates.length,\r\n                                dates: missingDates,\r\n                                recurring: newRec\r\n                            });\r\n                        } else {\r\n                            console.log(\"[Backfill Debug] All expected entries already exist in history.\");\r\n                            toast.success(\"Transaction history is already up to date.\");\r\n                        }\r\n                    } else {\r\n                        console.log(\"[Backfill Debug] Skip: start date is in the future or invalid type.\");\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error creating recurring transaction:', error);\r\n            const temp = { id: `temp_${Date.now()}`, ...data, createdAt: new Date().toISOString() };\r\n            setRecurringTransactions(prev => [...prev, temp]);\r\n            toast.warning('Offline: Created locally');\r\n        }\r\n    })"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { api } from '../utils/api';\r\nimport { toast } from 'sonner';\r\nimport confetti from 'canvas-confetti';\r\nimport {\r\n    Expense,\r\n    Income,\r\n    Debt,\r\n    Goal,\r\n    UserSettings,\r\n    Account,\r\n    Notification,\r\n    Investment,\r\n    CURRENCY_SYMBOLS,\r\n    Liability,\r\n    RecurringTransaction,\r\n    AuthUser\r\n} from '../types';\r\nimport { checkAchievements, getAchievement } from '../utils/achievements';\r\nimport { generateGurujiInsights, createInsightNotification } from '../utils/insights';\r\nimport { autoCategorize, isKnownSubscription } from '../utils/autoCategorize';\r\nimport { LocalNotifications } from '@capacitor/local-notifications';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport { App } from '@capacitor/app';\r\n\r\n// Constants for LocalStorage keys\r\nconst STORAGE_KEYS = {\r\n    SETTINGS: 'finhub_settings',\r\n    EXPENSES: 'finhub_expenses',\r\n    INCOMES: 'finhub_incomes',\r\n    DEBTS: 'finhub_debts',\r\n    GOALS: 'finhub_goals',\r\n    ACCOUNTS: 'finhub_accounts',\r\n    INVESTMENTS: 'finhub_investments',\r\n    LIABILITIES: 'finhub_liabilities',\r\n    NOTIFICATIONS: 'finhub_notifications',\r\n    EMERGENCY_FUND: 'finhub_emergency_fund',\r\n    RECURRING: 'finhub_recurring',\r\n    AUTH: 'finhub_auth',\r\n    REMEMBERED_MOBILE: 'finhub_remembered_mobile',\r\n    DELETION_SCHEDULE: 'finhub_deletion_schedule'\r\n};\r\n\r\ninterface FinanceContextType {\r\n    // State\r\n    userId: string;\r\n    settings: UserSettings;\r\n    currency: string; // Add currency directly for easier access\r\n    expenses: Expense[];\r\n    incomes: Income[];\r\n    debts: Debt[];\r\n    goals: Goal[];\r\n    accounts: Account[];\r\n    investments: Investment[];\r\n    liabilities: Liability[];\r\n    recurringTransactions: RecurringTransaction[];\r\n    notifications: Notification[];\r\n    emergencyFundAmount: number;\r\n    isLoading: boolean;\r\n    isRefreshing: boolean;\r\n    isOffline: boolean;\r\n    apiStatus: 'online' | 'offline' | 'error';\r\n    pendingMobile: string;\r\n    authMessage?: { message: string, subMessage?: string };\r\n\r\n    // Auth State\r\n    authStatus: 'guest' | 'authenticating' | 'authenticated';\r\n    currentUser: AuthUser | null;\r\n    isAwaitingPin: boolean;\r\n    isRememberedUser: boolean;\r\n    rememberedMobile: string;\r\n\r\n    // Actions\r\n    refreshData: () => Promise<void>;\r\n    updateSettings: (updates: Partial<UserSettings>) => Promise<void>;\r\n\r\n    // Auth Actions\r\n    checkIdentity: (mobile: string) => Promise<boolean>;\r\n    login: (pin: string, rememberMe?: boolean) => Promise<boolean>;\r\n    signup: (mobile: string, pin: string, name: string, rememberMe?: boolean) => Promise<boolean>;\r\n    sendOtp: (mobile: string) => Promise<boolean>;\r\n    verifyOtp: (mobile: string, otp: string) => Promise<boolean>;\r\n    resetPin: (mobile: string, newPin: string) => Promise<boolean>;\r\n    logout: () => void;\r\n    clearPendingSession: () => void;\r\n    scheduleAccountDeletion: () => Promise<void>;\r\n    cancelAccountDeletion: () => Promise<void>;\r\n    deletionDate: string | null;\r\n\r\n    // CRUD Actions\r\n    createExpense: (data: any) => Promise<void>;\r\n    updateExpense: (id: string, data: any) => Promise<void>;\r\n    deleteExpense: (id: string) => Promise<void>;\r\n\r\n    createIncome: (data: any) => Promise<void>;\r\n    updateIncome: (id: string, data: any) => Promise<void>;\r\n    deleteIncome: (id: string) => Promise<void>;\r\n\r\n    createDebt: (data: any) => Promise<void>;\r\n    updateDebt: (id: string, data: any) => Promise<void>;\r\n    deleteDebt: (id: string) => Promise<void>;\r\n    settleDebt: (id: string) => Promise<void>;\r\n\r\n    createGoal: (data: any) => Promise<void>;\r\n    updateGoal: (id: string, data: any) => Promise<void>;\r\n    deleteGoal: (id: string) => Promise<void>;\r\n\r\n    createAccount: (data: any) => Promise<void>;\r\n    updateAccount: (id: string, data: any) => Promise<void>;\r\n    deleteAccount: (id: string) => Promise<void>;\r\n\r\n    // Liabilities\r\n    createLiability: (data: Omit<Liability, 'id'>) => Promise<void>;\r\n    updateLiability: (id: string, data: Partial<Liability>) => Promise<void>;\r\n    deleteLiability: (id: string) => Promise<void>;\r\n\r\n    // Migration\r\n    migrateSubscriptions: () => Promise<{ count: number }>;\r\n    cleanupDuplicates: () => Promise<{ count: number }>;\r\n\r\n    // Investments\r\n    createInvestment: (data: any, sourceAccountId?: string) => Promise<void>;\r\n    updateInvestment: (id: string, data: any) => Promise<void>;\r\n    deleteInvestment: (id: string) => Promise<void>;\r\n\r\n    // Recurring\r\n    createRecurringTransaction: (data: any) => Promise<void>;\r\n    updateRecurringTransaction: (id: string, data: any) => Promise<void>;\r\n    createRecurring: (data: any) => Promise<void>;\r\n    deleteRecurringTransaction: (id: string) => Promise<void>;\r\n    processRecurringTransactions: () => Promise<void>;\r\n\r\n    setEmergencyFundAmount: (amount: number | ((prev: number) => number)) => void; // Allow direct setting for now to match App.tsx usage\r\n    setNotifications: React.Dispatch<React.SetStateAction<Notification[]>>; // Expose setter for now\r\n\r\n    // Helpers\r\n    applyTheme: (theme: \"light\" | \"dark\" | \"system\") => void;\r\n\r\n    // Fund Allocation\r\n    isFundAllocationOpen: boolean;\r\n    fundAllocationType: 'goal' | 'emergency';\r\n    openFundAllocation: (type: 'goal' | 'emergency') => void;\r\n    closeFundAllocation: () => void;\r\n    performFundAllocation: (data: {\r\n        accountId: string;\r\n        destinationId: string;\r\n        amount: number;\r\n        destinationType: 'goal' | 'emergency';\r\n    }) => Promise<void>;\r\n    deductFromAccount: (accountId: string, amount: number) => Promise<void>;\r\n    transferFunds: (sourceId: string, destinationId: string, amount: number) => Promise<void>;\r\n    clearAllData: () => Promise<void>;\r\n\r\n    // Backfill Logic\r\n    backfillRequest: { count: number; dates: Date[]; recurring: any } | null;\r\n    setBackfillRequest: React.Dispatch<React.SetStateAction<{ count: number; dates: Date[]; recurring: any } | null>>;\r\n    executeBackfill: () => Promise<void>;\r\n}\r\n\r\nconst FinanceContext = createContext<FinanceContextType | undefined>(undefined);\r\n\r\nexport const useFinance = () => {\r\n    const context = useContext(FinanceContext);\r\n    if (!context) {\r\n        throw new Error('useFinance must be used within a FinanceProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const FinanceProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [userId] = useState(\"demo-user-001\");\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isRefreshing, setIsRefreshing] = useState(false);\r\n\r\n    // Data State\r\n    const [settings, setSettings] = useState<UserSettings>({\r\n        theme: \"system\",\r\n        currency: \"INR\",\r\n        unlockedAchievements: [],\r\n        name: \"\",\r\n        photoURL: \"\",\r\n        notificationsEnabled: false,\r\n        roundUpEnabled: true,\r\n        aiProvider: \"openai\",\r\n        onboardingPhase: 0,\r\n        passiveIncomeTarget: 0,\r\n        isSampleMode: false,\r\n    });\r\n    const [expenses, setExpenses] = useState<Expense[]>([]);\r\n    const [incomes, setIncomes] = useState<Income[]>([]);\r\n    const [debts, setDebts] = useState<Debt[]>([]);\r\n    const [goals, setGoals] = useState<Goal[]>([]);\r\n    const [accounts, setAccounts] = useState<Account[]>([]);\r\n    const [investments, setInvestments] = useState<Investment[]>([]);\r\n    const [liabilities, setLiabilities] = useState<Liability[]>([]);\r\n    const [recurringTransactions, setRecurringTransactions] = useState<RecurringTransaction[]>([]);\r\n    const [notifications, setNotifications] = useState<Notification[]>([]);\r\n    const [emergencyFundAmount, setEmergencyFundAmount] = useState(0);\r\n    const [isOffline, setIsOffline] = useState(false);\r\n    const [apiStatus, setApiStatus] = useState<'online' | 'offline' | 'error'>('online');\r\n\r\n    // Auth State\r\n    const [authStatus, setAuthStatus] = useState<'guest' | 'authenticating' | 'authenticated'>('guest');\r\n    const [currentUser, setCurrentUser] = useState<AuthUser | null>(null);\r\n    const [isAwaitingPin, setIsAwaitingPin] = useState(false);\r\n    const [pendingMobile, setPendingMobile] = useState('');\r\n    const [isRememberedUser, setIsRememberedUser] = useState(false);\r\n    const [rememberedMobile, setRememberedMobile] = useState('');\r\n    const [deletionDate, setDeletionDate] = useState<string | null>(null);\r\n    const [generatedOtp, setGeneratedOtp] = useState<string | null>(null);\r\n    const [authMessage, setAuthMessage] = useState<{ message: string, subMessage?: string } | undefined>();\r\n    const [backfillRequest, setBackfillRequest] = useState<{ count: number; dates: Date[]; recurring: any } | null>(null);\r\n\r\n    // Pre-defined users for Beta/Demo\r\n    const DEMO_USERS = [\r\n        {\r\n            mobile: '9447147230',\r\n            pin: '2255',\r\n            name: 'tin2mon FinHub Node // 0x50.3',\r\n            userId: 'tin2mon-prod-001'\r\n        }\r\n    ];\r\n\r\n    // Notification Helper with Deduplication and Pruning\r\n    const addNotifications = React.useCallback((newNotifs: Notification | Notification[]) => {\r\n        const toAdd = Array.isArray(newNotifs) ? newNotifs : [newNotifs];\r\n\r\n        setNotifications(prev => {\r\n            const filtered = toAdd.filter(notif => {\r\n                // Deduplicate by ID\r\n                const idExists = prev.some(p => p.id === notif.id);\r\n                if (idExists) return false;\r\n\r\n                // Deduplicate by Content (avoid spamming similar insights/alerts in a short window)\r\n                const similarExists = prev.some(p =>\r\n                    p.type === notif.type &&\r\n                    p.message === notif.message &&\r\n                    !p.read &&\r\n                    (new Date().getTime() - new Date(p.timestamp).getTime() < 1000 * 60 * 60 * 24) // 24h window\r\n                );\r\n                return !similarExists;\r\n            });\r\n\r\n            if (filtered.length === 0) return prev;\r\n\r\n            // Merge, Sort by timestamp descending, and Prune to top 100\r\n            const combined = [...filtered, ...prev].sort((a, b) =>\r\n                new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()\r\n            );\r\n\r\n            return combined.slice(0, 100);\r\n        });\r\n\r\n        // Schedule Native Local Notification if on Native Platform\r\n        if (Capacitor.isNativePlatform()) {\r\n            toAdd.forEach(notif => {\r\n                // Only send native notifications for higher priority items or specific types\r\n                if (notif.priority === 'high' || notif.type === 'reminder' || notif.type === 'alert' || notif.type === 'achievement') {\r\n                    LocalNotifications.schedule({\r\n                        notifications: [{\r\n                            id: Math.floor(Math.random() * 1000000), // Random ID for native notification\r\n                            title: notif.title,\r\n                            body: notif.message,\r\n                            largeIcon: 'res://drawable/splash',\r\n                            smallIcon: 'res://drawable/splash',\r\n                            schedule: { at: new Date(Date.now() + 1000) }, // Schedule almost immediately\r\n                            extra: {\r\n                                notificationId: notif.id,\r\n                                achievementId: notif.achievementId,\r\n                                type: notif.type,\r\n                                category: notif.category,\r\n                                view: notif.type === 'achievement' ? undefined : (\r\n                                    notif.category === 'reminders' ? 'liability' :\r\n                                        notif.category === 'transactions' ? 'transactions' : 'dashboard'\r\n                                )\r\n                            }\r\n                        }]\r\n                    }).catch(err => console.error('Failed to schedule local notification:', err));\r\n                }\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    const checkSmartDues = React.useCallback(() => {\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        // 1. Calculate Liquid Balance (Bank/Cash - Goal/Emergency Reservations)\r\n        const totalLiquidBank = accounts.reduce((sum, acc) => sum + (acc.type === 'bank' || acc.type === 'cash' ? acc.balance : 0), 0);\r\n        const totalReserved = goals.reduce((sum, g) => sum + g.currentAmount, 0) + emergencyFundAmount;\r\n        const availableLiquidity = Math.max(0, totalLiquidBank - totalReserved);\r\n\r\n        const upcomingDues: { name: string, amount: number, dueDate: Date, type: string }[] = [];\r\n\r\n        // 2. Scan Liabilities (Loans)\r\n        liabilities.forEach(l => {\r\n            const start = new Date(l.startDate);\r\n            // Simple assumption: due on the same day as startDate every month\r\n            const dueThisMonth = new Date(today.getFullYear(), today.getMonth(), start.getDate());\r\n\r\n            // If it's already passed this month, look at next month\r\n            if (dueThisMonth < today) {\r\n                dueThisMonth.setMonth(dueThisMonth.getMonth() + 1);\r\n            }\r\n\r\n            const diffDays = Math.ceil((dueThisMonth.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\r\n\r\n            if (diffDays <= 7) {\r\n                upcomingDues.push({ name: l.name, amount: l.emiAmount, dueDate: dueThisMonth, type: 'EMI' });\r\n            }\r\n        });\r\n\r\n        // 3. Scan Recurring Transactions (Subscriptions/Bills)\r\n        recurringTransactions.forEach(r => {\r\n            if (r.type === 'expense') {\r\n                const start = new Date(r.startDate);\r\n                let nextDue: Date;\r\n\r\n                if (r.frequency === 'monthly') {\r\n                    nextDue = new Date(today.getFullYear(), today.getMonth(), start.getDate());\r\n                    if (nextDue < today) nextDue.setMonth(nextDue.getMonth() + 1);\r\n                } else if (r.frequency === 'weekly') {\r\n                    const daysUntilDue = (start.getDay() - today.getDay() + 7) % 7;\r\n                    nextDue = new Date(today.getTime() + daysUntilDue * 24 * 60 * 60 * 1000);\r\n                    if (nextDue < today) nextDue.setDate(nextDue.getDate() + 7);\r\n                } else if (r.frequency === 'custom') {\r\n                    // Custom Cycle Logic (e.g. 28 days)\r\n                    const interval = r.customIntervalDays || 28; // Default to 28 if not set\r\n                    const timeDiff = today.getTime() - start.getTime();\r\n                    const daysSinceStart = Math.floor(timeDiff / (1000 * 60 * 60 * 24));\r\n\r\n                    // Calculate how many cycles have passed\r\n                    // const cyclesPassed = Math.floor(daysSinceStart / interval);\r\n                    const daysIntoCurrentCycle = daysSinceStart % interval;\r\n\r\n                    // Next due is end of current cycle\r\n                    const daysRemaining = interval - daysIntoCurrentCycle;\r\n                    nextDue = new Date(today.getTime() + (daysRemaining * 24 * 60 * 60 * 1000));\r\n\r\n                    // Special case: If due today or passed but assumed future for strict calculation\r\n                    if (daysRemaining <= 0) {\r\n                        nextDue = new Date(today.getTime() + (interval * 24 * 60 * 60 * 1000));\r\n                    }\r\n                } else {\r\n                    // Simplification for daily/yearly\r\n                    return;\r\n                }\r\n\r\n                const diffDays = Math.ceil((nextDue.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\r\n\r\n                // Logic: Show regular bills 7 days prior, but Custom/Recharges specifically 2 days prior as requested\r\n                const alertWindow = r.frequency === 'custom' ? 2 : 7;\r\n\r\n                if (diffDays <= alertWindow && diffDays >= 0) {\r\n                    upcomingDues.push({ name: r.description || 'Subscription', amount: r.amount, dueDate: nextDue, type: r.frequency === 'custom' ? 'Recharge' : 'Bill' });\r\n                }\r\n            }\r\n        });\r\n\r\n        // 4. Generate Smart Alerts\r\n        upcomingDues.forEach(due => {\r\n            const isLiquidityBreach = availableLiquidity < due.amount;\r\n            const daysLeft = Math.ceil((due.dueDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\r\n\r\n            if (isLiquidityBreach && daysLeft <= 3) {\r\n                // CRITICAL SMART ALERT\r\n                const alert: Notification = {\r\n                    id: `smart_breach_${due.name}_${due.dueDate.toISOString().split('T')[0]}`,\r\n                    type: 'alert',\r\n                    priority: 'high',\r\n                    category: 'reminders',\r\n                    title: 'Liquid Stability Warning',\r\n                    message: `Critical: Your '${due.name}' due on ${due.dueDate.toLocaleDateString()} (₹${due.amount}) exceeds current liquid cash (₹${availableLiquidity}). Clear assets or increase bank balance immediately.`,\r\n                    timestamp: new Date(),\r\n                    read: false\r\n                };\r\n                addNotifications(alert);\r\n                toast.error(alert.title, { description: alert.message, duration: 10000 });\r\n            } else if (daysLeft <= 1) {\r\n                // Standard Reminder\r\n                const reminder: Notification = {\r\n                    id: `reminder_${due.name}_${due.dueDate.toISOString().split('T')[0]}`,\r\n                    type: 'reminder',\r\n                    priority: 'medium',\r\n                    category: 'reminders',\r\n                    title: `${due.type} Due Soon`,\r\n                    message: `Reminder: '${due.name}' payment of ₹${due.amount} is due tomorrow (${due.dueDate.toLocaleDateString()}).`,\r\n                    timestamp: new Date(),\r\n                    read: false\r\n                };\r\n                addNotifications(reminder);\r\n                toast.info(reminder.title, { description: reminder.message });\r\n            }\r\n        });\r\n    }, [accounts, goals, emergencyFundAmount, liabilities, recurringTransactions, addNotifications]);\r\n\r\n    // Check for new achievements\r\n    const checkForAchievements = React.useCallback(() => {\r\n        if (authStatus !== 'authenticated') return;\r\n\r\n        const totalTransactions = expenses.length + incomes.length + debts.length;\r\n        const settledDebts = debts.filter((d: Debt) => d.status === \"settled\").length;\r\n        const completedGoals = goals.filter((g: Goal) => g.currentAmount >= g.targetAmount).length;\r\n        const totalIncome = incomes.reduce((sum: number, i: Income) => sum + i.amount, 0);\r\n        const totalExpenses = expenses.reduce((sum: number, e: Expense) => sum + e.amount, 0);\r\n        const savingsRate = totalIncome > 0 ? (totalIncome - totalExpenses) / totalIncome : 0;\r\n        const monthlySpendingRatio = totalIncome > 0 ? totalExpenses / totalIncome : 0;\r\n\r\n        const achievementData = {\r\n            totalTransactions,\r\n            totalGoals: goals.length,\r\n            completedGoals,\r\n            totalDebts: debts.length,\r\n            settledDebts,\r\n            savingsRate,\r\n            monthlySpendingRatio,\r\n            notificationsEnabled: settings.notificationsEnabled,\r\n            themeChanged: settings.theme !== \"system\",\r\n            aiInteractions: 0,\r\n            currentStreak: totalTransactions > 0 ? Math.min(totalTransactions, 3) : 0,\r\n            dailyLogin: true,\r\n            profileComplete: settings.name !== '' && settings.photoURL !== '',\r\n            totalAccounts: accounts.length,\r\n        };\r\n\r\n        const newAchievements = checkAchievements(achievementData, settings.unlockedAchievements);\r\n\r\n        if (newAchievements.length > 0) {\r\n            newAchievements.forEach((achievementId) => {\r\n                const achievement = getAchievement(achievementId);\r\n                if (achievement) {\r\n                    // Create notification\r\n                    const notification: Notification = {\r\n                        id: `notif_${achievementId}`,\r\n                        type: 'achievement',\r\n                        priority: 'low',\r\n                        category: 'achievements',\r\n                        title: 'Achievement Unlocked!',\r\n                        message: `${achievement.icon} ${achievement.name}`,\r\n                        timestamp: new Date(),\r\n                        read: false,\r\n                        achievementId: achievementId\r\n                    };\r\n                    addNotifications(notification);\r\n\r\n                    toast.success(\r\n                        `Achievement Unlocked: ${achievement.icon} ${achievement.name}!`,\r\n                        { duration: 5000 }\r\n                    );\r\n                }\r\n            });\r\n\r\n            // Update settings without triggering a full re-render loop - handled by separate updateSettings call\r\n            // We use a specific simpler update here to avoid circular dependency in API calling if possible,\r\n            // but updateSettings is safe enough.\r\n            updateSettings({\r\n                unlockedAchievements: [...settings.unlockedAchievements, ...newAchievements],\r\n            });\r\n        }\r\n\r\n        // Check for Guruji Insights (Spike detection)\r\n        // Limit to once per session or just check on significant changes\r\n        // For now, we'll check on expense changes and deduplicate by content roughly (or just rely on the user clearing them)\r\n        // A simple refinement: check if we already have a recent unread insight about the same thing?\r\n        // For MVP, just generating them is fine, but let's avoid duplicates in the same batch.\r\n\r\n        const insightMessages = generateGurujiInsights({ expenses, goals, userName: settings.name || 'Friend' });\r\n\r\n        if (insightMessages.length > 0) {\r\n            const newInsightNotifs: Notification[] = [];\r\n\r\n            insightMessages.forEach(msg => {\r\n                const notif = createInsightNotification(msg);\r\n                notif.priority = 'low';\r\n                notif.category = 'insights';\r\n                newInsightNotifs.push(notif);\r\n                toast(notif.title, { description: notif.message, icon: '🧘' });\r\n            });\r\n\r\n            if (newInsightNotifs.length > 0) {\r\n                addNotifications(newInsightNotifs);\r\n            }\r\n        }\r\n\r\n        checkSmartDues();\r\n    }, [authStatus, expenses, incomes, debts, goals, accounts, settings, addNotifications, updateSettings, checkSmartDues]);\r\n\r\n    useEffect(() => {\r\n        if (authStatus !== 'authenticated') return;\r\n        checkForAchievements();\r\n    }, [\r\n        authStatus,\r\n        checkForAchievements,\r\n        expenses,\r\n        incomes,\r\n        debts,\r\n        goals,\r\n        accounts,\r\n        settings,\r\n        updateSettings,\r\n        emergencyFundAmount,\r\n        liabilities,\r\n        recurringTransactions\r\n    ]);\r\n\r\n    // Load from multiple sources on mount\r\n    useEffect(() => {\r\n        loadInitialData();\r\n    }, [loadInitialData]);\r\n\r\n    // Sync state changes to localStorage\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(settings)), [settings]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.EXPENSES, JSON.stringify(expenses)), [expenses]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.INCOMES, JSON.stringify(incomes)), [incomes]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.DEBTS, JSON.stringify(debts)), [debts]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.GOALS, JSON.stringify(goals)), [goals]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.ACCOUNTS, JSON.stringify(accounts)), [accounts]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.INVESTMENTS, JSON.stringify(investments)), [investments]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.LIABILITIES, JSON.stringify(liabilities)), [liabilities]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.RECURRING, JSON.stringify(recurringTransactions)), [recurringTransactions]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.NOTIFICATIONS, JSON.stringify(notifications)), [notifications]);\r\n    useEffect(() => localStorage.setItem(STORAGE_KEYS.EMERGENCY_FUND, JSON.stringify(emergencyFundAmount)), [emergencyFundAmount]);\r\n\r\n\r\n    // ------------------------------------------------------------------\r\n    // Security & Inactivity\r\n    // ------------------------------------------------------------------\r\n    useEffect(() => {\r\n        if (authStatus !== 'authenticated') return;\r\n\r\n        let timeoutId: any;\r\n        const INACTIVITY_LIMIT = 10 * 60 * 1000; // 10 minutes for beta/safety\r\n\r\n        const resetTimer = () => {\r\n            clearTimeout(timeoutId);\r\n            timeoutId = setTimeout(() => {\r\n                logout();\r\n                toast.info(\"Session locked\", { description: \"You were logged out due to inactivity.\" });\r\n            }, INACTIVITY_LIMIT);\r\n        };\r\n\r\n        const activityEvents = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];\r\n        activityEvents.forEach(event => window.addEventListener(event, resetTimer));\r\n\r\n        // Background handling\r\n        const handleVisibilityChange = () => {\r\n            if (document.visibilityState === 'hidden' && authStatus === 'authenticated') {\r\n                logout();\r\n            }\r\n        };\r\n        document.addEventListener('visibilitychange', handleVisibilityChange);\r\n\r\n        // Capacitor App State handling\r\n        let appStateListener: any;\r\n        if (Capacitor.isNativePlatform()) {\r\n            App.addListener('appStateChange', ({ isActive }) => {\r\n                if (!isActive && authStatus === 'authenticated') {\r\n                    logout();\r\n                }\r\n            }).then(l => appStateListener = l);\r\n        }\r\n\r\n        resetTimer();\r\n\r\n        return () => {\r\n            clearTimeout(timeoutId);\r\n            activityEvents.forEach(event => window.removeEventListener(event, resetTimer));\r\n            document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n            if (appStateListener) appStateListener.remove();\r\n        };\r\n    }, [authStatus, logout]);\r\n\r\n    const loadInitialData = React.useCallback(async () => {\r\n        setIsLoading(true);\r\n\r\n        // 1. Try to load from LocalStorage first (Fast load)\r\n        try {\r\n            const storedSettings = localStorage.getItem(STORAGE_KEYS.SETTINGS);\r\n            if (storedSettings) {\r\n                const parsed = JSON.parse(storedSettings);\r\n                setSettings(parsed);\r\n                applyTheme(parsed.theme);\r\n            }\r\n\r\n            const storedExpenses = localStorage.getItem(STORAGE_KEYS.EXPENSES);\r\n            if (storedExpenses) setExpenses(JSON.parse(storedExpenses));\r\n\r\n            const storedIncomes = localStorage.getItem(STORAGE_KEYS.INCOMES);\r\n            if (storedIncomes) setIncomes(JSON.parse(storedIncomes));\r\n\r\n            const storedDebts = localStorage.getItem(STORAGE_KEYS.DEBTS);\r\n            if (storedDebts) setDebts(JSON.parse(storedDebts));\r\n\r\n            const storedGoals = localStorage.getItem(STORAGE_KEYS.GOALS);\r\n            if (storedGoals) setGoals(JSON.parse(storedGoals));\r\n\r\n            const storedAccounts = localStorage.getItem(STORAGE_KEYS.ACCOUNTS);\r\n            if (storedAccounts) setAccounts(JSON.parse(storedAccounts));\r\n\r\n            const storedInvestments = localStorage.getItem(STORAGE_KEYS.INVESTMENTS);\r\n            if (storedInvestments) setInvestments(JSON.parse(storedInvestments));\r\n\r\n            const storedLiabilities = localStorage.getItem(STORAGE_KEYS.LIABILITIES);\r\n            if (storedLiabilities) setLiabilities(JSON.parse(storedLiabilities));\r\n\r\n            const storedNotifications = localStorage.getItem(STORAGE_KEYS.NOTIFICATIONS);\r\n            if (storedNotifications) {\r\n                const parsed: Notification[] = JSON.parse(storedNotifications);\r\n                // Deduplicate and Prune on load\r\n                const unique = parsed.filter((v, i, a) => a.findIndex(t => t.id === v.id || (t.message === v.message && t.type === v.type)) === i);\r\n                setNotifications(unique.slice(0, 100));\r\n            }\r\n\r\n            const storedEmergencyFund = localStorage.getItem(STORAGE_KEYS.EMERGENCY_FUND);\r\n            if (storedEmergencyFund) setEmergencyFundAmount(JSON.parse(storedEmergencyFund));\r\n\r\n            const storedRecurring = localStorage.getItem(STORAGE_KEYS.RECURRING);\r\n            if (storedRecurring) setRecurringTransactions(JSON.parse(storedRecurring));\r\n\r\n            const storedRememberedMobile = localStorage.getItem(STORAGE_KEYS.REMEMBERED_MOBILE);\r\n            if (storedRememberedMobile) {\r\n                setRememberedMobile(storedRememberedMobile);\r\n                setPendingMobile(storedRememberedMobile);\r\n                setIsRememberedUser(true);\r\n            }\r\n\r\n            const storedDeletion = localStorage.getItem(STORAGE_KEYS.DELETION_SCHEDULE);\r\n            if (storedDeletion) {\r\n                const deletionTime = new Date(storedDeletion).getTime();\r\n                const now = new Date().getTime();\r\n\r\n                if (now >= deletionTime) {\r\n                    // 30 days have passed. Execute total purge.\r\n                    purgeAllData();\r\n                    console.warn(\"Account purge executed based on schedule.\");\r\n                } else {\r\n                    setDeletionDate(storedDeletion);\r\n                }\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(\"Error loading specific local data:\", e);\r\n        }\r\n\r\n        // 2. Fetch from API (Sync)\r\n        await fetchFromApi();\r\n\r\n        // 3. Subscription Migration (One-time or periodic scan)\r\n        const hasMigrationRun = localStorage.getItem('finhub_subscription_migration_v3');\r\n        if (!hasMigrationRun && userId) {\r\n            runCategorizationMigration();\r\n            localStorage.setItem('finhub_subscription_migration_v3', 'true');\r\n        }\r\n\r\n        setIsLoading(false);\r\n    }, [userId, fetchFromApi, runCategorizationMigration, applyTheme]);\r\n    const runCategorizationMigration = React.useCallback(() => {\r\n        setExpenses(prevExpenses => {\r\n            let updatedCount = 0;\r\n            const nextExpenses = prevExpenses.map(e => {\r\n                const genericCategories = ['other', 'bills & utilities', 'entertainment', 'shopping', '', undefined];\r\n                const suggestion = autoCategorize(e.description);\r\n\r\n                if (suggestion && suggestion.category === 'Subscription') {\r\n                    const shouldUpdateCategory = genericCategories.includes(e.category?.toLowerCase()) || !e.category;\r\n                    const shouldUpdateRecurring = !e.isRecurring;\r\n\r\n                    if (shouldUpdateCategory || shouldUpdateRecurring) {\r\n                        updatedCount++;\r\n                        return {\r\n                            ...e,\r\n                            category: 'Subscription',\r\n                            isRecurring: true\r\n                        };\r\n                    }\r\n                }\r\n                return e;\r\n            });\r\n\r\n            if (updatedCount > 0) {\r\n                toast.info(`Intelligence protocol: Identified and moved ${updatedCount} transactions to Subscriptions.`);\r\n\r\n                // One-time auto-creation of RecurringTransaction templates for found subscriptions\r\n                // We do this by finding the most recent expense for each unique subscription description\r\n                const subExpenses = nextExpenses.filter(e => e.category === 'Subscription');\r\n                const uniqueSubs = new Map<string, Expense>();\r\n\r\n                subExpenses.forEach(e => {\r\n                    const name = e.description.toLowerCase().trim();\r\n                    if (!uniqueSubs.has(name) || new Date(e.date) > new Date(uniqueSubs.get(name)!.date)) {\r\n                        uniqueSubs.set(name, e);\r\n                    }\r\n                });\r\n\r\n                // Create recurring entries for those that don't exist yet\r\n                uniqueSubs.forEach((exp, name) => {\r\n                    const alreadyTracked = recurringTransactions.some(rt =>\r\n                        rt.description?.toLowerCase().includes(name) ||\r\n                        name.includes(rt.description?.toLowerCase() || '')\r\n                    );\r\n\r\n                    if (!alreadyTracked) {\r\n                        // Create it (using a timeout to avoid triggering multiple state updates synchronously)\r\n                        setTimeout(() => {\r\n                            createRecurringTransaction({\r\n                                type: 'expense',\r\n                                description: exp.description,\r\n                                amount: exp.amount,\r\n                                category: 'Subscription',\r\n                                accountId: exp.accountId,\r\n                                frequency: 'monthly',\r\n                                startDate: exp.date,\r\n                                tags: ['auto-migrated']\r\n                            });\r\n                        }, 100);\r\n                    }\r\n                });\r\n            }\r\n            return nextExpenses;\r\n        });\r\n    }, [recurringTransactions, createRecurringTransaction]);\r\n\r\n    const fetchFromApi = React.useCallback(async () => {\r\n        try {\r\n            // Auto-process recurring\r\n            try {\r\n                await api.processRecurring(userId);\r\n            } catch (e) { console.error(\"Skip recurring process\", e) }\r\n\r\n            // Fetch all concurrently\r\n            const [\r\n                settingsRes,\r\n                accountsRes,\r\n                expensesRes,\r\n                incomesRes,\r\n                debtsRes,\r\n                goalsRes,\r\n                liabilitiesRes,\r\n                investmentsRes,\r\n                recurringRes\r\n            ] = await Promise.all([\r\n                api.getSettings(userId).catch(() => ({ success: false, settings: undefined })),\r\n                api.getAccounts(userId).catch(() => ({ success: false, accounts: [] })),\r\n                api.getExpenses(userId).catch(() => ({ success: false, expenses: [] })),\r\n                api.getIncomes(userId).catch(() => ({ success: false, incomes: [] })),\r\n                api.getDebts(userId).catch(() => ({ success: false, debts: [] })),\r\n                api.getGoals(userId).catch(() => ({ success: false, goals: [] })),\r\n                api.getLiabilities(userId).catch(() => ({ success: false, liabilities: [] })),\r\n                api.getInvestments(userId).catch(() => ({ success: false, investments: [] })),\r\n                api.getRecurring(userId).catch(() => ({ success: false, recurring: [] })),\r\n            ]);\r\n\r\n            setIsOffline(false);\r\n            setApiStatus('online');\r\n\r\n            if (settingsRes.success && settingsRes.settings) {\r\n                // Merge server settings with local settings to preserve local-only fields like aiProvider and apiKeys\r\n                setSettings(prev => ({\r\n                    ...prev,\r\n                    ...settingsRes.settings,\r\n                    // Specifically preserve these if missing from server response\r\n                    aiProvider: settingsRes.settings.aiProvider || prev.aiProvider,\r\n                    apiKeys: { ...prev.apiKeys, ...settingsRes.settings.apiKeys }\r\n                }));\r\n                applyTheme(settingsRes.settings.theme);\r\n            }\r\n            if (accountsRes.success) setAccounts(accountsRes.accounts || []);\r\n            if (expensesRes.success) setExpenses(expensesRes.expenses || []);\r\n            if (incomesRes.success) setIncomes(incomesRes.incomes || []);\r\n            if (debtsRes.success) setDebts(debtsRes.debts || []);\r\n            if (goalsRes.success) setGoals(goalsRes.goals || []);\r\n            if (liabilitiesRes.success) setLiabilities(liabilitiesRes.liabilities || []);\r\n            if (investmentsRes.success) setInvestments(investmentsRes.investments || []);\r\n            if (recurringRes.success) setRecurringTransactions(recurringRes.recurring || []);\r\n\r\n            toast.success(\"Sync complete\");\r\n\r\n        } catch (error) {\r\n            console.error(\"API Sync failed, using local data\", error);\r\n            setIsOffline(true);\r\n            setApiStatus('offline');\r\n            // toast.error(\"Sync failed - using offline mode\");\r\n        }\r\n    }, [userId, applyTheme]);\r\n\r\n    const refreshData = async () => {\r\n        setIsRefreshing(true);\r\n        await fetchFromApi();\r\n        setIsRefreshing(false);\r\n    };\r\n\r\n    const applyTheme = React.useCallback((theme: \"light\" | \"dark\" | \"system\") => {\r\n        if (theme === \"system\") {\r\n            const prefersDark = window.matchMedia(\"(prefers-color-scheme: dark)\").matches;\r\n            document.documentElement.classList.toggle(\"dark\", prefersDark);\r\n        } else {\r\n            document.documentElement.classList.toggle(\"dark\", theme === \"dark\");\r\n        }\r\n    }, []);\r\n\r\n    // ------------------------------------------------------------------\r\n    // Auth Actions\r\n    // ------------------------------------------------------------------\r\n\r\n    const checkIdentity = async (mobile: string) => {\r\n        setPendingMobile(mobile);\r\n        // Simulate API check\r\n        const isExistingUser = DEMO_USERS.some(u => u.mobile === mobile) ||\r\n            localStorage.getItem(`finhub_user_${mobile}`) !== null;\r\n\r\n        setIsAwaitingPin(true);\r\n        return isExistingUser;\r\n    };\r\n\r\n    const login = async (pin: string, rememberMe: boolean = false) => {\r\n        // Authenticating state triggers LoadingSprite\r\n        setAuthMessage({ message: \"Validating PIN\", subMessage: \"Verifying secure node access...\" });\r\n        setAuthStatus('authenticating');\r\n\r\n        // Artificial delay for Loading Sprite showcase\r\n        await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n        const demoUser = DEMO_USERS.find(u => u.mobile === pendingMobile && u.pin === pin);\r\n\r\n        let authenticatedUser: AuthUser | null = null;\r\n\r\n        if (demoUser) {\r\n            authenticatedUser = {\r\n                id: demoUser.userId,\r\n                mobile: demoUser.mobile,\r\n                name: demoUser.name\r\n            };\r\n        } else {\r\n            const storedUser = localStorage.getItem(`finhub_user_${pendingMobile}`);\r\n            if (storedUser) {\r\n                const parsed = JSON.parse(storedUser);\r\n                if (parsed.pin === pin) {\r\n                    authenticatedUser = {\r\n                        id: parsed.userId,\r\n                        mobile: parsed.mobile,\r\n                        name: parsed.name\r\n                    };\r\n                }\r\n            }\r\n        }\r\n\r\n        if (authenticatedUser) {\r\n            setCurrentUser(authenticatedUser);\r\n            localStorage.setItem(STORAGE_KEYS.AUTH, JSON.stringify(authenticatedUser));\r\n            setAuthMessage({ message: \"Handshake Success\", subMessage: \"Synchronizing decrypted ledger...\" });\r\n            setAuthStatus('authenticated');\r\n            setIsAwaitingPin(false);\r\n\r\n            // Handle deletion cancellation on login\r\n            if (deletionDate) {\r\n                await cancelAccountDeletion();\r\n                toast.success('Your account deletion request has been canceled. Welcome back!');\r\n            }\r\n\r\n            if (rememberMe) {\r\n                localStorage.setItem(STORAGE_KEYS.REMEMBERED_MOBILE, pendingMobile);\r\n                setRememberedMobile(pendingMobile);\r\n                setIsRememberedUser(true);\r\n            } else {\r\n                // If they explicitly log in without remember me, we might want to clear it \r\n                // but the requirement says \"Smart Prompt\" if they didn't check it.\r\n                // So we leave existing remembered mobile but don't update it to THIS session if different.\r\n            }\r\n\r\n            return true;\r\n        } else {\r\n            setAuthMessage(undefined);\r\n            setAuthStatus('guest'); // Reset to guest on failure\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const sendOtp = async (mobile: string) => {\r\n        setPendingMobile(mobile);\r\n        // Simulate OTP generation\r\n        const mockOtp = Math.floor(1000 + Math.random() * 9000).toString();\r\n        setGeneratedOtp(mockOtp);\r\n        console.log(`[AUTH-DEBUG] Mock OTP for ${mobile}: ${mockOtp}`);\r\n\r\n        // Show simulated toast\r\n        toast.info(\"Verification code sent\", {\r\n            description: `Dev Mode: Use ${mockOtp} (Simulated SMS)`\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    const verifyOtp = async (_mobile: string, otp: string) => {\r\n        // Skip check in testing phase as requested, but we'll show logic\r\n        if (otp === \"0000\" || otp === generatedOtp) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    const resetPin = async (mobile: string, newPin: string) => {\r\n        const storedUser = localStorage.getItem(`finhub_user_${mobile}`);\r\n        if (storedUser) {\r\n            const parsed = JSON.parse(storedUser);\r\n            parsed.pin = newPin;\r\n            localStorage.setItem(`finhub_user_${mobile}`, JSON.stringify(parsed));\r\n            toast.success(\"PIN reset successfully\");\r\n            return true;\r\n        }\r\n        // Also check demo users (can't really reset them permanently in localStorage easily without shadowing)\r\n        const demoUserIndex = DEMO_USERS.findIndex(u => u.mobile === mobile);\r\n        if (demoUserIndex !== -1) {\r\n            // Shadow demo user in localStorage\r\n            const shadowedUser = {\r\n                ...DEMO_USERS[demoUserIndex],\r\n                pin: newPin\r\n            };\r\n            localStorage.setItem(`finhub_user_${mobile}`, JSON.stringify(shadowedUser));\r\n            toast.success(\"Demo user PIN updated locally\");\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    const signup = async (mobile: string, pin: string, name: string, rememberMe: boolean = false) => {\r\n        setAuthMessage({ message: \"Creating Node\", subMessage: \"Initializing secure identity protocols...\" });\r\n        setAuthStatus('authenticating');\r\n        await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n        const newUser: AuthUser & { pin: string } = {\r\n            id: `user_${Date.now()}`,\r\n            mobile,\r\n            name,\r\n            pin\r\n        };\r\n\r\n        localStorage.setItem(`finhub_user_${mobile}`, JSON.stringify(newUser));\r\n        const authUser: AuthUser = { id: newUser.id, mobile: newUser.mobile, name: newUser.name };\r\n        setCurrentUser(authUser);\r\n        localStorage.setItem(STORAGE_KEYS.AUTH, JSON.stringify(authUser));\r\n        setAuthMessage({ message: \"Handshake Success\", subMessage: \"Synchronizing decrypted ledger...\" });\r\n        setAuthStatus('authenticated');\r\n        setIsAwaitingPin(false);\r\n\r\n        if (rememberMe) {\r\n            localStorage.setItem(STORAGE_KEYS.REMEMBERED_MOBILE, mobile);\r\n            setRememberedMobile(mobile);\r\n            setIsRememberedUser(true);\r\n            return true;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    const logout = React.useCallback(() => {\r\n        setAuthStatus('guest');\r\n        setCurrentUser(null);\r\n        setGeneratedOtp(null);\r\n        localStorage.removeItem(STORAGE_KEYS.AUTH);\r\n        // If not remembered, clear the pending mobile so it asks for username next time\r\n        if (!isRememberedUser) {\r\n            setPendingMobile('');\r\n        }\r\n    }, [isRememberedUser]);\r\n    const clearPendingSession = () => {\r\n        setAuthStatus('guest');\r\n        setCurrentUser(null);\r\n        setPendingMobile('');\r\n        setGeneratedOtp(null);\r\n        localStorage.removeItem(STORAGE_KEYS.AUTH);\r\n        localStorage.removeItem(STORAGE_KEYS.REMEMBERED_MOBILE);\r\n        setRememberedMobile('');\r\n        setIsRememberedUser(false);\r\n    };\r\n\r\n    const scheduleAccountDeletion = async () => {\r\n        const date = new Date();\r\n        date.setDate(date.getDate() + 30);\r\n        const dateString = date.toISOString();\r\n\r\n        setDeletionDate(dateString);\r\n        localStorage.setItem(STORAGE_KEYS.DELETION_SCHEDULE, dateString);\r\n\r\n        toast.warning('Account scheduled for deletion in 30 days.');\r\n        logout();\r\n    };\r\n\r\n    const cancelAccountDeletion = async () => {\r\n        setDeletionDate(null);\r\n        localStorage.removeItem(STORAGE_KEYS.DELETION_SCHEDULE);\r\n    };\r\n\r\n    const purgeAllData = () => {\r\n        // Clear all known storage keys\r\n        Object.values(STORAGE_KEYS).forEach(key => {\r\n            localStorage.removeItem(key);\r\n        });\r\n\r\n        // Reset state\r\n        setExpenses([]);\r\n        setIncomes([]);\r\n        setDebts([]);\r\n        setGoals([]);\r\n        setAccounts([]);\r\n        setInvestments([]);\r\n        setLiabilities([]);\r\n        setRecurringTransactions([]);\r\n        setNotifications([]);\r\n        setEmergencyFundAmount(0);\r\n        setDeletionDate(null);\r\n        setAuthStatus('guest');\r\n        setCurrentUser(null);\r\n\r\n        toast.info('Session purged successfully.');\r\n    };\r\n\r\n    // Auto-login from storage - Restore session context but require PIN\r\n    useEffect(() => {\r\n        const storedAuth = localStorage.getItem(STORAGE_KEYS.AUTH);\r\n        if (storedAuth) {\r\n            try {\r\n                const user = JSON.parse(storedAuth);\r\n                if (user && user.mobile) {\r\n                    setPendingMobile(user.mobile);\r\n                    // We stay as 'guest' so App.tsx shows LoginScreen\r\n                    // LoginScreen will detect pendingMobile and show PIN verify phase\r\n                    setAuthStatus('guest');\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Failed to parse stored auth\", e);\r\n                localStorage.removeItem(STORAGE_KEYS.AUTH);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // ------------------------------------------------------------------\r\n    // Actions\r\n    // ------------------------------------------------------------------\r\n\r\n    const updateSettings = async (updates: Partial<UserSettings>) => {\r\n        // Optimistic update\r\n        const newSettings = { ...settings, ...updates };\r\n        setSettings(newSettings);\r\n        if (updates.theme) applyTheme(updates.theme);\r\n\r\n        try {\r\n            const response = await api.updateSettings(userId, updates);\r\n            if (response.success) {\r\n                // Merge response with existing state to avoid losing local-only fields\r\n                setSettings(prev => ({\r\n                    ...prev,\r\n                    ...response.settings,\r\n                    aiProvider: response.settings.aiProvider || prev.aiProvider,\r\n                    apiKeys: { ...prev.apiKeys, ...response.settings.apiKeys }\r\n                }));\r\n            } else {\r\n                throw new Error(response.error);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to sync settings\", error);\r\n            toast.error(\"Settings saved locally only\");\r\n        }\r\n    };\r\n\r\n    // --- Recurring ---\r\n    const updateRecurringTransaction = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateRecurring(userId, id, data);\r\n            if (response.success) {\r\n                const updatedRec = response.recurring as RecurringTransaction;\r\n                setRecurringTransactions(prev => prev.map(r => r.id === id ? updatedRec : r));\r\n                toast.success('Recurring transaction updated');\r\n\r\n                // Auto-Backfill Logic (Standardized Refactor)\r\n                if (updatedRec.startDate) {\r\n                    console.log(\"[Backfill Debug Update] Analysis starting for:\", updatedRec.description || updatedRec.source);\r\n                    toast.info(\"Analyzing transaction history...\");\r\n\r\n                    const localNow = new Date();\r\n                    const nowStr = `${localNow.getFullYear()}-${String(localNow.getMonth() + 1).padStart(2, '0')}-${String(localNow.getDate()).padStart(2, '0')}`;\r\n                    const startStr = updatedRec.startDate.split('T')[0];\r\n\r\n                    console.log(\"[Backfill Debug Update] nowStr:\", nowStr, \"startStr:\", startStr);\r\n\r\n                    if (startStr <= nowStr && updatedRec.type) {\r\n                        const [sY, sM, sD] = startStr.split('-').map(Number);\r\n                        const current = new Date(sY, sM - 1, sD, 12, 0, 0);\r\n                        const dueDates: Date[] = [];\r\n                        let safety = 0;\r\n\r\n                        while (safety < 1200) {\r\n                            const cY = current.getFullYear();\r\n                            const cM = current.getMonth();\r\n                            const cD = current.getDate();\r\n                            const currentStr = `${cY}-${String(cM + 1).padStart(2, '0')}-${String(cD).padStart(2, '0')}`;\r\n                            if (currentStr > nowStr) break;\r\n                            dueDates.push(new Date(current));\r\n\r\n                            switch (updatedRec.frequency) {\r\n                                case 'daily': current.setDate(current.getDate() + 1); break;\r\n                                case 'weekly': current.setDate(current.getDate() + 7); break;\r\n                                case 'monthly': {\r\n                                    const origDay = sD;\r\n                                    current.setMonth(current.getMonth() + 1);\r\n                                    if (current.getDate() < origDay && current.getMonth() === (cM + 2) % 12) {\r\n                                        current.setDate(0);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                                case 'yearly': current.setFullYear(current.getFullYear() + 1); break;\r\n                                case 'custom':\r\n                                    current.setDate(current.getDate() + (updatedRec.customIntervalDays || 30));\r\n                                    break;\r\n                                default: current.setMonth(current.getMonth() + 1);\r\n                            }\r\n                            safety++;\r\n                        }\r\n\r\n                        console.log(\"[Backfill Debug Update] Generated\", dueDates.length, \"due dates\");\r\n\r\n                        const recAmount = Number(updatedRec.amount);\r\n                        const recDesc = (updatedRec.description || updatedRec.source || '').toLowerCase().trim();\r\n\r\n                        const missingDates = dueDates.filter(due => {\r\n                            const dStr = `${due.getFullYear()}-${String(due.getMonth() + 1).padStart(2, '0')}-${String(due.getDate()).padStart(2, '0')}`;\r\n\r\n                            const exists = [...expenses, ...incomes].some(tx => {\r\n                                const txDate = (tx.date || '').split('T')[0];\r\n                                const txAmount = Number(tx.amount);\r\n                                const txDesc = (('description' in tx ? tx.description : (tx as any).source) || '').toLowerCase().trim();\r\n\r\n                                const amountMatch = Math.abs(txAmount - recAmount) < 0.01;\r\n                                const descMatch = txDesc.includes(recDesc) || recDesc.includes(txDesc);\r\n\r\n                                // Frequency-aware date matching\r\n                                let dateMatch = txDate === dStr;\r\n                                if (updatedRec.frequency === 'monthly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    const diff = Math.abs(tDate.getDate() - due.getDate());\r\n                                    dateMatch = tDate.getFullYear() === due.getFullYear() &&\r\n                                        tDate.getMonth() === due.getMonth() &&\r\n                                        diff <= 7;\r\n                                } else if (updatedRec.frequency === 'weekly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    const diff = Math.abs(tDate.getTime() - due.getTime()) / (1000 * 60 * 60 * 24);\r\n                                    dateMatch = diff <= 3;\r\n                                } else if (updatedRec.frequency === 'yearly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    dateMatch = tDate.getFullYear() === due.getFullYear();\r\n                                }\r\n\r\n                                // Link matching (if previously recorded)\r\n                                const linkMatch = tx.recurringId === updatedRec.id;\r\n\r\n                                return (descMatch || linkMatch) && dateMatch && amountMatch;\r\n                            });\r\n                            return !exists;\r\n                        });\r\n\r\n                        console.log(`[Backfill Debug Update] Total Expected: ${dueDates.length}, Missing: ${missingDates.length}`);\r\n\r\n                        if (missingDates.length > 0) {\r\n                            console.log(\"[Backfill Debug Update] Triggering popup request for\", missingDates.length, \"dates\");\r\n                            setBackfillRequest({\r\n                                count: missingDates.length,\r\n                                dates: missingDates,\r\n                                recurring: updatedRec\r\n                            });\r\n                        } else {\r\n                            console.log(\"[Backfill Debug Update] All expected entries already exist in history.\");\r\n                            toast.success(\"Transaction history is already up to date.\");\r\n                        }\r\n                    } else {\r\n                        console.log(\"[Backfill Debug Update] Skip: start date is in the future or invalid type.\");\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error updating recurring transaction:', error);\r\n            setRecurringTransactions(prev => prev.map(r => r.id === id ? { ...r, ...data } : r));\r\n            toast.warning('Updated locally');\r\n        }\r\n    };\r\n\r\n    const createRecurringTransaction = async (data: any) => {\r\n        try {\r\n            console.log(\"[Backfill Debug] createRecurringTransaction called with:\", data);\r\n            const response = await api.createRecurring(userId, data);\r\n            if (response.success) {\r\n                const newRec = response.recurring;\r\n                setRecurringTransactions(prev => [...prev, newRec]);\r\n                toast.success('Recurring transaction created');\r\n\r\n                // Auto-Backfill Logic (Timezone-Safe Refactor)\r\n                if (newRec.startDate) {\r\n                    console.log(\"[Backfill Debug] Analysis starting for:\", newRec.description || newRec.source);\r\n                    toast.info(\"Analyzing transaction history...\");\r\n\r\n                    const localNow = new Date();\r\n                    const nowStr = `${localNow.getFullYear()}-${String(localNow.getMonth() + 1).padStart(2, '0')}-${String(localNow.getDate()).padStart(2, '0')}`;\r\n                    const startStr = newRec.startDate.split('T')[0];\r\n\r\n                    console.log(\"[Backfill Debug] nowStr:\", nowStr, \"startStr:\", startStr);\r\n\r\n                    if (startStr <= nowStr && newRec.type) {\r\n                        const [sY, sM, sD] = startStr.split('-').map(Number);\r\n                        const current = new Date(sY, sM - 1, sD, 12, 0, 0);\r\n                        const dueDates: Date[] = [];\r\n                        let safety = 0;\r\n\r\n                        while (safety < 1200) {\r\n                            const cY = current.getFullYear();\r\n                            const cM = current.getMonth();\r\n                            const cD = current.getDate();\r\n                            const currentStr = `${cY}-${String(cM + 1).padStart(2, '0')}-${String(cD).padStart(2, '0')}`;\r\n                            if (currentStr > nowStr) break;\r\n                            dueDates.push(new Date(current));\r\n\r\n                            switch (newRec.frequency) {\r\n                                case 'daily': current.setDate(current.getDate() + 1); break;\r\n                                case 'weekly': current.setDate(current.getDate() + 7); break;\r\n                                case 'monthly': {\r\n                                    const origDay = sD;\r\n                                    current.setMonth(current.getMonth() + 1);\r\n                                    if (current.getDate() < origDay && current.getMonth() === (cM + 2) % 12) {\r\n                                        current.setDate(0);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                                case 'yearly': current.setFullYear(current.getFullYear() + 1); break;\r\n                                case 'custom':\r\n                                    current.setDate(current.getDate() + (newRec.customIntervalDays || 30));\r\n                                    break;\r\n                                default: current.setMonth(current.getMonth() + 1);\r\n                            }\r\n                            safety++;\r\n                        }\r\n\r\n                        console.log(\"[Backfill Debug] Generated\", dueDates.length, \"due dates\");\r\n\r\n                        const recAmount = Number(newRec.amount);\r\n                        const recDesc = (newRec.description || newRec.source || '').toLowerCase().trim();\r\n\r\n                        const missingDates = dueDates.filter(due => {\r\n                            const dStr = `${due.getFullYear()}-${String(due.getMonth() + 1).padStart(2, '0')}-${String(due.getDate()).padStart(2, '0')}`;\r\n\r\n                            const exists = [...expenses, ...incomes].some(tx => {\r\n                                const txDate = (tx.date || '').split('T')[0];\r\n                                const txAmount = Number(tx.amount);\r\n                                const txDesc = (('description' in tx ? tx.description : (tx as any).source) || '').toLowerCase().trim();\r\n\r\n                                const amountMatch = Math.abs(txAmount - recAmount) < 0.01;\r\n                                const descMatch = txDesc.includes(recDesc) || recDesc.includes(txDesc);\r\n\r\n                                // Frequency-aware date matching\r\n                                let dateMatch = txDate === dStr;\r\n                                if (newRec.frequency === 'monthly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    const diff = Math.abs(tDate.getDate() - due.getDate());\r\n                                    dateMatch = tDate.getFullYear() === due.getFullYear() &&\r\n                                        tDate.getMonth() === due.getMonth() &&\r\n                                        diff <= 7;\r\n                                } else if (newRec.frequency === 'weekly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    const diff = Math.abs(tDate.getTime() - due.getTime()) / (1000 * 60 * 60 * 24);\r\n                                    dateMatch = diff <= 3;\r\n                                } else if (newRec.frequency === 'yearly') {\r\n                                    const tDate = new Date(txDate);\r\n                                    dateMatch = tDate.getFullYear() === due.getFullYear();\r\n                                }\r\n\r\n                                // Link matching\r\n                                const linkMatch = tx.recurringId === newRec.id;\r\n\r\n                                return (descMatch || linkMatch) && dateMatch && amountMatch;\r\n                            });\r\n                            return !exists;\r\n                        });\r\n\r\n                        console.log(`[Backfill Debug] Total Expected: ${dueDates.length}, Missing: ${missingDates.length}`);\r\n\r\n                        if (missingDates.length > 0) {\r\n                            console.log(\"[Backfill Debug] Triggering popup request for\", missingDates.length, \"dates\");\r\n                            setBackfillRequest({\r\n                                count: missingDates.length,\r\n                                dates: missingDates,\r\n                                recurring: newRec\r\n                            });\r\n                        } else {\r\n                            console.log(\"[Backfill Debug] All expected entries already exist in history.\");\r\n                            toast.success(\"Transaction history is already up to date.\");\r\n                        }\r\n                    } else {\r\n                        console.log(\"[Backfill Debug] Skip: start date is in the future or invalid type.\");\r\n                    }\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error creating recurring transaction:', error);\r\n            const temp = { id: `temp_${Date.now()}`, ...data, createdAt: new Date().toISOString() };\r\n            setRecurringTransactions(prev => [...prev, temp]);\r\n            toast.warning('Offline: Created locally');\r\n        }\r\n    };\r\n\r\n    const executeBackfill = async () => {\r\n        if (!backfillRequest) return;\r\n        const { count, dates, recurring: newRec } = backfillRequest;\r\n\r\n        // Clear request immediately to prevent duplicate triggers from UI\r\n        setBackfillRequest(null);\r\n\r\n        const toastId = toast.loading(`Generating ${count} entries...`);\r\n        const createdIncomes: any[] = [];\r\n        const createdExpenses: any[] = [];\r\n        let balanceChange = 0;\r\n        const targetAccount = accounts.find(a => a.id === newRec.accountId);\r\n\r\n        console.log(`[Backfill Execution] Starting batch for: ${newRec.description || newRec.source}`);\r\n\r\n        const goalChanges: Record<string, number> = {};\r\n        const liabilityChanges: Record<string, number> = {};\r\n\r\n        try {\r\n            for (const due of dates) {\r\n                const dateStr = `${due.getFullYear()}-${String(due.getMonth() + 1).padStart(2, '0')}-${String(due.getDate()).padStart(2, '0')}`;\r\n                const txData = {\r\n                    description: newRec.description,\r\n                    source: newRec.source,\r\n                    amount: newRec.amount,\r\n                    category: newRec.category,\r\n                    date: dateStr,\r\n                    tags: [...(newRec.tags || []), 'auto-backfill'],\r\n                    accountId: newRec.accountId,\r\n                    isRecurring: true,\r\n                    recurringId: newRec.id,\r\n                    liabilityId: newRec.liabilityId,\r\n                    investmentId: newRec.investmentId\r\n                };\r\n\r\n                console.log(`[Backfill Execution] Creating entry for ${dateStr}...`);\r\n\r\n                if (newRec.type === 'expense') {\r\n                    const res = await api.createExpense(userId, txData);\r\n                    if (res.success) {\r\n                        createdExpenses.push(res.expense);\r\n                        if (targetAccount) {\r\n                            if (targetAccount.type === 'credit_card') balanceChange += res.expense.amount;\r\n                            else balanceChange -= res.expense.amount;\r\n                        }\r\n\r\n                        if (newRec.goalId) {\r\n                            goalChanges[newRec.goalId] = (goalChanges[newRec.goalId] || 0) + res.expense.amount;\r\n                        }\r\n\r\n                        if (newRec.liabilityId) {\r\n                            liabilityChanges[newRec.liabilityId] = (liabilityChanges[newRec.liabilityId] || 0) + res.expense.amount;\r\n                        }\r\n                    }\r\n                } else {\r\n                    const res = await api.createIncome(userId, txData);\r\n                    if (res.success) {\r\n                        createdIncomes.push(res.income);\r\n                        if (targetAccount) {\r\n                            if (targetAccount.type === 'credit_card') balanceChange -= res.income.amount;\r\n                            else balanceChange += res.income.amount;\r\n                        }\r\n                    }\r\n                }\r\n                // Small delay to prevent rate limiting or UI freezing\r\n                await new Promise(r => setTimeout(r, 30));\r\n            }\r\n\r\n            // State Updates and Sync\r\n            if (createdIncomes.length > 0) setIncomes(prev => [...prev, ...createdIncomes]);\r\n            if (createdExpenses.length > 0) setExpenses(prev => [...prev, ...createdExpenses]);\r\n\r\n            // Batch update Goals\r\n            for (const [gid, change] of Object.entries(goalChanges)) {\r\n                const goal = goals.find(g => g.id === gid);\r\n                if (goal) {\r\n                    const newAmount = goal.currentAmount + change;\r\n                    await api.updateGoal(userId, gid, { currentAmount: newAmount });\r\n                    setGoals(prev => prev.map(g => g.id === gid ? { ...g, currentAmount: newAmount } : g));\r\n                }\r\n            }\r\n\r\n            // Batch update Liabilities\r\n            for (const [lid, change] of Object.entries(liabilityChanges)) {\r\n                const liability = liabilities.find(l => l.id === lid);\r\n                if (liability) {\r\n                    const newOutstanding = Math.max(0, liability.outstanding - change);\r\n                    await api.updateLiability(userId, lid, { outstanding: newOutstanding });\r\n                    setLiabilities(prev => prev.map(l => l.id === lid ? { ...l, outstanding: newOutstanding } : l));\r\n                    console.log(`[Backfill] Corrected Liability ${liability.name} by ₹${change}`);\r\n                }\r\n            }\r\n\r\n            if (targetAccount && balanceChange !== 0) {\r\n                const newBalance = targetAccount.balance + balanceChange;\r\n                await api.updateAccount(userId, targetAccount.id, { balance: newBalance });\r\n                setAccounts(prev => prev.map(a => a.id === targetAccount.id ? { ...a, balance: newBalance } : a));\r\n            }\r\n\r\n            // Automatic dedupe scrub\r\n            await cleanupDuplicates();\r\n\r\n            toast.dismiss(toastId);\r\n            toast.success(`Success: ${count} entries generated`);\r\n        } catch (error) {\r\n            console.error('[Backfill Execution] Fatal error during batch:', error);\r\n            toast.dismiss(toastId);\r\n            toast.error('Backfill failed. Ledger might be partially updated.');\r\n        }\r\n    };\r\n\r\n    const deleteRecurringTransaction = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteRecurring(userId, id);\r\n            if (response.success) {\r\n                setRecurringTransactions(prev => prev.filter(r => r.id !== id));\r\n                toast.success('Recurring transaction deleted');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error deleting recurring transaction:', error);\r\n            setRecurringTransactions(prev => prev.filter(r => r.id !== id));\r\n            toast.warning('Deleted locally');\r\n        }\r\n    };\r\n\r\n    const processRecurringTransactions = async () => {\r\n        try {\r\n            const response = await api.processRecurring(userId);\r\n            if (response.success) {\r\n                toast.success(`Processed ${response.count} transactions`);\r\n                await fetchFromApi();\r\n            }\r\n        } catch (error) {\r\n            console.error('Error processing recurring transactions:', error);\r\n            toast.error('Failed to process recurring transactions');\r\n        }\r\n    };\r\n\r\n    // --- Expenses ---\r\n    const createExpense = async (data: any) => {\r\n        try {\r\n            // 1. Calculate Available to Spend (Global Check)\r\n            // Re-calculate strictly to ensure latest state\r\n            const totalBankBalance = accounts.reduce((sum, acc) => sum + (acc.type !== 'credit_card' ? acc.balance : 0), 0);\r\n            const shadowWalletTotal = goals.reduce((sum, g) => sum + g.currentAmount, 0) + emergencyFundAmount;\r\n\r\n            // Calculate recurring commitments (simplified for now: sum of EMI + assuming some recurring ops)\r\n            //Ideally this comes from a hook, but calculating inline for atomicity\r\n            const totalCommitments = liabilities.reduce((sum, l) => sum + l.emiAmount, 0);\r\n\r\n            const availableToSpend = Math.max(0, totalBankBalance - shadowWalletTotal - totalCommitments);\r\n\r\n            const expenseAmount = data.amount;\r\n\r\n            // LEAKAGE PROTOCOL\r\n            if (expenseAmount > availableToSpend) {\r\n                const deficit = expenseAmount - availableToSpend;\r\n                console.warn(`⚠️ Leakage Detected! Deficit: ${deficit}. Initiating Shadow Wallet Protocol.`);\r\n\r\n                let remainingDeficit = deficit;\r\n                const assetsToDrain: { id: string, type: 'goal' | 'emergency', currentAmount: number, priority: number, name: string }[] = [];\r\n\r\n                // 2. Identify and Sort Liquid Assets\r\n                // Priority: 1. Growth (Drain First), 2. Stability, 3. Protection (Drain Last)\r\n                goals.forEach(g => {\r\n                    const type = g.type || 'growth';\r\n                    let priority = 1; // Default/Growth\r\n                    if (type === 'stability') priority = 2;\r\n                    if (type === 'protection') priority = 3;\r\n\r\n                    if (g.currentAmount > 0) {\r\n                        assetsToDrain.push({\r\n                            id: g.id,\r\n                            type: 'goal',\r\n                            currentAmount: g.currentAmount,\r\n                            priority,\r\n                            name: g.name\r\n                        });\r\n                    }\r\n                });\r\n\r\n                if (emergencyFundAmount > 0) {\r\n                    assetsToDrain.push({\r\n                        id: 'emergency-fund',\r\n                        type: 'emergency',\r\n                        currentAmount: emergencyFundAmount,\r\n                        priority: 3, // Protection/Highest Importance -> Drain Last\r\n                        name: 'Emergency Fund'\r\n                    });\r\n                }\r\n\r\n                // Sort: Drain lower priority (Start of array) first. \r\n                // Wait... Requirement: \"Subtract from Growth... then Stability... then Protection\"\r\n                // So Growth is \"First to be sacrificed\".\r\n                // Priority 1 (Growth) < Priority 3 (Protection).\r\n                assetsToDrain.sort((a, b) => a.priority - b.priority);\r\n\r\n                // 3. Drain Logic\r\n                const updatesToPerform: Promise<any>[] = [];\r\n                const notificationsToSend: Notification[] = [];\r\n\r\n                for (const asset of assetsToDrain) {\r\n                    if (remainingDeficit <= 0) break;\r\n\r\n                    const amountToTake = Math.min(asset.currentAmount, remainingDeficit);\r\n                    remainingDeficit -= amountToTake;\r\n\r\n                    if (asset.type === 'goal') {\r\n                        const newAmount = asset.currentAmount - amountToTake;\r\n                        // Determine new status: if taking anything, it's leaking.\r\n                        updatesToPerform.push(updateGoal(asset.id, {\r\n                            currentAmount: newAmount,\r\n                            status: 'leaking'\r\n                        }));\r\n\r\n                        // Check if we already notified about this wallet today? \r\n                        // Simplified: Just add notification now, debounce locally if needed.\r\n                        notificationsToSend.push({\r\n                            id: `leak_${asset.id}_${new Date().toISOString().split('T')[0]}`, // ID based on day\r\n                            type: 'alert',\r\n                            priority: 'medium',\r\n                            category: 'transactions',\r\n                            title: 'Shadow Wallet Leakage',\r\n                            message: `₹${amountToTake} spent reduced your '${asset.name}' reserve.`,\r\n                            timestamp: new Date(),\r\n                            read: false\r\n                        });\r\n\r\n                    } else if (asset.type === 'emergency') {\r\n                        updatesToPerform.push(Promise.resolve(setEmergencyFundAmount(prev => prev - amountToTake))); // Local update wrapper\r\n                        // Also persist to storage? updateGoal handles it, but emergency fund is raw state.\r\n                        // We manually trigger the storage effect by setting state.\r\n\r\n                        notificationsToSend.push({\r\n                            id: `leak_emergency_${new Date().toISOString().split('T')[0]}`, // ID based on day\r\n                            type: 'alert',\r\n                            priority: 'medium',\r\n                            category: 'transactions',\r\n                            title: 'Emergency Fund Alert',\r\n                            message: `Warning: ₹${amountToTake} withdrawn from Emergency Fund to cover spending.`,\r\n                            timestamp: new Date(),\r\n                            read: false\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // Execute Drains\r\n                await Promise.all(updatesToPerform);\r\n\r\n                // Send Notifications (Unique only)\r\n                if (notificationsToSend.length > 0) {\r\n                    addNotifications(notificationsToSend);\r\n                    notificationsToSend.forEach(n => toast.error(n.title, { description: n.message }));\r\n                }\r\n            }\r\n\r\n            // 4. Credit Card Interaction Logic\r\n            const targetAccount = accounts.find(a => a.id === data.accountId);\r\n            const processedData = { ...data };\r\n\r\n            if (targetAccount?.type === 'credit_card') {\r\n                // Calculate Service Charges\r\n                const serviceChargeRate = targetAccount.serviceChargePercentage || 0;\r\n                if (serviceChargeRate > 0) {\r\n                    const charge = (data.amount * serviceChargeRate) / 100;\r\n                    processedData.serviceChargeAmount = charge;\r\n                    // Note: We don't automatically add charge to amount here, \r\n                    // we just track it. The user might want it separate.\r\n                    console.log(`Credit Service Charge: ${charge}`);\r\n                }\r\n\r\n                // Safe Limit Monitoring\r\n                const creditLimit = targetAccount.creditLimit || 0;\r\n                const safePercentage = targetAccount.safeLimitPercentage || 30; // Default to 30% if not set\r\n                const safeLimit = (creditLimit * safePercentage) / 100;\r\n\r\n                // Assuming account.balance for CC represents current usage (spent amount)\r\n                const currentUsage = Math.abs(targetAccount.balance);\r\n                const projectedUsage = currentUsage + data.amount;\r\n\r\n                if (projectedUsage > safeLimit && creditLimit > 0) {\r\n                    if (!data.isIncomeGenerating) {\r\n                        toast.warning(\"High Interest Risk Detected\", {\r\n                            description: `This transaction puts your CC usage at ${((projectedUsage / creditLimit) * 100).toFixed(1)}%, exceeding your ${safePercentage}% safe limit with no income-justification.`,\r\n                            duration: 6000\r\n                        });\r\n\r\n                        // Create a system notification for the breach\r\n                        const breachNotif: Notification = {\r\n                            id: `cc_limit_${targetAccount.id}_${new Date().toISOString().split('T')[0]}`, // Daily breach limit\r\n                            type: 'alert',\r\n                            priority: 'medium',\r\n                            category: 'transactions',\r\n                            title: 'Credit Stability Breach',\r\n                            message: `Card '${targetAccount.name}' usage protocol exceeded ${safePercentage}% threshold. Avoid non-essential outflow.`,\r\n                            timestamp: new Date(),\r\n                            read: false\r\n                        };\r\n                        addNotifications(breachNotif);\r\n                    } else {\r\n                        toast.info(\"Strategic Credit Utilization\", {\r\n                            description: \"Limit exceeded, but marked as income-generating. Proceed with caution.\"\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 5. Subscription Auto-Detect (Future Entries Protection)\r\n            if (!processedData.category || processedData.category === 'Other') {\r\n                const suggestion = autoCategorize(processedData.description);\r\n                if (suggestion && suggestion.category === 'Subscription') {\r\n                    processedData.category = 'Subscription';\r\n                    processedData.tags = Array.from(new Set([...(processedData.tags || []), 'auto-detected']));\r\n                }\r\n            }\r\n\r\n            // NEW: Formal Liability Registration\r\n            if (data.registerAsLiability) {\r\n                try {\r\n                    const tenureMonths = data.tenureUnit === 'years' ? (data.tenure * 12) : data.tenure;\r\n                    const libRes = await api.createLiability(userId, {\r\n                        name: data.description,\r\n                        type: data.liabilityType || 'other',\r\n                        principal: data.principal || data.amount,\r\n                        outstanding: data.principal || data.amount,\r\n                        interestRate: data.interestRate || 0,\r\n                        emiAmount: data.amount,\r\n                        startDate: data.date,\r\n                        tenure: tenureMonths,\r\n                        accountId: data.accountId\r\n                    });\r\n\r\n                    if (libRes.success) {\r\n                        processedData.liabilityId = libRes.liability.id;\r\n                        setLiabilities(prev => [...prev, libRes.liability]);\r\n                        toast.success(\"New loan registered in Bills tab\");\r\n\r\n                        // Note: createLiability normally creates a recurring transaction automatically.\r\n                        // To avoid duplicates, we'll mark this request as already having handled recurring.\r\n                        data.isRecurring = false;\r\n                    }\r\n                } catch (libErr) {\r\n                    console.error(\"Failed to auto-register liability:\", libErr);\r\n                }\r\n            }\r\n\r\n            // 6. Proceed with Expense Creation (Normal Flow)\r\n            const response = await api.createExpense(userId, processedData);\r\n            if (response.success) {\r\n                setExpenses(prev => [...prev, response.expense]);\r\n\r\n                // Update account balance\r\n                if (targetAccount) {\r\n                    const balanceChange = data.amount + (processedData.serviceChargeAmount || 0);\r\n                    // For Credit Cards: balance represents usage (debt), so we add the expense amount.\r\n                    // For Bank/Cash: balance represents current funds, so we subtract the expense amount.\r\n                    const newBalance = targetAccount.type === 'credit_card'\r\n                        ? targetAccount.balance + balanceChange\r\n                        : targetAccount.balance - balanceChange;\r\n\r\n                    await updateAccount(targetAccount.id, {\r\n                        balance: newBalance\r\n                    });\r\n                }\r\n\r\n                // Update Liability Outstanding (Synchronization logic)\r\n                if (processedData.liabilityId) {\r\n                    const targetLiability = liabilities.find(l => l.id === processedData.liabilityId);\r\n                    if (targetLiability) {\r\n                        const newOutstanding = Math.max(0, targetLiability.outstanding - data.amount);\r\n                        await updateLiability(targetLiability.id, {\r\n                            outstanding: newOutstanding\r\n                        });\r\n                        toast.info(`Updated '${targetLiability.name}' balance`, {\r\n                            description: `New outstanding: ₹${newOutstanding.toLocaleString()}`\r\n                        });\r\n                    }\r\n                }\r\n\r\n                if (data.isRecurring) {\r\n                    const recurringData = {\r\n                        type: 'expense',\r\n                        description: data.description,\r\n                        amount: data.amount,\r\n                        category: data.category,\r\n                        accountId: data.accountId,\r\n                        frequency: data.frequency || 'monthly',\r\n                        customIntervalDays: data.customIntervalDays,\r\n                        startDate: data.date, // Use the SAME date to trigger backfill analysis for historical gap\r\n                        endDate: data.endDate,\r\n                        tags: data.tags\r\n                    };\r\n                    await createRecurringTransaction(recurringData);\r\n                } else {\r\n                    toast.success(\"Expense added!\");\r\n\r\n                    // Verify to Automate Logic: If it's a known subscription but NOT marked recurring, ask user.\r\n                    if (isKnownSubscription(data.description) && !data.isRecurring) {\r\n                        const verifyNotif: Notification = {\r\n                            id: `verify_sub_${response.expense.id}`,\r\n                            type: 'insight',\r\n                            priority: 'medium',\r\n                            category: 'transactions',\r\n                            title: 'Automate Payment?',\r\n                            message: `Detected '${data.description}' as a subscription. Add to cyclical routine?`,\r\n                            timestamp: new Date(),\r\n                            read: false,\r\n                            action: {\r\n                                type: 'verify_subscription',\r\n                                label: 'Automate',\r\n                                status: 'pending',\r\n                                payload: {\r\n                                    id: response.expense.id,\r\n                                    description: data.description,\r\n                                    amount: data.amount,\r\n                                    category: data.category,\r\n                                    accountId: data.accountId,\r\n                                    date: data.date\r\n                                }\r\n                            }\r\n                        };\r\n                        addNotifications(verifyNotif);\r\n                    }\r\n                }\r\n            }\r\n        } catch {\r\n            console.error(\"Create expense failed\");\r\n            // Offline fallback\r\n            const tempExpense = {\r\n                id: `temp_${Date.now()}`,\r\n                ...data,\r\n                createdAt: new Date().toISOString()\r\n            };\r\n            setExpenses(prev => [...prev, tempExpense]);\r\n            toast.warning(\"Added in offline mode\");\r\n        }\r\n    };\r\n\r\n    const updateExpense = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateExpense(userId, id, data);\r\n            if (response.success) {\r\n                const oldExpense = expenses.find(e => e.id === id);\r\n                if (oldExpense) {\r\n                    // 1. Reverse old expense effect\r\n                    const oldAccount = accounts.find(a => a.id === oldExpense.accountId);\r\n                    if (oldAccount) {\r\n                        const amount = oldExpense.amount + (oldExpense.serviceChargeAmount || 0);\r\n                        const oldBalance = oldAccount.type === 'credit_card'\r\n                            ? oldAccount.balance - amount\r\n                            : oldAccount.balance + amount;\r\n                        await updateAccount(oldAccount.id, { balance: oldBalance });\r\n                    }\r\n\r\n                    // 2. Apply new expense effect (using latest state of accounts after reversal)\r\n                    // Note: We need to find the account again or use the updated response accountId\r\n                    const newExpense = response.expense;\r\n                    const newAccount = accounts.find(a => a.id === newExpense.accountId);\r\n                    if (newAccount) {\r\n                        const amount = newExpense.amount + (newExpense.serviceChargeAmount || 0);\r\n                        const newBalance = newAccount.type === 'credit_card'\r\n                            ? newAccount.balance + amount\r\n                            : newAccount.balance - amount;\r\n                        await updateAccount(newAccount.id, { balance: newBalance });\r\n                    }\r\n                    if (data.isRecurring) {\r\n                        if (oldExpense.recurringId) {\r\n                            await updateRecurringTransaction(oldExpense.recurringId, {\r\n                                amount: data.amount,\r\n                                description: data.description,\r\n                                category: data.category,\r\n                                tags: data.tags,\r\n                                frequency: data.frequency,\r\n                                customIntervalDays: data.customIntervalDays,\r\n                                endDate: data.endDate\r\n                            });\r\n                        } else {\r\n                            await createRecurringTransaction({\r\n                                type: 'expense',\r\n                                description: data.description,\r\n                                amount: data.amount,\r\n                                category: data.category,\r\n                                accountId: data.accountId,\r\n                                frequency: data.frequency || 'monthly',\r\n                                customIntervalDays: data.customIntervalDays,\r\n                                startDate: oldExpense.date, // Use original transaction date for historical analysis\r\n                                endDate: data.endDate,\r\n                                tags: data.tags\r\n                            });\r\n                        }\r\n                    } else if (oldExpense.recurringId) {\r\n                        await deleteRecurringTransaction(oldExpense.recurringId);\r\n                    }\r\n                }\r\n\r\n                setExpenses(prev => prev.map(e => e.id === id ? response.expense : e));\r\n                toast.success(\"Expense updated\");\r\n            }\r\n        } catch {\r\n            // Offline update\r\n            setExpenses(prev => prev.map(e => e.id === id ? { ...e, ...data } : e));\r\n            toast.warning(\"Updated in offline mode\");\r\n        }\r\n    };\r\n\r\n    const deleteExpense = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteExpense(userId, id);\r\n            if (response.success) {\r\n                const expense = expenses.find(e => e.id === id);\r\n                if (expense) {\r\n                    const targetAccount = accounts.find(a => a.id === expense.accountId);\r\n                    if (targetAccount) {\r\n                        const amount = expense.amount + (expense.serviceChargeAmount || 0);\r\n                        const newBalance = targetAccount.type === 'credit_card'\r\n                            ? targetAccount.balance - amount // Restore credit card limit (reduce usage)\r\n                            : targetAccount.balance + amount; // Restore bank balance\r\n\r\n                        await updateAccount(targetAccount.id, { balance: newBalance });\r\n                    }\r\n                }\r\n                setExpenses(prev => prev.filter(e => e.id !== id));\r\n                toast.success(\"Expense deleted\");\r\n            }\r\n        } catch {\r\n            setExpenses(prev => prev.filter(e => e.id !== id));\r\n            toast.warning(\"Deleted in offline mode\");\r\n        }\r\n    };\r\n\r\n    // --- Incomes ---\r\n    const createIncome = async (data: any) => {\r\n        try {\r\n            const response = await api.createIncome(userId, data);\r\n            if (response.success) {\r\n                setIncomes(prev => [...prev, response.income]);\r\n\r\n                // Update account balance\r\n                const targetAccount = accounts.find(a => a.id === data.accountId);\r\n                if (targetAccount) {\r\n                    // For Credit Cards: Income reduces usage (debt).\r\n                    // For Bank/Cash: Income increases funds.\r\n                    const newBalance = targetAccount.type === 'credit_card'\r\n                        ? targetAccount.balance - data.amount\r\n                        : targetAccount.balance + data.amount;\r\n\r\n                    await updateAccount(targetAccount.id, {\r\n                        balance: newBalance\r\n                    });\r\n                }\r\n\r\n                if (data.isRecurring) {\r\n                    const recurringData = {\r\n                        type: 'income',\r\n                        source: data.source,\r\n                        amount: data.amount,\r\n                        accountId: data.accountId,\r\n                        frequency: data.frequency || 'monthly',\r\n                        customIntervalDays: data.customIntervalDays,\r\n                        startDate: data.date, // Use the SAME date to trigger backfill analysis for historical gap\r\n                        endDate: data.endDate,\r\n                        tags: data.tags\r\n                    };\r\n                    await createRecurringTransaction(recurringData);\r\n                } else {\r\n                    toast.success(\"Income added!\");\r\n                }\r\n            }\r\n        } catch {\r\n            const tempIncome = {\r\n                id: `temp_${Date.now()}`,\r\n                ...data,\r\n                createdAt: new Date().toISOString()\r\n            };\r\n            setIncomes(prev => [...prev, tempIncome]);\r\n            toast.warning(\"Added in offline mode\");\r\n        }\r\n    };\r\n\r\n    const updateIncome = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateIncome(userId, id, data);\r\n            if (response.success) {\r\n                const oldIncome = incomes.find(i => i.id === id);\r\n                if (oldIncome) {\r\n                    // 1. Reverse old income effect\r\n                    const oldAccount = accounts.find(a => a.id === oldIncome.accountId);\r\n                    if (oldAccount) {\r\n                        const oldBalance = oldAccount.type === 'credit_card'\r\n                            ? oldAccount.balance + oldIncome.amount\r\n                            : oldAccount.balance - oldIncome.amount;\r\n                        await updateAccount(oldAccount.id, { balance: oldBalance });\r\n                    }\r\n\r\n                    // 2. Apply new income effect\r\n                    const newIncome = response.income;\r\n                    const newAccount = accounts.find(a => a.id === newIncome.accountId);\r\n                    if (newAccount) {\r\n                        const newBalance = newAccount.type === 'credit_card'\r\n                            ? newAccount.balance - newIncome.amount\r\n                            : newAccount.balance + newIncome.amount;\r\n                        await updateAccount(newAccount.id, { balance: newBalance });\r\n                    }\r\n\r\n                    if (data.isRecurring) {\r\n                        if (oldIncome.recurringId) {\r\n                            await updateRecurringTransaction(oldIncome.recurringId, {\r\n                                amount: data.amount,\r\n                                source: data.source,\r\n                                description: data.source,\r\n                                category: data.category,\r\n                                tags: data.tags,\r\n                                frequency: data.frequency,\r\n                                customIntervalDays: data.customIntervalDays,\r\n                                endDate: data.endDate\r\n                            });\r\n                        } else {\r\n                            await createRecurringTransaction({\r\n                                type: 'income',\r\n                                description: data.source,\r\n                                source: data.source,\r\n                                amount: data.amount,\r\n                                category: data.category,\r\n                                accountId: data.accountId,\r\n                                frequency: data.frequency || 'monthly',\r\n                                customIntervalDays: data.customIntervalDays,\r\n                                startDate: oldIncome.date,\r\n                                endDate: data.endDate,\r\n                                tags: data.tags\r\n                            });\r\n                        }\r\n                    } else if (oldIncome.recurringId) {\r\n                        // If it was recurring but now it's not, delete the recurring transaction\r\n                        await deleteRecurringTransaction(oldIncome.recurringId);\r\n                    }\r\n                }\r\n                setIncomes(prev => prev.map(i => i.id === id ? response.income : i));\r\n                toast.success(\"Income updated\");\r\n            }\r\n        } catch {\r\n            setIncomes(prev => prev.map(i => i.id === id ? { ...i, ...data } : i));\r\n            toast.warning(\"Updated in offline mode\");\r\n        }\r\n    };\r\n\r\n    const deleteIncome = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteIncome(userId, id);\r\n            if (response.success) {\r\n                const income = incomes.find(i => i.id === id);\r\n                if (income) {\r\n                    const targetAccount = accounts.find(a => a.id === income.accountId);\r\n                    if (targetAccount) {\r\n                        const newBalance = targetAccount.type === 'credit_card'\r\n                            ? targetAccount.balance + income.amount // Reverse income effect on CC (increase usage)\r\n                            : targetAccount.balance - income.amount; // Reverse income effect on bank\r\n\r\n                        await updateAccount(targetAccount.id, { balance: newBalance });\r\n                    }\r\n                }\r\n                setIncomes(prev => prev.filter(i => i.id !== id));\r\n                toast.success(\"Income deleted\");\r\n            }\r\n        } catch {\r\n            setIncomes(prev => prev.filter(i => i.id !== id));\r\n            toast.warning(\"Deleted in offline mode\");\r\n        }\r\n    };\r\n\r\n    // --- Debts ---\r\n    const createDebt = async (data: any) => {\r\n        try {\r\n            const response = await api.createDebt(userId, data);\r\n            if (response.success) {\r\n                setDebts(prev => [...prev, response.debt]);\r\n\r\n                // Update account balance\r\n                const targetAccount = accounts.find(a => a.id === data.accountId);\r\n                if (targetAccount) {\r\n                    // Type: 'borrowed' -> Cash increases, 'lent' -> Cash decreases\r\n                    const balanceChange = data.type === 'borrowed' ? data.amount : -data.amount;\r\n\r\n                    // CC Consideration: Borrowing to CC is weird but theoretically possible (cash advance).\r\n                    // Lending from CC is also possible.\r\n                    const newBalance = targetAccount.type === 'credit_card'\r\n                        ? targetAccount.balance - balanceChange // Usage decreases if borrowed (added to card), usage increases if lent\r\n                        : targetAccount.balance + balanceChange;\r\n\r\n                    await updateAccount(targetAccount.id, {\r\n                        balance: newBalance\r\n                    });\r\n                }\r\n\r\n                if (data.isRecurring) {\r\n                    await createRecurringTransaction({\r\n                        type: 'expense', // Debts are currently tracked as simple ledger entries, using 'expense' type for recurring\r\n                        description: `Debt: ${data.personName} (${data.type})`,\r\n                        amount: data.amount,\r\n                        category: 'Debt',\r\n                        accountId: data.accountId,\r\n                        frequency: data.frequency || 'monthly',\r\n                        startDate: data.date,\r\n                        tags: [...(data.tags || []), 'debt']\r\n                    });\r\n                }\r\n\r\n                toast.success(\"Debt created\");\r\n            }\r\n        } catch {\r\n            const tempDebt = {\r\n                id: `temp_${Date.now()}`,\r\n                ...data,\r\n                status: 'pending',\r\n                createdAt: new Date().toISOString()\r\n            };\r\n            setDebts(prev => [...prev, tempDebt]);\r\n            toast.warning(\"Added in offline mode\");\r\n        }\r\n    };\r\n\r\n    const updateDebt = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateDebt(userId, id, data);\r\n            if (response.success) {\r\n                const oldDebt = debts.find(d => d.id === id);\r\n                if (oldDebt) {\r\n                    // 1. Reverse old debt effect\r\n                    const oldAccount = accounts.find(a => a.id === oldDebt.accountId);\r\n                    if (oldAccount) {\r\n                        const balanceChange = oldDebt.type === 'borrowed' ? -oldDebt.amount : oldDebt.amount;\r\n                        const oldBalance = oldAccount.type === 'credit_card'\r\n                            ? oldAccount.balance - balanceChange\r\n                            : oldAccount.balance + balanceChange;\r\n                        await updateAccount(oldAccount.id, { balance: oldBalance });\r\n                    }\r\n\r\n                    // 2. Apply new debt effect\r\n                    const newDebt = response.debt;\r\n                    const newAccount = accounts.find(a => a.id === newDebt.accountId);\r\n                    if (newAccount) {\r\n                        const balanceChange = newDebt.type === 'borrowed' ? newDebt.amount : -newDebt.amount;\r\n                        const newBalance = newAccount.type === 'credit_card'\r\n                            ? newAccount.balance - balanceChange\r\n                            : newAccount.balance + balanceChange;\r\n                        await updateAccount(newAccount.id, { balance: newBalance });\r\n                    }\r\n                    if (data.isRecurring) {\r\n                        // Logic to handle update or creation of recurring from updateDebt\r\n                        // For now, if it was already recurring, updateRecurringTransaction should be called.\r\n                        // If toggled ON, create new.\r\n                        if (oldDebt.recurringId) {\r\n                            await updateRecurringTransaction(oldDebt.recurringId, {\r\n                                amount: data.amount,\r\n                                description: `Debt: ${data.personName} (${data.type})`\r\n                            });\r\n                        } else {\r\n                            await createRecurringTransaction({\r\n                                type: 'expense',\r\n                                description: `Debt: ${data.personName} (${data.type})`,\r\n                                amount: data.amount,\r\n                                category: 'Debt',\r\n                                accountId: data.accountId,\r\n                                frequency: data.frequency || 'monthly',\r\n                                startDate: data.date,\r\n                                tags: [...(data.tags || []), 'debt']\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n\r\n                setDebts(prev => prev.map(d => d.id === id ? response.debt : d));\r\n                toast.success(\"Debt updated\");\r\n            }\r\n        } catch {\r\n            setDebts(prev => prev.map(d => d.id === id ? { ...d, ...data } : d));\r\n            toast.warning(\"Updated in offline mode\");\r\n        }\r\n    };\r\n\r\n    const deleteDebt = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteDebt(userId, id);\r\n            if (response.success) {\r\n                const debt = debts.find(d => d.id === id);\r\n                if (debt) {\r\n                    const targetAccount = accounts.find(a => a.id === debt.accountId);\r\n                    if (targetAccount) {\r\n                        // Reverse the initial balance change\r\n                        const balanceChange = debt.type === 'borrowed' ? -debt.amount : debt.amount;\r\n                        const newBalance = targetAccount.type === 'credit_card'\r\n                            ? targetAccount.balance - balanceChange\r\n                            : targetAccount.balance + balanceChange;\r\n\r\n                        await updateAccount(targetAccount.id, { balance: newBalance });\r\n                    }\r\n                }\r\n                setDebts(prev => prev.filter(d => d.id !== id));\r\n                toast.success(\"Debt deleted\");\r\n            }\r\n        } catch {\r\n            setDebts(prev => prev.filter(d => d.id !== id));\r\n            toast.warning(\"Deleted in offline mode\");\r\n        }\r\n    };\r\n\r\n    const settleDebt = async (id: string) => {\r\n        try {\r\n            const response = await api.updateDebt(userId, id, { status: \"settled\" });\r\n            if (response.success) {\r\n                const debt = debts.find(d => d.id === id);\r\n                if (debt && debt.status !== 'settled') {\r\n                    const targetAccount = accounts.find(a => a.id === debt.accountId);\r\n                    if (targetAccount) {\r\n                        // Settlement reverses the initial debt flow\r\n                        // borrowed -> payback (outflow), lent -> received back (inflow)\r\n                        const settlementAmount = debt.type === 'borrowed' ? -debt.amount : debt.amount;\r\n\r\n                        const newBalance = targetAccount.type === 'credit_card'\r\n                            ? targetAccount.balance - settlementAmount\r\n                            : targetAccount.balance + settlementAmount;\r\n\r\n                        await updateAccount(targetAccount.id, { balance: newBalance });\r\n\r\n                        // Record the settlement as a Transfer to avoid double-counting as spending/income\r\n                        const settlementTransaction = {\r\n                            description: `Debt Settlement: ${debt.personName}`,\r\n                            amount: debt.amount,\r\n                            category: 'Transfer',\r\n                            date: new Date().toISOString().split('T')[0],\r\n                            tags: ['debt-settlement'],\r\n                            accountId: debt.accountId\r\n                        };\r\n\r\n                        if (debt.type === 'borrowed') {\r\n                            const res = await api.createExpense(userId, settlementTransaction);\r\n                            if (res.success) setExpenses(prev => [...prev, res.expense]);\r\n                        } else {\r\n                            const res = await api.createIncome(userId, settlementTransaction);\r\n                            if (res.success) setIncomes(prev => [...prev, res.income]);\r\n                        }\r\n                    }\r\n                }\r\n                setDebts(prev => prev.map(d => d.id === id ? response.debt : d));\r\n                toast.success(\"🎉 Debt settled! Great job!\");\r\n                confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });\r\n            }\r\n        } catch {\r\n            setDebts(prev => prev.map(d => d.id === id ? { ...d, status: \"settled\" as const } : d));\r\n            toast.warning(\"Marked as settled locally\");\r\n        }\r\n    };\r\n\r\n    // --- Migration ---\r\n    const migrateSubscriptions = async (): Promise<{ count: number }> => {\r\n        let updateCount = 0;\r\n        const updates: Promise<any>[] = [];\r\n\r\n        // 1. Scan Expenses\r\n        for (const expense of expenses) {\r\n            // Only update if not already a Subscription and matches DB\r\n            if (expense.category !== 'Subscription' && isKnownSubscription(expense.description)) {\r\n\r\n                // Get precise details if available\r\n                const details = autoCategorize(expense.description);\r\n\r\n                if (details && details.category === 'Subscription') {\r\n                    updates.push(updateExpense(expense.id, {\r\n                        category: 'Subscription',\r\n                        tags: [...new Set([...expense.tags, 'auto-migrated', 'subscription'])]\r\n                    }));\r\n                    updateCount++;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (updates.length > 0) {\r\n            await Promise.all(updates);\r\n            toast.success(`Migrated ${updateCount} transactions to Subscriptions`);\r\n        } else {\r\n            toast.info(\"No subscription transactions found to migrate\");\r\n        }\r\n\r\n        return { count: updateCount };\r\n    };\r\n\r\n    const cleanupDuplicates = async (): Promise<{ count: number }> => {\r\n        let removedCount = 0;\r\n        const updates: Promise<any>[] = [];\r\n        const seen = new Set<string>();\r\n\r\n        // 1. Exact Duplicate & Blank Scan\r\n        const expensesToDelete = new Set<string>();\r\n\r\n        // Exact Match Logic\r\n        expenses.forEach(expense => {\r\n            const key = `${expense.date}-${expense.description?.toLowerCase().trim()}-${expense.amount}`;\r\n            const isBlank = !expense.description || expense.description.trim() === '' || expense.amount === 0;\r\n            const isDuplicate = seen.has(key);\r\n\r\n            if (isBlank || isDuplicate) {\r\n                expensesToDelete.add(expense.id);\r\n            } else {\r\n                seen.add(key);\r\n            }\r\n        });\r\n\r\n        // 2. Subscription Density Scan (Smart Dedupe)\r\n        // Group by Subscription Name + Month\r\n        const subGroups = new Map<string, Expense[]>();\r\n\r\n        expenses.forEach(e => {\r\n            // Only check active candidates not already marked for deletion\r\n            if (expensesToDelete.has(e.id)) return;\r\n\r\n            const isSub = e.category === 'Subscription' || e.isRecurring || isKnownSubscription(e.description);\r\n            if (isSub) {\r\n                const date = new Date(e.date);\r\n                const key = `${e.description.toLowerCase().trim()}-${date.getFullYear()}-${date.getMonth()}`;\r\n\r\n                if (!subGroups.has(key)) subGroups.set(key, []);\r\n                subGroups.get(key)!.push(e);\r\n            }\r\n        });\r\n\r\n        // Enforce 1 per month policy\r\n        subGroups.forEach((group) => {\r\n            if (group.length > 1) {\r\n                // Sort: Prefer entries that are explicitly marked recurring, then by latest date/creation\r\n                group.sort((a, b) => {\r\n                    if (a.isRecurring !== b.isRecurring) return a.isRecurring ? -1 : 1; // Keep recurring\r\n                    return new Date(b.date).getTime() - new Date(a.date).getTime(); // Keep latest\r\n                });\r\n\r\n                // Keep the first one (Index 0), delete the rest\r\n                for (let i = 1; i < group.length; i++) {\r\n                    expensesToDelete.add(group[i].id);\r\n                }\r\n            }\r\n        });\r\n\r\n        // Execute Expense Deletions\r\n        expensesToDelete.forEach(id => {\r\n            updates.push(deleteExpense(id));\r\n            removedCount++;\r\n        });\r\n\r\n        // 3. Scan Incomes (Exact Only)\r\n        const seenIncomes = new Set<string>();\r\n        for (const income of incomes) {\r\n            const key = `${income.date}-${income.source?.toLowerCase().trim()}-${income.amount}`;\r\n            const isBlank = !income.source || income.source.trim() === '' || income.amount === 0;\r\n            const isDuplicate = seenIncomes.has(key);\r\n\r\n            if (isBlank || isDuplicate) {\r\n                updates.push(deleteIncome(income.id));\r\n                removedCount++;\r\n            } else {\r\n                seenIncomes.add(key);\r\n            }\r\n        }\r\n\r\n        if (updates.length > 0) {\r\n            await Promise.all(updates);\r\n            toast.success(`Cleaned up ${removedCount} entries (Duplicates & Density Checks)`);\r\n        } else {\r\n            toast.info(\"Logs are clean. No redundancies found.\");\r\n        }\r\n\r\n        return { count: removedCount };\r\n    };\r\n\r\n    // --- Goals ---\r\n    const createGoal = async (data: any) => {\r\n        try {\r\n            const response = await api.createGoal(userId, data);\r\n            if (response.success) {\r\n                setGoals(prev => [...prev, response.goal]);\r\n\r\n                if (data.monthly_contribution > 0) {\r\n                    await createRecurringTransaction({\r\n                        type: 'expense',\r\n                        description: `Goal Contribution: ${response.goal.name}`,\r\n                        amount: data.monthly_contribution,\r\n                        category: 'Transfer',\r\n                        accountId: data.accountId || 'none',\r\n                        frequency: 'monthly',\r\n                        startDate: data.startDate || response.goal.createdAt.split('T')[0],\r\n                        tags: ['goal', 'contribution', response.goal.name.toLowerCase()],\r\n                        goalId: response.goal.id\r\n                    });\r\n                }\r\n\r\n                toast.success(\"Goal created\");\r\n            }\r\n        } catch {\r\n            const temp = { id: `temp_${Date.now()}`, ...data, createdAt: new Date().toISOString() };\r\n            setGoals(prev => [...prev, temp]);\r\n            toast.warning(\"Created in offline mode\");\r\n        }\r\n    };\r\n\r\n    const updateGoal = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateGoal(userId, id, data);\r\n            if (response.success) {\r\n                const oldGoal = goals.find(g => g.id === id);\r\n                if (oldGoal) {\r\n                    if ((response.goal.monthly_contribution || 0) > 0) {\r\n                        const existingRec = recurringTransactions.find(rt => rt.goalId === id);\r\n                        if (existingRec) {\r\n                            await updateRecurringTransaction(existingRec.id, {\r\n                                amount: response.goal.monthly_contribution || 0,\r\n                                description: `Goal Contribution: ${response.goal.name}`\r\n                            });\r\n                        } else {\r\n                            await createRecurringTransaction({\r\n                                type: 'expense',\r\n                                description: `Goal Contribution: ${response.goal.name}`,\r\n                                amount: response.goal.monthly_contribution || 0,\r\n                                category: 'Transfer',\r\n                                accountId: response.goal.accountId || 'none',\r\n                                frequency: 'monthly',\r\n                                startDate: response.goal.startDate || oldGoal.createdAt?.split('T')[0] || new Date().toISOString().split('T')[0],\r\n                                tags: ['goal', 'contribution', response.goal.name.toLowerCase()],\r\n                                goalId: response.goal.id\r\n                            });\r\n                        }\r\n                    } else if (oldGoal.monthly_contribution && oldGoal.monthly_contribution > 0) {\r\n                        const existingRec = recurringTransactions.find(rt => rt.goalId === id);\r\n                        if (existingRec) await deleteRecurringTransaction(existingRec.id);\r\n                    }\r\n                }\r\n\r\n                setGoals(prev => prev.map(g => g.id === id ? response.goal : g));\r\n                if (response.goal.currentAmount >= response.goal.targetAmount) {\r\n                    toast.success(`🎉 Goal \"${response.goal.name}\" completed!`);\r\n                    confetti({ particleCount: 200, spread: 120, origin: { y: 0.5 } });\r\n                } else {\r\n                    toast.success(\"Goal updated\");\r\n                }\r\n            }\r\n        } catch {\r\n            setGoals(prev => prev.map(g => g.id === id ? { ...g, ...data } : g));\r\n            toast.warning(\"Updated locally\");\r\n        }\r\n    };\r\n\r\n    const deleteGoal = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteGoal(userId, id);\r\n            if (response.success) {\r\n                setGoals(prev => prev.filter(g => g.id !== id));\r\n                toast.success(\"Goal deleted\");\r\n            }\r\n        } catch {\r\n            setGoals(prev => prev.filter(g => g.id !== id));\r\n            toast.warning(\"Deleted locally\");\r\n        }\r\n    };\r\n\r\n    // --- Accounts ---\r\n    const createAccount = async (data: any) => {\r\n        try {\r\n            const response = await api.createAccount(userId, data);\r\n            if (response.success) {\r\n                setAccounts(prev => [...prev, response.account]);\r\n                toast.success(\"Account created\");\r\n            }\r\n        } catch {\r\n            const temp = { id: `temp_${Date.now()}`, ...data, createdAt: new Date().toISOString() };\r\n            setAccounts(prev => [...prev, temp]);\r\n            toast.warning(\"Created locally\");\r\n        }\r\n    };\r\n\r\n    const updateAccount = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateAccount(userId, id, data);\r\n            if (response.success) {\r\n                setAccounts(prev => prev.map(a => a.id === id ? response.account : a));\r\n                toast.success(\"Account updated\");\r\n            }\r\n        } catch {\r\n            setAccounts(prev => prev.map(a => a.id === id ? { ...a, ...data } : a));\r\n            toast.warning(\"Updated locally\");\r\n        }\r\n    };\r\n\r\n    const deleteAccount = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteAccount(userId, id);\r\n            if (response.success) {\r\n                setAccounts(prev => prev.filter(a => a.id !== id));\r\n                toast.success(\"Account deleted\");\r\n            }\r\n        } catch {\r\n            setAccounts(prev => prev.filter(a => a.id !== id));\r\n            toast.warning(\"Deleted locally\");\r\n        }\r\n    };\r\n\r\n    // --- Liabilities ---\r\n    const createLiability = async (data: Omit<Liability, 'id'>) => {\r\n        try {\r\n            const response = await api.createLiability(userId, data);\r\n            if (response.success) {\r\n                setLiabilities(prev => [...prev, response.liability]);\r\n                toast.success(\"Liability created\");\r\n\r\n                if (response.liability.emiAmount > 0) {\r\n                    await createRecurringTransaction({\r\n                        type: 'expense',\r\n                        description: `EMI: ${response.liability.name}`,\r\n                        amount: response.liability.emiAmount,\r\n                        category: 'EMI',\r\n                        accountId: response.liability.accountId || 'none',\r\n                        frequency: 'monthly',\r\n                        startDate: response.liability.startDate,\r\n                        tags: ['emi', 'liability', response.liability.name.toLowerCase()],\r\n                        liabilityId: response.liability.id\r\n                    });\r\n                }\r\n            }\r\n        } catch {\r\n            const temp = {\r\n                id: `temp_${Date.now()}`,\r\n                ...data,\r\n                principal: Number(data.principal),\r\n                outstanding: Number(data.outstanding),\r\n                interestRate: Number(data.interestRate),\r\n                emiAmount: Number(data.emiAmount),\r\n                tenure: Number(data.tenure),\r\n                createdAt: new Date().toISOString()\r\n            } as Liability;\r\n            setLiabilities(prev => [...prev, temp]);\r\n            toast.warning(\"Created locally\");\r\n        }\r\n    };\r\n\r\n    const updateLiability = async (id: string, data: Partial<Liability>) => {\r\n        try {\r\n            const response = await api.updateLiability(userId, id, data);\r\n            if (response.success) {\r\n                const oldLiability = liabilities.find(l => l.id === id);\r\n                if (oldLiability) {\r\n                    if (response.liability.emiAmount > 0) {\r\n                        const existingRec = recurringTransactions.find(rt => rt.liabilityId === id);\r\n                        if (existingRec) {\r\n                            await updateRecurringTransaction(existingRec.id, {\r\n                                amount: response.liability.emiAmount,\r\n                                description: `EMI: ${response.liability.name}`\r\n                            });\r\n                        } else {\r\n                            await createRecurringTransaction({\r\n                                type: 'expense',\r\n                                description: `EMI: ${response.liability.name}`,\r\n                                amount: response.liability.emiAmount,\r\n                                category: 'EMI',\r\n                                accountId: response.liability.accountId || 'none',\r\n                                frequency: 'monthly',\r\n                                startDate: response.liability.startDate,\r\n                                tags: ['emi', 'liability', response.liability.name.toLowerCase()],\r\n                                liabilityId: response.liability.id\r\n                            });\r\n                        }\r\n                    } else if (oldLiability.emiAmount > 0) {\r\n                        const existingRec = recurringTransactions.find(rt => rt.liabilityId === id);\r\n                        if (existingRec) await deleteRecurringTransaction(existingRec.id);\r\n                    }\r\n                }\r\n                setLiabilities(prev => prev.map(l => l.id === id ? response.liability : l));\r\n                toast.success(\"Liability updated\");\r\n            }\r\n        } catch {\r\n            setLiabilities(prev => prev.map(l => l.id === id ? { ...l, ...data } as Liability : l));\r\n            toast.warning(\"Updated locally\");\r\n        }\r\n    };\r\n\r\n    const deleteLiability = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteLiability(userId, id);\r\n            if (response.success) {\r\n                setLiabilities(prev => prev.filter(l => l.id !== id));\r\n                toast.success(\"Liability deleted\");\r\n            }\r\n        } catch {\r\n            setLiabilities(prev => prev.filter(l => l.id !== id));\r\n            toast.warning(\"Deleted locally\");\r\n        }\r\n    };\r\n\r\n    // --- Investments ---\r\n    const createInvestment = async (data: any, sourceAccountId?: string) => {\r\n        try {\r\n            const response = await api.createInvestment(userId, data);\r\n            if (response.success) {\r\n                setInvestments(prev => [...prev, response.investment]);\r\n\r\n                // Aggregation Rule: Cash-to-Asset Logic\r\n                if (sourceAccountId && sourceAccountId !== 'none') {\r\n                    const sourceAccount = accounts.find(a => a.id === sourceAccountId);\r\n                    if (sourceAccount) {\r\n                        const cost = data.buyPrice * data.quantity;\r\n                        // Deduct from source\r\n                        await updateAccount(sourceAccountId, {\r\n                            balance: sourceAccount.balance - cost\r\n                        });\r\n\r\n                        // Record Transfer\r\n                        const transferData = {\r\n                            description: `Asset Purchase: ${data.symbol} (${data.quantity} units)`,\r\n                            amount: cost,\r\n                            category: 'Transfer',\r\n                            date: data.purchaseDate || new Date().toISOString().split('T')[0],\r\n                            tags: ['investment', 'principal', data.symbol],\r\n                            accountId: sourceAccountId\r\n                        };\r\n                        const tResponse = await api.createExpense(userId, transferData);\r\n                        if (tResponse.success) {\r\n                            setExpenses(prev => [...prev, tResponse.expense]);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // SIP Recurring Support\r\n                if (response.investment.type === 'sip') {\r\n                    await createRecurringTransaction({\r\n                        type: 'expense',\r\n                        description: `SIP: ${response.investment.symbol} (${response.investment.name})`,\r\n                        amount: response.investment.buyPrice * response.investment.quantity,\r\n                        category: 'Investment',\r\n                        accountId: sourceAccountId || 'none',\r\n                        frequency: 'monthly',\r\n                        startDate: response.investment.purchaseDate,\r\n                        tags: ['sip', 'investment', response.investment.symbol.toLowerCase()],\r\n                        investmentId: response.investment.id\r\n                    });\r\n                }\r\n\r\n                toast.success(\"Investment created\");\r\n            }\r\n        } catch {\r\n            const temp = { id: `temp_${Date.now()}`, ...data, createdAt: new Date().toISOString() };\r\n            setInvestments(prev => [...prev, temp]);\r\n            toast.warning(\"Created locally\");\r\n        }\r\n    };\r\n\r\n    const updateInvestment = async (id: string, data: any) => {\r\n        try {\r\n            const response = await api.updateInvestment(userId, id, data);\r\n            if (response.success) {\r\n                const oldInv = investments.find(inv => inv.id === id);\r\n                if (oldInv) {\r\n                    if (response.investment.type === 'sip') {\r\n                        const existingRec = recurringTransactions.find(rt => rt.investmentId === id);\r\n                        if (existingRec) {\r\n                            await updateRecurringTransaction(existingRec.id, {\r\n                                amount: response.investment.buyPrice * response.investment.quantity,\r\n                                description: `SIP: ${response.investment.symbol} (${response.investment.name})`\r\n                            });\r\n                        } else {\r\n                            await createRecurringTransaction({\r\n                                type: 'expense',\r\n                                description: `SIP: ${response.investment.symbol} (${response.investment.name})`,\r\n                                amount: response.investment.buyPrice * response.investment.quantity,\r\n                                category: 'Investment',\r\n                                accountId: response.investment.accountId || 'none',\r\n                                frequency: 'monthly',\r\n                                startDate: response.investment.purchaseDate,\r\n                                tags: ['sip', 'investment', response.investment.symbol.toLowerCase()],\r\n                                investmentId: response.investment.id\r\n                            });\r\n                        }\r\n                    } else if (oldInv.type === 'sip') {\r\n                        const existingRec = recurringTransactions.find(rt => rt.investmentId === id);\r\n                        if (existingRec) await deleteRecurringTransaction(existingRec.id);\r\n                    }\r\n                }\r\n                setInvestments(prev => prev.map(inv => inv.id === id ? response.investment : inv));\r\n                toast.success(\"Investment updated\");\r\n            }\r\n        } catch {\r\n            setInvestments(prev => prev.map(i => i.id === id ? { ...i, ...data } : i));\r\n            toast.warning(\"Updated locally\");\r\n        }\r\n    };\r\n\r\n    const deleteInvestment = async (id: string) => {\r\n        try {\r\n            const response = await api.deleteInvestment(userId, id);\r\n            if (response.success) {\r\n                setInvestments(prev => prev.filter(i => i.id !== id));\r\n                toast.success(\"Investment deleted\");\r\n            }\r\n        } catch {\r\n            setInvestments(prev => prev.filter(i => i.id !== id));\r\n            toast.warning(\"Deleted locally\");\r\n        }\r\n    };\r\n\r\n\r\n    // --- Fund Allocation & Operations ---\r\n    const [isFundAllocationOpen, setIsFundAllocationOpen] = useState(false);\r\n    const [fundAllocationType, setFundAllocationType] = useState<'goal' | 'emergency'>('goal');\r\n\r\n    const openFundAllocation = (type: 'goal' | 'emergency') => {\r\n        setFundAllocationType(type);\r\n        setIsFundAllocationOpen(true);\r\n    };\r\n\r\n    const closeFundAllocation = () => {\r\n        setIsFundAllocationOpen(false);\r\n    };\r\n\r\n    const performFundAllocation = async (data: {\r\n        accountId: string;\r\n        destinationId: string;\r\n        amount: number;\r\n        destinationType: 'goal' | 'emergency';\r\n    }) => {\r\n        const account = accounts.find(a => a.id === data.accountId);\r\n        if (!account) {\r\n            toast.error('Account not found');\r\n            return;\r\n        }\r\n\r\n        if (account.balance < data.amount) {\r\n            toast.error(`Insufficient funds in ${account.name}`);\r\n            return;\r\n        }\r\n\r\n        // Update account balance\r\n        await updateAccount(data.accountId, {\r\n            balance: account.balance - data.amount\r\n        });\r\n\r\n        // Update goal or emergency fund\r\n        if (data.destinationType === 'goal') {\r\n            const goal = goals.find(g => g.id === data.destinationId);\r\n            if (goal) {\r\n                await updateGoal(data.destinationId, {\r\n                    currentAmount: goal.currentAmount + data.amount\r\n                });\r\n            }\r\n        } else {\r\n            setEmergencyFundAmount(prev => prev + data.amount);\r\n        }\r\n\r\n        toast.success(\r\n            `Successfully allocated ${CURRENCY_SYMBOLS[settings.currency]}${data.amount.toLocaleString()} from ${account.name}!`,\r\n            {\r\n                description: `${data.destinationType === 'goal' ? 'Goal' : 'Emergency Fund'} balance updated`\r\n            }\r\n        );\r\n        confetti({\r\n            particleCount: 100,\r\n            spread: 70,\r\n            origin: { y: 0.6 }\r\n        });\r\n    };\r\n\r\n    const deductFromAccount = async (accountId: string, amount: number) => {\r\n        const account = accounts.find(a => a.id === accountId);\r\n        if (account) {\r\n            if (account.balance < amount) {\r\n                toast.error(`Insufficient funds in ${account.name}`);\r\n                throw new Error('Insufficient funds');\r\n            }\r\n            await updateAccount(accountId, {\r\n                balance: account.balance - amount\r\n            });\r\n        }\r\n    };\r\n\r\n    const transferFunds = async (sourceId: string, destinationId: string, amount: number) => {\r\n        const sourceAccount = accounts.find(a => a.id === sourceId);\r\n        const destAccount = accounts.find(a => a.id === destinationId);\r\n\r\n        if (!sourceAccount || !destAccount) {\r\n            toast.error('Source or destination account not found');\r\n            return;\r\n        }\r\n\r\n        if (sourceAccount.balance < amount) {\r\n            toast.error(`Insufficient funds in ${sourceAccount.name}`);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Update source: subtract\r\n            await updateAccount(sourceId, { balance: sourceAccount.balance - amount });\r\n\r\n            // Update destination: add (or subtract for CC to reduce debt)\r\n            const destBalanceChange = destAccount.type === 'credit_card' ? -amount : amount;\r\n            await updateAccount(destinationId, { balance: destAccount.balance + destBalanceChange });\r\n\r\n            // Record this migration as a transaction for history (but analytics will ignore it as 'Transfer')\r\n            const transferExpense = {\r\n                description: `Migration: ${sourceAccount.name} → ${destAccount.name}`,\r\n                amount: amount,\r\n                category: 'Transfer',\r\n                date: new Date().toISOString().split('T')[0],\r\n                tags: ['internal', 'migration'],\r\n                accountId: sourceId\r\n            };\r\n\r\n            // We use direct API call or internal createExpense to avoid recursive balance updates \r\n            // since we already updated balances above.\r\n            const response = await api.createExpense(userId, transferExpense);\r\n            if (response.success) {\r\n                setExpenses(prev => [...prev, response.expense]);\r\n            }\r\n\r\n            toast.success(`Transferred ${CURRENCY_SYMBOLS[settings.currency]}${amount.toLocaleString()}!`, {\r\n                description: `From ${sourceAccount.name} to ${destAccount.name}`\r\n            });\r\n\r\n            confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });\r\n        } catch (error) {\r\n            console.error('Transfer failed', error);\r\n            toast.error('Capital migration protocol failed');\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const clearAllData = async () => {\r\n        try {\r\n            const toastId = toast.loading('Initiating factory reset...');\r\n\r\n            // Helper to run deletions in parallel and ignore errors\r\n            const deleteGroup = async (items: any[], deleteFn: (uid: string, id: string) => Promise<any>) => {\r\n                const promises = items.map(item =>\r\n                    deleteFn(userId, item.id).catch(e => console.warn(`Failed to delete ${item.id}`, e))\r\n                );\r\n                await Promise.all(promises);\r\n            };\r\n\r\n            await Promise.all([\r\n                deleteGroup(recurringTransactions, api.deleteRecurring),\r\n                deleteGroup(expenses, api.deleteExpense),\r\n                deleteGroup(incomes, api.deleteIncome),\r\n                deleteGroup(debts, api.deleteDebt),\r\n                deleteGroup(goals, api.deleteGoal),\r\n                deleteGroup(investments, api.deleteInvestment),\r\n                deleteGroup(liabilities, api.deleteLiability)\r\n            ]);\r\n\r\n            // Reset All Accounts to Zero (Fix for \"Ghost Balance\" after wipe)\r\n            const accountResets = accounts.map(a =>\r\n                api.updateAccount(userId, a.id, { balance: 0 }).catch(e => console.warn(`Failed to reset ${a.name}`, e))\r\n            );\r\n            await Promise.all(accountResets);\r\n\r\n            // Refetch to clear state\r\n            await fetchFromApi();\r\n            toast.dismiss(toastId);\r\n            toast.success(\"All data purged. Clean slate initialized.\");\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Partial purge only. Some data remains.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <FinanceContext.Provider\r\n            value={{\r\n                userId,\r\n                // State\r\n                settings,\r\n                currency: settings.currency, // Expose currency\r\n                expenses,\r\n                incomes,\r\n                debts,\r\n                goals,\r\n                accounts,\r\n                investments,\r\n                liabilities,\r\n                recurringTransactions,\r\n                notifications,\r\n                emergencyFundAmount,\r\n                isLoading,\r\n                isRefreshing,\r\n                isOffline,\r\n                apiStatus,\r\n                isFundAllocationOpen,\r\n                fundAllocationType,\r\n\r\n                // Auth\r\n                authStatus,\r\n                currentUser,\r\n                isAwaitingPin,\r\n                isRememberedUser,\r\n                rememberedMobile,\r\n                authMessage,\r\n\r\n                // Actions\r\n                refreshData,\r\n                updateSettings,\r\n                checkIdentity,\r\n                login,\r\n                signup,\r\n                logout,\r\n                clearPendingSession,\r\n                scheduleAccountDeletion,\r\n                cancelAccountDeletion,\r\n                deletionDate,\r\n                sendOtp,\r\n                verifyOtp,\r\n                resetPin,\r\n                pendingMobile,\r\n\r\n                createExpense,\r\n                updateExpense,\r\n                deleteExpense,\r\n                createIncome,\r\n                updateIncome,\r\n                deleteIncome,\r\n                createDebt,\r\n                updateDebt,\r\n                deleteDebt,\r\n                settleDebt,\r\n                createGoal,\r\n                updateGoal,\r\n                deleteGoal,\r\n                createAccount,\r\n                updateAccount,\r\n                deleteAccount,\r\n                createLiability,\r\n                updateLiability,\r\n                deleteLiability,\r\n                migrateSubscriptions,\r\n                cleanupDuplicates,\r\n                createInvestment,\r\n                updateInvestment,\r\n                deleteInvestment,\r\n                createRecurringTransaction,\r\n                createRecurring: createRecurringTransaction, // Alias\r\n                updateRecurringTransaction,\r\n                deleteRecurringTransaction,\r\n                processRecurringTransactions,\r\n                setEmergencyFundAmount,\r\n                setNotifications,\r\n                applyTheme,\r\n\r\n                // Fund Allocation\r\n                openFundAllocation,\r\n                closeFundAllocation,\r\n                performFundAllocation,\r\n                deductFromAccount,\r\n                transferFunds,\r\n                clearAllData,\r\n\r\n                // Backfill Logic\r\n                backfillRequest,\r\n                setBackfillRequest,\r\n                executeBackfill\r\n            }}\r\n        >\r\n            {children}\r\n        </FinanceContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\data\\financial-quotes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\hooks\\useDeleteWithUndo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\hooks\\useShadowWallet.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\services\\ai\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\services\\ai\\prompts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\services\\ai\\providers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\supabase\\functions\\server\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\supabase\\functions\\server\\kv_store.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\types\\images.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\achievements.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\aiUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\architect.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\autoCategorize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\budgetUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\financeCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\gestures.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\haptics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\insights.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\isTransfer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\numberFormat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\stockData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\utils\\supabase\\info.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\tailwind.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\GitHub\\Finbasev50-3\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}],"metadata":{"cwd":"D:\\GitHub\\Finbasev50-3","rulesMeta":{"react-hooks/exhaustive-deps":{"type":"suggestion","docs":{"description":"verifies the list of dependencies for Hooks like useEffect and similar","recommended":true,"url":"https://github.com/facebook/react/issues/14920"},"fixable":"code","hasSuggestions":true,"schema":[{"type":"object","additionalProperties":false,"enableDangerousAutofixThisMayCauseInfiniteLoops":false,"properties":{"additionalHooks":{"type":"string"},"enableDangerousAutofixThisMayCauseInfiniteLoops":{"type":"boolean"},"experimental_autoDependenciesHooks":{"type":"array","items":{"type":"string"}},"requireExplicitEffectDeps":{"type":"boolean"}}}]},"@typescript-eslint/no-unused-vars":{"type":"problem","docs":{"description":"Disallow unused variables","extendsBaseRule":true,"recommended":"recommended","url":"https://typescript-eslint.io/rules/no-unused-vars"},"fixable":"code","hasSuggestions":true,"messages":{"removeUnusedImportDeclaration":"Remove unused import declaration.","removeUnusedVar":"Remove unused variable \"{{varName}}\".","unusedVar":"'{{varName}}' is {{action}} but never used{{additional}}.","usedIgnoredVar":"'{{varName}}' is marked as ignored but is used{{additional}}.","usedOnlyAsType":"'{{varName}}' is {{action}} but only used as a type{{additional}}."},"schema":[{"oneOf":[{"type":"string","description":"Broad setting for unused variables to target.","enum":["all","local"]},{"type":"object","additionalProperties":false,"properties":{"args":{"type":"string","description":"Whether to check all, some, or no arguments.","enum":["all","after-used","none"]},"argsIgnorePattern":{"type":"string","description":"Regular expressions of argument names to not check for usage."},"caughtErrors":{"type":"string","description":"Whether to check catch block arguments.","enum":["all","none"]},"caughtErrorsIgnorePattern":{"type":"string","description":"Regular expressions of catch block argument names to not check for usage."},"destructuredArrayIgnorePattern":{"type":"string","description":"Regular expressions of destructured array variable names to not check for usage."},"enableAutofixRemoval":{"type":"object","additionalProperties":false,"description":"Configurable automatic fixes for different types of unused variables.","properties":{"imports":{"type":"boolean","description":"Whether to enable automatic removal of unused imports."}}},"ignoreClassWithStaticInitBlock":{"type":"boolean","description":"Whether to ignore classes with at least one static initialization block."},"ignoreRestSiblings":{"type":"boolean","description":"Whether to ignore sibling properties in `...` destructurings."},"ignoreUsingDeclarations":{"type":"boolean","description":"Whether to ignore using or await using declarations."},"reportUsedIgnorePattern":{"type":"boolean","description":"Whether to report variables that match any of the valid ignore pattern options if they have been used."},"vars":{"type":"string","description":"Whether to check all variables or only locally-declared variables.","enum":["all","local"]},"varsIgnorePattern":{"type":"string","description":"Regular expressions of variable names to not check for usage."}}}]}]},"react-refresh/only-export-components":{"messages":{"exportAll":"This rule can't verify that `export *` only exports components.","namedExport":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","anonymousExport":"Fast refresh can't handle anonymous components. Add a name to your export.","localComponents":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","noExport":"Fast refresh only works when a file has exports. Move your component(s) to a separate file.","reactContext":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file."},"type":"problem","schema":[{"type":"object","properties":{"allowExportNames":{"type":"array","items":{"type":"string"}},"allowConstantExport":{"type":"boolean"},"customHOCs":{"type":"array","items":{"type":"string"}},"checkJS":{"type":"boolean"}},"additionalProperties":false}]}}}}